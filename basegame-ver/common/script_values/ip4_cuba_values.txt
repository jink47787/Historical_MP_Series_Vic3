
total_country_exports = {
	every_scope_state = {
		add = "state_exports"
	}
}

je_cuba_la_vida_dulce_export_target = 2000
je_cuba_es_espana_export_target = 1000

je_cuba_join_usa_price = { #will be multiplied by 100, so it can decay properly. #Todo Cuba should be able to influence this somehow.
	add = {
		add = 57700 
		desc = "je_cuba_join_usa_base_price"
	}
	if = {
		limit = { exists = c:CUB }
		add = {
			add = c:CUB.gdp
			multiply = 0.01
			desc = "je_cuba_join_usa_cuba_value_price"
		}
	}
	else_if = {
		limit = { has_variable = cubas_last_gdp }
		add = {
			add = var:cubas_last_gdp
			multiply = 0.01
			desc = "je_cuba_join_usa_cuba_value_price"
		}
	}
}

#Variables for quick balancing of je_cuba_independencia. 
je_cuba_drift_factor = 0.2 # How quickly Cuba bars chase target
je_cuba_join_usa_target_power_bloc_leverage_multiplier = 0.1
je_cuba_join_usa_eco_dependence_multiplier = 200 #1 point of economic dependence above or below 2.5 results in this much effect.
je_cuba_target_prestige_multiplier = 7 #the expected prestige ratio of USA compared to CUB, if CUB is bigger than 1/X of US prestige, the bar goes to them.
je_cuba_target_prestige_factor_multiplier = 0.10 #and how much prestige should matter
je_cuba_sol_expected_difference = 0 #The US is expected to have this much more SOL, if they have more it will make them pro US...
je_cuba_sol_difference_multiplier = 3 #...by this amount per point of SOL
je_cuba_relations_multiplier = 0.25 #how much relations should effect

je_cuba_low_bracket = 45 #defines max required to do PRO-US
je_cuba_high_bracket = 55 #defines min required to do independence

je_cuba_independencia_bar_target = {
	add = {
		add = 50
		desc = "base_value"
	}

	#Same slave law
	if = {
		limit = {
			AND = {
				c:CUB ?= {
					has_slavery = yes 
				}
				OR = {
					s:STATE_FLORIDA = {
						any_scope_state = {
							owner = {
								c:CSA ?= this
								has_slavery = yes 
							}
						}
					}
					AND = {
						s:STATE_FLORIDA = {
							NOT = {
								any_scope_state = {
									owner = {
										c:CSA ?= this
									}
								}
							}
						}
						c:USA ?= {
							has_slavery = yes 
						}
					}
				}
			}
		}
		add = {
			add = -15 
			desc = join_usa_same_slave_law_tt
		}
	}
	else_if = {
		limit = {
			AND = {
				c:CUB ?= {
					has_slavery = no 
				}
				OR = {
					s:STATE_FLORIDA = {
						any_scope_state = {
							owner = {
								c:CSA ?= this
								has_slavery = no 
							}
						}
					}
					AND = {
						s:STATE_FLORIDA = {
							NOT = {
								any_scope_state = {
									owner = {
										c:CSA ?= this
									}
								}
							}
						}
						c:USA ?= {
							has_slavery = no 
						}
					}
				}
			}
		}
		add = {
			add = -5 
			desc = join_usa_free_slave_law_tt
		}
	}
	else = {
		add = {
			add = 10
			desc = join_usa_different_slave_law_tt
		} 
	}


	#USA power bloc leverage. Note leverage advantage calculates backwards, so c:USA.power_bloc.leverage_advantage(c:CUB) returns a negative value as it checks cuba leverage vs USA. 
	if = {
		limit = {
			AND = {
				s:STATE_FLORIDA = {
					NOT = {
						any_scope_state = {
							owner = { c:CSA ?= this }
						}
					}
				}
				exists = c:USA.power_bloc
				exists = c:SPA.power_bloc
			}
		}
		add = {
			add = "c:USA.power_bloc.leverage_advantage(c:CUB)" 
			subtract = {
				add = "c:SPA.power_bloc.leverage_advantage(c:CUB)"
				divide = 2
			}
			multiply = -1
			multiply = je_cuba_join_usa_target_power_bloc_leverage_multiplier
			desc = join_usa_same_powerbloc_compared_to_spain_tt
			max = 0
			min = -25
		}
	}
	else_if = {
		limit = {
			AND = {
				s:STATE_FLORIDA = {
					any_scope_state = {
						owner = { c:CSA ?= this }
					}
				}
				exists = c:CSA.power_bloc
				exists = c:SPA.power_bloc
			}
		}
		add = {
			add = "c:CSA.power_bloc.leverage_advantage(c:CUB)" 
			subtract = {
				add = "c:SPA.power_bloc.leverage_advantage(c:CUB)"
				divide = 2
			}
			multiply = -1
			multiply = je_cuba_join_usa_target_power_bloc_leverage_multiplier
			desc = join_usa_same_powerbloc_compared_to_spain_tt
			max = 0
			min = -25
		}
	}
	else_if = {
		limit = {
			s:STATE_FLORIDA = {
				NOT = {
					any_scope_state = {
						owner = { c:CSA ?= this }
					}
				}
			}
			exists = c:USA.power_bloc
		}
		add = {
			add = "c:USA.power_bloc.leverage_advantage(c:CUB)" 
			multiply = je_cuba_join_usa_target_power_bloc_leverage_multiplier
			desc = join_usa_usa_powerbloc_tt
			multiply = -1
			max = 0
			min = -25 
		}
	}
	else_if = {
		limit = {
			exists = c:CSA.power_bloc
		}
		add = {
			add = "c:CSA.power_bloc.leverage_advantage(c:CUB)" 
			multiply = je_cuba_join_usa_target_power_bloc_leverage_multiplier
			desc = join_usa_usa_powerbloc_tt
			multiply = -1
			max = 0
			min = -25 
		}
	}
	else = {
		add = {
			add = 5
			desc = join_usa_no_powerblocs_tt
		}
	}

	#economic dependence
	if = {
		limit = {
			s:STATE_FLORIDA = {
				any_scope_state = {
					owner = { c:CSA ?= this }
				}
			}
		}
		add = {
			add = "c:CUB.economic_dependence(c:CSA)"
			# subtract = -2.5 #dependence is out of 5
			multiply = je_cuba_join_usa_eco_dependence_multiplier
			multiply = -1 #more dependence is pro CSA
			min = -25
			max = 25
			desc = join_usa_economic_dependence_with_USA_tt
		}
	}
	else = {
		add = {
			add = "c:CUB.economic_dependence(c:USA)"
			# subtract = -2.5 #dependence is out of 5
			multiply = je_cuba_join_usa_eco_dependence_multiplier
			multiply = -1 #more dependence is pro USA
			min = -25
			max = 25
			desc = join_usa_economic_dependence_with_USA_tt
		}
	}

	#Prestige
	if = {
		limit = {
			s:STATE_FLORIDA = {
				any_scope_state = {
					owner = { c:CSA ?= this }
				}
			}
			c:CSA.prestige > 0
			c:CUB.prestige > 0
		}
		add = {
			add = c:CUB.prestige
			multiply = je_cuba_target_prestige_multiplier 
			subtract = c:CSA.prestige
			###This gives you the difference between expected prestige US should have vs they have. 
			multiply = je_cuba_target_prestige_factor_multiplier
			min = -25
			max = 30
			desc = join_usa_prestige_tt
		}
	}
	else_if = {
		limit = {
			s:STATE_FLORIDA = {
				NOT = {
					any_scope_state = {
						owner = { c:CSA ?= this }
					}
				}
			}
			c:USA.prestige > 0
			c:CUB.prestige > 0
		}
		add = {
			add = c:CUB.prestige
			multiply = je_cuba_target_prestige_multiplier 
			subtract = c:USA.prestige
			###This gives you the difference between expected prestige US should have vs they have. 
			multiply = je_cuba_target_prestige_factor_multiplier
			min = -25
			max = 30
			desc = join_usa_prestige_tt
		}
	}
	else = {
		add = {
			add = 6.66
			desc = join_usa_prestige_tt
		}
	}

	#average sol
	if = { #if CSA is better than Cuba
		limit = {
			exists = c:CSA
			s:STATE_FLORIDA = {
				NOT = {
					any_scope_state = {
						owner = { c:CSA ?= this }
					}
				}
			}
			"c:CSA.average_sol" > "c:CUB.average_sol"
		}
		add = {
			add = "c:CUB.average_sol"
			add = je_cuba_sol_expected_difference
			subtract = "c:CSA.average_sol"
			multiply = je_cuba_sol_difference_multiplier
			min = -30
			max = 30
			desc = join_usa_sol_spa_tt 
		}
	}
	else_if = { #if USA is better than Cuba
		limit = {
			"c:USA.average_sol" > "c:CUB.average_sol"
		}
		add = {
			add = "c:CUB.average_sol"
			add = je_cuba_sol_expected_difference
			subtract = "c:USA.average_sol"
			multiply = je_cuba_sol_difference_multiplier
			min = -30
			max = 30
			desc = join_usa_sol_spa_tt 
		}
	}
	else = { #if Cuba better life than USA
		add = {
			add = 30
			desc = join_usa_sol_cub_tt
		} 
	}


	#fervor of Carribeno culture.
	if = {
		limit = {
			c:CUB ?= {
				any_scope_culture = {
					this = cu:caribeno
				}
			}
		}
		add = {
			cu:caribeno = {
				add = culture_current_fervor
			}
			desc = "independencia_caribeno_cultural_fervor_tt"
			min = 0.001
			max = 50
		}
	}

	#fervor of afro-Carribeno culture
	if = {
		limit = {
			c:CUB ?= {
				any_scope_culture = {
					this = cu:afro_caribeno
				}
			}
		}
		add = {
			cu:afro_caribeno = {
				add = culture_current_fervor
			}
			desc = "cuba_slave_revolt_slaves_fervor_tt"
			if = {
				limit = {
					c:USA ?= {
						has_slavery = yes
					}
					c:CUB ?= {
						OR = {
							has_slavery = no
							has_variable = slaves_work_with_independence_movement
						}
					}
				}
				multiply = 2.5
			}
			min = 0.1
			max = 75
		}
	}

	#American Relations
	if = {
		limit = {
			exists = c:CSA
			s:STATE_FLORIDA = {
				NOT = {
					any_scope_state = {
						owner = { c:CSA ?= this }
					}
				}
			}
		}
		add = {
			add = c:CSA.relations:root
			multiply = je_cuba_relations_multiplier
			multiply = -1 #good relations drives towards CS.
			desc = join_usa_relations_tt
		}
	}
	else = {
		add = {
			add = c:USA.relations:root
			multiply = je_cuba_relations_multiplier
			multiply = -1 #good relations drives towards US.
			desc = join_usa_relations_tt
		}
	}

	min = 0
	max = 100
}
