two_spains_liberal_progress = {
	if = {
		limit = {
			has_journal_entry = je_the_two_spains
		}
	    value = "je:je_the_two_spains.scripted_bar_progress(je_two_spains_progress_bar)"
        divide = 100
	}
}

two_spains_conservative_progress = {
	value = 100
	if = {
		limit = {
			has_journal_entry = je_the_two_spains
		}
		subtract = "je:je_the_two_spains.scripted_bar_progress(je_two_spains_progress_bar)"
        divide = 100
	}
}

two_spains_liberal_pivot = {
	if = {
		limit = {
			has_journal_entry = je_the_two_spains
		}
		c:SPA ?= {
			add = {
				add = ig:ig_intelligentsia.ig_clout
				desc = TWO_SPAINS_INTELLIGENTSIA_CLOUT_TT
			}
			if = {
				limit = {
					ig:ig_intelligentsia ?= {
						leader = {
							OR = {
								has_conservative_ideology = yes
								has_reactionary_ideology = yes
							}
						}
					}
				}
				subtract = {
					add = ig:ig_intelligentsia.ig_clout
					divide = 2
					desc = TWO_SPAINS_CONSERVATIVE_INTELLIGENTSIA_TT
				}
			}
			add = {
				add = ig:ig_trade_unions.ig_clout
				desc = TWO_SPAINS_TRADE_UNIONS_CLOUT_TT
			}
			if = {
				limit = {
					ig:ig_trade_unions ?= {
						leader = {
							OR = {
								has_conservative_ideology = yes
								has_reactionary_ideology = yes
							}
						}
					}
				}
				subtract = {
					add = ig:ig_trade_unions.ig_clout
					divide = 2
					desc = TWO_SPAINS_CONSERVATIVE_TRADE_UNIONS_TT
				}
			}
			if = {
				limit = {
					any_interest_group = {
						leader = {
							OR = {
								has_liberal_ideology = yes
								has_progressive_ideology = yes
							}
						}
						NOR = {
							is_interest_group_type = ig_intelligentsia
							is_interest_group_type = ig_trade_unions
							is_interest_group_type = ig_landowners
							is_interest_group_type = ig_devout
						}
					}
				}
				add = {
					value = 0
					desc = TWO_SPAINS_LIBERAL_IGS_CLOUT_TT
					every_interest_group = {
						limit = {
							leader = {
								OR = {
									has_liberal_ideology = yes
									has_progressive_ideology = yes
								}
							}
							NOR = {
								is_interest_group_type = ig_intelligentsia
								is_interest_group_type = ig_trade_unions
								is_interest_group_type = ig_landowners
								is_interest_group_type = ig_devout
							}
						}
						add = this.ig_clout
					}
				}
			}
			if = {
				limit = {
					any_scope_character = {
						has_role = general
						OR = {
							is_interest_group_type = ig_intelligentsia
							is_interest_group_type = ig_trade_unions
							has_liberal_ideology = yes
							has_progressive_ideology = yes
						}
					}
				}
				add = {
					desc = TWO_SPAINS_ARMY_UNITS_LIBERAL_COMMANDERS_TT
					every_scope_character = {
						limit = {
							has_role = general
							OR = {
								is_interest_group_type = ig_intelligentsia
								is_interest_group_type = ig_trade_unions
								has_liberal_ideology = yes
								has_progressive_ideology = yes
							}
						}
						value = this.num_units_share
					}
					divide = 100
				}
			}
			if = {
				limit = {
					any_scope_character = {
						has_role = admiral
						OR = {
							is_interest_group_type = ig_intelligentsia
							is_interest_group_type = ig_trade_unions
							has_liberal_ideology = yes
							has_progressive_ideology = yes
						}
					}
				}
				add = {
					desc = TWO_SPAINS_NAVY_UNITS_LIBERAL_COMMANDERS_TT
					every_scope_character = {
						limit = {
							has_role = admiral
							OR = {
								is_interest_group_type = ig_intelligentsia
								is_interest_group_type = ig_trade_unions
								has_liberal_ideology = yes
								has_progressive_ideology = yes
							}
						}
						value = this.num_units_share
					}
					divide = 100
				}
			}
			if = {
				limit = {
					any_political_movement = {
						movement_is_liberal = yes
					}
				}
				add = {
					desc = TWO_SPAINS_LIBERAL_MOVEMENTS_TT
					every_political_movement = {
						limit = {
							movement_is_liberal = yes
						}
						add = {
							value = political_movement_support
						}
					}
				}
			}
			if = {
				limit = {
					modifier:country_two_spains_liberal_drift_add != 0
				}
				add = {
					desc = TIMED_MODIFIERS
					value = modifier:country_two_spains_liberal_drift_add
				}
			}
		}
		min = 0
	}
	else = {
		value = 0
	}
}

two_spains_conservative_pivot = {
	if = {
		limit = {
			has_journal_entry = je_the_two_spains
		}
		c:SPA ?= {
			add = {
				add = ig:ig_landowners.ig_clout
				desc = TWO_SPAINS_LANDOWNERS_CLOUT_TT
			}
			if = {
				limit = {
					ig:ig_landowners ?= {
						leader = {
							OR = {
								has_liberal_ideology = yes
								has_progressive_ideology = yes
							}
						}
					}
				}
				subtract = {
					add = ig:ig_landowners.ig_clout
					divide = 2
					desc = TWO_SPAINS_LIBERAL_LANDOWNERS_TT
				}
			}
			add = {
				value = ig:ig_devout.ig_clout
				desc = TWO_SPAINS_DEVOUT_CLOUT_TT
			}
			if = {
				limit = {
					ig:ig_devout = {
						leader = {
							OR = {
								has_liberal_ideology = yes
								has_progressive_ideology = yes
							}
						}
					}
				}
				subtract = {
					add = ig:ig_devout.ig_clout
					divide = 2
					desc = TWO_SPAINS_LIBERAL_DEVOUT_TT
				}
			}
			if = {
				limit = {
					any_interest_group = {
						leader = {
							OR = {
								has_conservative_ideology = yes
								has_reactionary_ideology = yes
							}
						}
						NOR = {
							is_interest_group_type = ig_intelligentsia
							is_interest_group_type = ig_trade_unions
							is_interest_group_type = ig_landowners
							is_interest_group_type = ig_devout
						}
					}
				}
				add = {
					value = 0
					desc = TWO_SPAINS_CONSERVATIVE_IGS_CLOUT_TT
					every_interest_group = {
						limit = {
							leader = {
								OR = {
									has_conservative_ideology = yes
									has_reactionary_ideology = yes
								}
							}
							NOR = {
								is_interest_group_type = ig_intelligentsia
								is_interest_group_type = ig_trade_unions
								is_interest_group_type = ig_landowners
								is_interest_group_type = ig_devout
							}
						}
						add = this.ig_clout
					}
				}
			}
			if = {
				limit = {
					any_scope_character = {
						has_role = general
						OR = {
							is_interest_group_type = ig_devout
							is_interest_group_type = ig_landowners
							has_reactionary_ideology = yes
							has_conservative_ideology = yes
						}
					}
				}
				add = {
					desc = TWO_SPAINS_ARMY_UNITS_CONSERVATIVE_COMMANDERS_TT
					every_scope_character = {
						limit = {
							has_role = general
							OR = {
								is_interest_group_type = ig_devout
								is_interest_group_type = ig_landowners
								has_reactionary_ideology = yes
								has_conservative_ideology = yes
							}
						}
						value = this.num_units_share
					}
					divide = 100
				}
			}
			if = {
				limit = {
					any_scope_character = {
						has_role = admiral
						OR = {
							is_interest_group_type = ig_devout
							is_interest_group_type = ig_landowners
							has_reactionary_ideology = yes
							has_conservative_ideology = yes
						}
					}
				}
				add = {
					desc = TWO_SPAINS_NAVY_UNITS_CONSERVATIVE_COMMANDERS_TT
					every_scope_character = {
						limit = {
							has_role = admiral
							OR = {
								is_interest_group_type = ig_devout
								is_interest_group_type = ig_landowners
								has_reactionary_ideology = yes
								has_conservative_ideology = yes
							}
						}
						value = this.num_units_share
					}
					divide = 100
				}
			}
			if = {
				limit = {
					any_political_movement = {
						movement_is_conservative = yes
					}
				}
				add = {
					desc = TWO_SPAINS_CONSERVATIVE_MOVEMENTS_TT
					every_political_movement = {
						limit = {
							movement_is_conservative = yes
						}
						add = {
							value = political_movement_support
						}
					}
				}
			}
			if = {
				limit = {
					modifier:country_two_spains_conservative_drift_add != 0
				}
				add = {
					desc = TIMED_MODIFIERS
					value = modifier:country_two_spains_conservative_drift_add
				}
			}
		}
		min = 0
	}
	else = {
		value = 0
	}
}

two_spains_liberal_display = {
	if = {
		limit = {
			has_journal_entry = je_the_two_spains
		}
		c:SPA ?= {
			value = two_spains_liberal_pivot # x/(x+y)
			divide = {
				value = two_spains_liberal_pivot
				add = two_spains_conservative_pivot
			}
		}
		multiply = 100
		round = yes # This is a monument to all of my sins.
		divide = 100
		min = 0
		max = 1
	}
	else = {
		value = 0
	}
}

two_spains_conservative_display = {
	if = {
		limit = {
			has_journal_entry = je_the_two_spains
		}
		c:SPA ?= {
			value = two_spains_conservative_pivot  # y/(x+y)
			divide = {
				value = two_spains_liberal_pivot
				add = two_spains_conservative_pivot
			}
		}
		multiply = 100
		round = yes
		divide = 100
		min = 0
		max = 1
	}
	else = {
		value = 0
	}
}

two_spains_tension_pivot = {
	if = {
		limit = {
			has_journal_entry = je_the_two_spains
		}
		c:SPA ?= {
			add = {
				desc = TWO_SPAINS_BASE_VALUE_TT
				value = 0.25
			}
			add = {
				desc = TWO_SPAINS_LEGITIMACY_TT
				value = 75
				subtract = legitimacy # Increases tension if legitimacy is below 75
				divide = 250
			}
			add = {
				desc = TWO_SPAINS_RADICAL_FRACTION_TT
				add = radical_fraction
			}
			subtract = {
				desc = TWO_SPAINS_LOYALIST_FRACTION_TT
				add = loyalist_fraction
			}
			subtract = {
				desc = TWO_SPAINS_CONSERVATIVE_IG_APPROVAL_TT
				every_interest_group = {
					limit = {
						OR = {
							is_interest_group_type = ig_landowners
							is_interest_group_type = ig_devout
							AND = {
								NOR = {
									is_interest_group_type = ig_intelligentsia
									is_interest_group_type = ig_trade_unions
								}
								OR = {
									interest_group_has_conservative_ideology = yes
									interest_group_has_reactionary_ideology = yes
								}
							}
						}
					}
					add = ig_approval
				}
				divide = 100
			}
			subtract = {
				desc = TWO_SPAINS_LIBERAL_IG_APPROVAL_TT
				every_interest_group = {
					limit = {
						OR = {
							is_interest_group_type = ig_intelligentsia
							is_interest_group_type = ig_trade_unions
							AND = {
								NOR = {
									is_interest_group_type = ig_landowners
									is_interest_group_type = ig_devout
								}
								OR = {
									interest_group_has_liberal_ideology = yes
									interest_group_has_progressive_ideology = yes
								}
							}
						}
					}
					add = ig_approval
					max = 10 # Having some very happy IGs and some very angry IGs is the definition of tension
				}
				divide = 100
			}
		}
		min = 0
		max = 1
	}
	else = {
		value = 0
	}
}

je_devorismo_privatisation_target = 0.9
je_devorismo_election_months = 2

espartero_age = {
	value = year
	subtract = 1793
}

years_since_game_start = {
	value = year
	subtract = 1836
}

yearly_gross_income = {
	value = fixed_income
	multiply = 52
}

country_slave_culture_population = {
	value = "culture_percent_country(scope:culture)"
	multiply = total_population
}

brazil_pedropoints_as_percent = {
	if = {
		limit = {
			exists = c:BRZ
			c:BRZ ?= {
				has_journal_entry = je_pedro_brazil
				has_variable = pedropoints
			}
		}
		value = c:BRZ.var:pedropoints
		multiply = 0.1
	}
}

iberia_shared_law_requirement = 15

commander_coup_strength = {
	add = {
		desc = "coup_popularity_tt"
		value = popularity
		divide = 10
	}
	if = { # Land coups
		limit = {
			exists = owner
			has_role = general
			owner.army_size_including_raised_conscripts > 0
		}
		add = {
			desc = "coup_num_army_units_tt"
			value = this.num_units_share
			divide = owner.army_size_including_raised_conscripts
			multiply = 5
		}
	}
	if = { # Boat coups
		limit = {
			exists = owner
			has_role = admiral
			owner.navy_size > 0
		}
		add = {
			desc = "coup_num_navy_units_tt"
			value = this.num_units_share
			divide = owner.navy_size
			multiply = 5
		}
	}
	if = {
		limit = {
			exists = owner
			exists = this.commander_military_formation.current_hq
			this.commander_military_formation.current_hq.region ?= owner.capital.region
		}
		add = {
			desc = "coup_commander_core_location_tt"
			value = 2
		}
	}
	else_if = {
		limit = {
			exists = owner
			exists = this.commander_military_formation.current_hq
			this.commander_military_formation.current_hq.region ?= {
				any_scope_state = {
					owner = root.owner
					is_incorporated = yes
				}
			}
		}
		add = {
			desc = "coup_commander_periphery_location_tt"
			value = 1
		}
	}
	else_if = {
		limit = {
			exists = owner
			exists = this.commander_military_formation.current_hq
			this.commander_military_formation.current_hq.region ?= {
				any_scope_state = {
					owner ?= root.owner
					is_incorporated = no
				}
			}
		}
		add = {
			desc = "coup_commander_colony_location_tt"
			value = -2
		}
	}
	else_if = {
		limit = {
			NOT = {
				exists = this.commander_military_formation.current_hq
			}
		}
		add = {
			desc = "coup_commander_no_location_tt"
			value = -1
		}
	}
	add = {
		desc = "coup_clout_tt"
		value = this.interest_group.ig_clout
		multiply = 10
	}
	add = {
		desc = "coup_strength_modifier_add_tt"
		value = modifier:character_coup_strength_add
	}
	multiply = {
		desc = "coup_strength_modifier_tt"
		value = 1
		add = modifier:character_coup_strength_mult
	}
}

commander_coup_strength_country_display = { # Note - absolute fraud script value for tooltip purposes. Must equal the above.
	add = {
		desc = "coup_popularity_vs_legitimacy_tt"
		every_scope_character = {
			limit = {
				has_variable = golpista_var
			}
			value = popularity
			divide = 10
		}
	}
	if = { # Land coups
		limit = {
			army_size_including_raised_conscripts > 0
			any_scope_character = {
				has_variable = golpista_var
				has_role = general
			}
		}
		add = {
			desc = "coup_commander_num_army_units_tt"
			every_scope_character = {
				limit = {
					has_variable = golpista_var
					has_role = general
				}
				value = this.num_units_share
				divide = owner.army_size_including_raised_conscripts
				multiply = 5
			}
		}
	}
	if = { # Boat coups
		limit = {
			navy_size > 0
			any_scope_character = {
				has_variable = golpista_var
				has_role = admiral
			}
		}
		add = {
			desc = "coup_commander_num_navy_units_tt"
			every_scope_character = {
				limit = {
					has_variable = golpista_var
					has_role = admiral
				}
				value = this.num_units_share
				divide = owner.navy_size
				multiply = 5
			}
		}
	}
	if = {
		limit = {
			any_scope_character = {
				has_variable = golpista_var
				exists = this.commander_military_formation.current_hq
				this.commander_military_formation.current_hq.region ?= owner.capital.region
			}
		}
		add = {
			desc = "coup_commander_core_location_progress_tt"
			value = 2
		}
	}
	else_if = {
		limit = {
			any_scope_character = {
				has_variable = golpista_var
				exists = this.commander_military_formation.current_hq
				this.commander_military_formation.current_hq.region ?= {
					any_scope_state = {
						owner = root.owner
						is_incorporated = yes
					}
				}
			}
		}
		add = {
			desc = "coup_commander_periphery_location_progress_tt"
			value = 1
		}
	}
	else_if = {
		limit = {
			any_scope_character = {
				has_variable = golpista_var
				exists = this.commander_military_formation.current_hq
				this.commander_military_formation.current_hq.region ?= {
					any_scope_state = {
						owner = root.owner
						is_incorporated = no
					}
				}
			}
		}
		add = {
			desc = "coup_commander_colony_location_progress_tt"
			value = -2
		}
	}
	else_if = {
		limit = {
			any_scope_character = {
				has_variable = golpista_var
				NOT = {
					exists = this.commander_military_formation.current_hq
				}
			}
		}
		add = {
			desc = "coup_commander_no_location_progress_tt"
			value = -1
		}
	}
	add = {
		desc = "coup_clout_of_golpista_ig_tt"
		every_interest_group = {
			limit = {
				has_variable = golpista_ig_var
			}
			value = ig_clout
			multiply = 10
		}
	}
	add = {
		desc = "coup_strength_modifier_add_tt"
		every_scope_character = {
			limit = {
				has_variable = golpista_var
			}
			value = 1
			add = modifier:character_coup_strength_add
		}
	}
	multiply = {
		desc = "coup_strength_modifier_tt"
		every_scope_character = {
			limit = {
				has_variable = golpista_var
			}
			value = 1
			add = modifier:character_coup_strength_mult
		}
	}
}

country_coup_resistance = {
	add = {
		desc = "coup_legitimacy_tt"
		value = legitimacy
		divide = 10
	}
	add = {
		desc = "coup_resistance_modifier_add_tt"
		value = 1
		add = modifier:country_coup_resistance_add
	}
	multiply = {
		desc = "coup_resistance_modifier_tt"
		value = 1
		add = modifier:country_coup_resistance_mult
	}
}

country_coup_resistance_reversed = { # Must exactly match country_coup_resistance but reversed. I don't like that this has to exist either.
	subtract = {
		desc = "coup_legitimacy_tt"
		value = legitimacy
		divide = 10
	}
	subtract = {
		desc = "coup_resistance_modifier_add_tt"
		value = 1
		add = modifier:country_coup_resistance_add
	}
	multiply = {
		desc = "coup_resistance_modifier_tt"
		value = 1
		add = modifier:country_coup_resistance_mult
	}
}
