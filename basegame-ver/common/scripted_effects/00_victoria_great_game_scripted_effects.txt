great_game_britain_progress_10 = {
	custom_tooltip = {
		text = great_game_points_britain_increases_10_tt
		every_country = {
			limit = {
				has_journal_entry = je_great_game_control
			}
			je:je_great_game_control = {
				add_progress = { value = -10 name = great_game_core_progress_bar }
			}
			update_gg_progressbar_tooltips = yes
		}
	}
}

great_game_britain_progress_15 = {
	custom_tooltip = {
		text = great_game_points_britain_increases_15_tt
		every_country = {
			limit = {
				has_journal_entry = je_great_game_control
			}
			je:je_great_game_control = {
				add_progress = { value = -15 name = great_game_core_progress_bar }
			}
			update_gg_progressbar_tooltips = yes
		}
	}
}

great_game_britain_progress_25 = {
	custom_tooltip = {
		text = great_game_points_britain_increases_25_tt
		every_country = {
			limit = {
				has_journal_entry = je_great_game_control
			}
			je:je_great_game_control = {
				add_progress = { value = -25 name = great_game_core_progress_bar }
			}
			update_gg_progressbar_tooltips = yes
		}
	}
}

great_game_britain_progress_50 = {
	custom_tooltip = {
		text = great_game_points_britain_increases_50_tt
		every_country = {
			limit = {
				has_journal_entry = je_great_game_control
			}
			je:je_great_game_control = {
				add_progress = { value = -50 name = great_game_core_progress_bar }
			}
			update_gg_progressbar_tooltips = yes
		}
	}
}

great_game_russia_progress_10 = {
	custom_tooltip = {
		text = great_game_points_russia_increases_10_tt
		every_country = {
			limit = {
				has_journal_entry = je_great_game_control
			}
			je:je_great_game_control = {
				add_progress = { value = 10 name = great_game_core_progress_bar }
			}
			update_gg_progressbar_tooltips = yes
		}
	}
}

great_game_russia_progress_15 = {
	custom_tooltip = {
		text = great_game_points_russia_increases_15_tt
		every_country = {
			limit = {
				has_journal_entry = je_great_game_control
			}
			je:je_great_game_control = {
				add_progress = { value = 15 name = great_game_core_progress_bar }
			}
			update_gg_progressbar_tooltips = yes
		}
	}
}

great_game_russia_progress_25 = {
	custom_tooltip = {
		text = great_game_points_russia_increases_25_tt
		every_country = {
			limit = {
				has_journal_entry = je_great_game_control
			}
			je:je_great_game_control = {
				add_progress = { value = 25 name = great_game_core_progress_bar }
			}
			update_gg_progressbar_tooltips = yes
		}
	}
}

complete_great_game_effect = {
	set_global_variable = persia_conflict_started
	set_global_variable = afghanistan_conflict_started
	set_global_variable = korean_protectorate_started
	set_global_variable = central_asia_consolidation_happened
	set_global_variable = kazakhstan_revolt_happened
	set_global_variable = caucasian_war_happened
	random_list = {
		50 = {
			set_global_variable = caucasus_consolidated_var
		}
		50 = {
			set_global_variable = caucasus_failure_var
		}
	}
	random_list = {
		50 = {
			set_global_variable = kazakhstan_victory_var
		}
		50 = {
			set_global_variable = kazakhstan_defeat_var
		}
	}
	set_global_variable = khanates_russia_victory_var
	random_list = {
		50 = {
			set_global_variable = korean_protectorate_success
		}
		50 = {
			set_global_variable = korean_protectorate_failure
		}
	}
	random_list = {
		50 = {
			set_global_variable = afghanistan_russia_victory_var
		}
		50 = {
			set_global_variable = afghanistan_britain_victory_var
		}
		50 = {
			set_global_variable = afghanistan_afghan_victory_var
		}
	}
	random_list = {
		50 = {
			set_global_variable = persia_russia_victory_var
		}
		50 = {
			set_global_variable = persia_britain_victory_var
		}
		50 = {
			set_global_variable = persia_persian_victory_var
		}
	}
	set_global_variable = china_border_codified_variable
	set_global_variable = manchurian_railway_variable
	set_global_variable = trans_siberian_done
	set_global_variable = consolidated_british_india_variable
	set_global_variable = contained_russian_pacific_variable
}

update_gg_progressbar_tooltips = {
	je:je_great_game_control = {
		if = {
			limit = {
				"scripted_bar_progress(great_game_core_progress_bar)" < 0
			}
			set_bar_progress = { value = 0 name = great_game_core_progress_bar }
		}
		if = {
			limit = {
				"scripted_bar_progress(great_game_core_progress_bar)" > 200
			}
			set_bar_progress = { value = 200 name = great_game_core_progress_bar }
		}
		set_global_variable = { name = great_game_gbr_progress value = "scripted_bar_progress(great_game_core_progress_bar)" }
		set_global_variable = { name = great_game_rus_progress value = 200 }
		change_global_variable = { name = great_game_rus_progress subtract = global_var:great_game_gbr_progress }
	}
}

clear_great_game_variables = {
	remove_global_variable = great_game_gbr_progress
	remove_global_variable = great_game_rus_progress
	remove_global_variable = great_game_british_passive_var
	remove_global_variable = great_game_russian_passive_var
	remove_global_variable = great_game_balance_passive_var
	remove_global_variable = great_game_central_asia_gdp
}

calculate_great_game_passive_progress = {
	set_global_variable = { name = great_game_russian_passive_var value = 0 }
	set_global_variable = { name = great_game_british_passive_var value = 0 }
	set_global_variable = { name = great_game_balance_passive_var value = 0 }
	set_global_variable = { name = great_game_central_asia_gdp value = 0 }

	every_state = {
		limit = {
			OR = {
				region = sr:region_central_asia
				region = sr:region_persia
			}
		}
		change_global_variable = { name = great_game_central_asia_gdp add = this.gdp }
	}

	change_global_variable = { name = great_game_central_asia_gdp divide = 1000 }

	c:GBR ?= {
		every_scope_state = {
			limit = {
				OR = {
					region = sr:region_central_asia
					region = sr:region_persia
				}
			}
			change_global_variable = { name = great_game_british_passive_var add = this.gdp }
		}
		every_subject_or_below = {
			limit = {
				any_scope_state = {
					OR = {
						region = sr:region_central_asia
						region = sr:region_persia
					}
				}
			}
			every_scope_state = {
				limit = {
					OR = {
						region = sr:region_central_asia
						region = sr:region_persia
					}
				}
				change_global_variable = { name = great_game_british_passive_var add = this.gdp }
			}
		}
		power_bloc ?= {
			every_power_bloc_member = {
				limit = {
					NOR = {
						c:GBR ?= this
						is_subject_of = c:GBR
					}
					any_scope_state = {
						OR = {
							region = sr:region_central_asia
							region = sr:region_persia
						}
					}
				}
				every_scope_state = {
					limit = {
						OR = {
							region = sr:region_central_asia
							region = sr:region_persia
						}
					}
					change_global_variable = { name = great_game_british_passive_var add = this.gdp }
				}
			}
		}
		change_global_variable = { name = great_game_british_passive_var divide = 1000 }
		change_global_variable = { name = great_game_british_passive_var divide = global_var:great_game_central_asia_gdp }
	}

	c:RUS ?= {
		every_scope_state = {
			limit = {
				OR = {
					region = sr:region_central_asia
					region = sr:region_persia
				}
			}
			change_global_variable = { name = great_game_russian_passive_var add = this.gdp }
		}
		every_subject_or_below = {
			limit = {
				any_scope_state = {
					OR = {
						region = sr:region_central_asia
						region = sr:region_persia
					}
				}
			}
			every_scope_state = {
				limit = {
					OR = {
						region = sr:region_central_asia
						region = sr:region_persia
					}
				}
				change_global_variable = { name = great_game_russian_passive_var add = this.gdp }
			}
		}
		power_bloc ?= {
			every_power_bloc_member = {
				limit = {
					NOR = {
						c:RUS ?= this
						is_subject_of = c:RUS
					}
					any_scope_state = {
						OR = {
							region = sr:region_central_asia
							region = sr:region_persia
						}
					}
				}
				every_scope_state = {
					limit = {
						OR = {
							region = sr:region_central_asia
							region = sr:region_persia
						}
					}
					change_global_variable = { name = great_game_russian_passive_var add = this.gdp }
				}
			}
		}
		change_global_variable = { name = great_game_russian_passive_var divide = 1000 }
		change_global_variable = { name = great_game_russian_passive_var divide = global_var:great_game_central_asia_gdp  }
	}

	set_global_variable = { name = great_game_balance_passive_var value = global_var:great_game_russian_passive_var }
	change_global_variable = { name = great_game_balance_passive_var subtract = global_var:great_game_british_passive_var }
	change_global_variable = { name = great_game_balance_passive_var multiply = 5 }
}

handle_ai_great_game_objectives = {
	if = {
		limit = {
			c:RUS ?= this
		}
		assign_russia_ai_great_game_objectives = yes
	}

	if = {
		limit = {
			c:GBR ?= this
			has_journal_entry = je_great_game_control
		}
		assign_britain_ai_great_game_objectives = yes
	}

	if = {
		limit = {
			is_afghan_nation = yes
			has_journal_entry = je_great_game_control
		}
		assign_afghanistan_ai_great_game_objectives = yes
	}

	if = {
		limit = {
			c:PER ?= this
			has_journal_entry = je_great_game_control
		}
		assign_persia_ai_great_game_objectives = yes
	}
}

assign_russia_ai_great_game_objectives = {
	### Generic Objectives
	if = {
		limit = {
			NOT = {
				has_variable = je_tibet_expedition_ai_var
			}
			has_variable = tibet_has_started
			NOT = { has_global_variable = tibet_expedition_completed }
			has_interest_marker_in_region = region_himalayas
		}
		set_variable = je_tibet_expedition_ai_var
		add_journal_entry = {
			type = je_tibet_expedition
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_consolidate_afghanistan_objective_ai_var
			}
			has_interest_marker_in_region = region_persia
			exists = c:AFG
		}
		set_variable = je_consolidate_afghanistan_objective_ai_var
		add_journal_entry = {
			type = je_consolidate_afghanistan_objective
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_maintain_afghan_protectorate_ai_var
			}
			NOT = {
				has_global_variable = gg_afghanistan_protectorate_done
			}
			has_interest_marker_in_region = region_persia
		}
		set_variable = je_maintain_afghan_protectorate_ai_var
		add_journal_entry = {
			type = je_maintain_afghan_protectorate
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_secure_influence_over_persia_ai_var
			}
			has_interest_marker_in_region = region_persia
		}
		set_variable = je_secure_influence_over_persia_ai_var
		add_journal_entry = {
			type = je_secure_influence_over_persia
		}
	}

	### Specific Objectives
	if = {
		limit = {
			NOT = {
				has_variable = je_secure_persian_border_ai_var
			}
			exists = c:CIR
		}
		set_variable = je_secure_persian_border_ai_var
		add_journal_entry = {
			type = je_secure_persian_border
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_pacify_kazakh_steppes_ai_var
			}
			has_journal_entry = je_pacify_the_steppes
		}
		set_variable = je_pacify_kazakh_steppes_ai_var
		add_journal_entry = {
			type = je_pacify_kazakh_steppes
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_codify_chinese_border_ai_var
			}
			has_technology_researched = nationalism
		}
		set_variable = je_codify_chinese_border_ai_var
		add_journal_entry = {
			type = je_codify_chinese_border
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_consolidate_central_asia_ai_var
			}
			has_technology_researched = nationalism
		}
		set_variable = je_consolidate_central_asia_ai_var
		add_journal_entry = {
			type = je_consolidate_central_asia
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_chinese_concessions_ai_var
			}
			has_technology_researched = railways
			any_scope_state = {
				OR = {
					state_region = s:STATE_OUTER_MANCHURIA
					state_region = s:STATE_AMUR
				}
				is_incorporated = yes
			}
		}
		set_variable = je_chinese_concessions_ai_var
		add_journal_entry = {
			type = je_chinese_concessions
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_acquire_korean_protectorate_ai_var
			}
			any_neighbouring_state = {
				owner = c:KOR
				is_incorporated = yes
			}
			c:KOR ?= {
				is_country_type = unrecognized
			}
		}
		set_variable = je_acquire_korean_protectorate_ai_var
		add_journal_entry = {
			type = je_acquire_korean_protectorate
		}
	}
}

assign_britain_ai_great_game_objectives = {
	### Generic Objectives
	if = {
		limit = {
			NOT = {
				has_variable = je_tibet_expedition_ai_var
			}
			has_variable = tibet_has_started
			NOT = { has_global_variable = tibet_expedition_completed }
			has_interest_marker_in_region = region_himalayas
		}
		set_variable = je_tibet_expedition_ai_var
		add_journal_entry = {
			type = je_tibet_expedition
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_consolidate_afghanistan_objective_ai_var
			}
			has_interest_marker_in_region = region_persia
			exists = c:AFG
		}
		set_variable = je_consolidate_afghanistan_objective_ai_var
		add_journal_entry = {
			type = je_consolidate_afghanistan_objective
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_maintain_afghan_protectorate_ai_var
			}
			NOT = {
				has_global_variable = gg_afghanistan_protectorate_done
			}
			has_interest_marker_in_region = region_persia
		}
		set_variable = je_maintain_afghan_protectorate_ai_var
		add_journal_entry = {
			type = je_maintain_afghan_protectorate
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_secure_influence_over_persia_ai_var
			}
			has_interest_marker_in_region = region_persia
		}
		set_variable = je_secure_influence_over_persia_ai_var
		add_journal_entry = {
			type = je_secure_influence_over_persia
		}
	}
	### Specific Objectives
	if = {
		limit = {
			NOT = {
				has_variable = je_disrupt_russian_caucasus_ai_var
			}
			exists = c:CIR
		}
		set_variable = je_disrupt_russian_caucasus_ai_var
		add_journal_entry = {
			type = je_disrupt_russian_caucasus
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_counter_russian_pacific_influence_ai_var
			}
			c:RUS ?= {
				any_scope_state = {
					region = sr:region_manchuria
					OR = {
						any_scope_building = {
							is_building_type = building_port
							level >= 5
						}
						any_scope_building = {
							is_building_type = building_naval_base
							level >= 15
						}
					}
				}
			}
		}
		set_variable = je_counter_russian_pacific_influence_ai_var
		add_journal_entry = {
			type = je_counter_russian_pacific_influence
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_consolidate_british_india_ai_var
			}
			c:BIC ?= {
				is_subject_of = c:GBR
			}
		}
		set_variable = je_consolidate_british_india_ai_var
		add_journal_entry = {
			type = je_consolidate_british_india
		}
	}
	if = {
		limit = {
			NOT = {
				has_variable = je_pamir_expedition_objective_ai_var
			}
			c:RUS ?= {
				OR = {
					any_scope_state = {
						state_region = s:STATE_TAJIKISTAN
					}
					any_subject_or_below = {
						any_scope_state = {
							state_region = s:STATE_TAJIKISTAN
						}
					}
				}
			}
			NOT = {
				has_variable = dismissed_pamir_expedition
			}
		}
		set_variable = je_pamir_expedition_objective_ai_var
		add_journal_entry = {
			type = je_pamir_expedition_objective
		}
	}
}

assign_afghanistan_ai_great_game_objectives = {
	### Generic Objectives
	if = {
		limit = {
			NOT = {
				has_variable = je_achieve_sovereignty_ai_var
			}
			is_country_type = unrecognized
		}
		set_variable = je_achieve_sovereignty_ai_var
		add_journal_entry = {
			type = je_achieve_sovereignty
		}
	}
	### Specific Objectives
	if = {
		limit = {
			NOT = {
				has_variable = je_unify_afghanistan_objective_ai_var
			}
		}
		set_variable = je_unify_afghanistan_objective_ai_var
		add_journal_entry = {
			type = je_unify_afghanistan_objective
		}
	}
}

assign_persia_ai_great_game_objectives = {
	### Generic Objectives
	if = {
		limit = {
			NOT = {
				has_variable = je_achieve_sovereignty_ai_var
			}
			is_country_type = unrecognized
		}
		set_variable = je_achieve_sovereignty_ai_var
		add_journal_entry = {
			type = je_achieve_sovereignty
		}
	}
	### Specific Objectives
	if = {
		limit = {
			NOT = {
				has_variable = je_consolidate_persia_ai_var
			}
		}
		set_variable = je_consolidate_persia_ai_var
		add_journal_entry = {
			type = je_consolidate_persia
		}
	}
}
