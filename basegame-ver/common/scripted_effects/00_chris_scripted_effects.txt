end_raiding_cleanup = { #Used to cleanup effects of je_montenegrin_raiding
	custom_tooltip = {
		text = montenegrin_raiding_stop_tt
		remove_modifier = modifier_montenegrin_raiding
		remove_modifier = modifier_montenegrin_disobedience
	}
	hidden_effect = {
		c:RUS ?= {
			remove_diplomatic_pact = {
				country = root
				type = disapproval_pact
			}
		}
		c:TUR ?= {
			remove_diplomatic_pact = {
				country = root
				type = raiding_pact
			}
		}
	}
	hidden_effect = {
		every_neighbouring_state = {
			if = {
				limit = {
					has_modifier = raid_target
				}
				remove_modifier = raid_target
			}
		}
	}
}

mon_failure_events = {
	hidden_effect = {
		if = {
			limit = {
				is_subject_of = c:TUR
			}
			trigger_event = {
				id = mon_state_formation.17
			}
		}
		else_if = {
			limit = {
				has_variable = mon_are_barbarians 
			}
			post_notification = je_mon_austria_alliance_fail
		}
		else = {
			trigger_event = {
				id = mon_state_formation.16
				popup = yes
			}
		}
	}
}

russia_breaks_independence_pact = {
	if = {
		limit = {
			exists = c:MON
			c:RUS ?= {
				any_scope_treaty = {
					binds = c:MON
					any_scope_article = {
						has_type = guarantee_independence
					}
				}
			}
		}
		custom_tooltip = {
			text = russia_no_longer_guarantor_tt
			c:RUS ?= {
				every_scope_treaty = {
					limit = {
						binds = c:MON
						any_scope_article = {
							has_type = guarantee_independence
						}
					}
					withdraw = {
						country = c:RUS
					}
				}
			}
		}
	}
}

increase_raiding = { #increases raiding intensity, if valid
	if = {
		limit = {
			has_journal_entry = je_montenegrin_raiding
			var:raiding_intensity < 100
		}
		custom_tooltip = {
			text = mon_more_heads_tt
			change_variable = {
				name = raiding_intensity
				add = 25
			}
			remove_modifier = modifier_montenegrin_raiding
			add_modifier = {
				name = modifier_montenegrin_raiding
				multiplier = raiding_income
			}
			remove_modifier = modifier_montenegrin_disobedience
			add_modifier = {
				name = modifier_montenegrin_disobedience
				multiplier = var:raiding_intensity
			}
		}
	}
}

generate_ottoman_side_list = {
	clear_global_variable_list = ottoman_side_list
	if = {
		limit = {
			exists = c:TUR
		}
		c:TUR ?= {
			add_to_global_variable_list = {
				name = ottoman_side_list
				target = THIS
			}
			every_country = { #add allies
				limit = {
					NOT = {
						this = c:TUR
					}
					OR = {
						is_subject_of = c:TUR
						any_scope_treaty = {
							binds = c:TUR
							any_scope_article = {
								OR = {
									has_type = alliance
									has_type = defensive_pact
								}
							}
						}
					}
				}
				save_temporary_scope_as = potential_tur_ally
				##extra checks, this not also allied to Balkan League. 
				if = {
					limit = {
						NOT = {	#checking no already on list		
							is_target_in_global_variable_list = {
								name = ottoman_side_list
								target = scope:potential_tur_ally
							}
						}
						NOT = {	#checking not on Balkan list		
							is_target_in_global_variable_list = {
								name = balkan_league_side_list
								target = scope:potential_tur_ally
							}
						}
						NOT = { #not Balkan ally
							any_in_global_list = { 
								variable = balkan_league_side_list
								save_temporary_scope_as = balkan_league_member
								any_scope_treaty = {
									binds = scope:potential_tur_ally 
									any_scope_article = {
										OR = {
											has_type = alliance
											AND = {
												has_type = support_independence
												target_country = scope:balkan_league_member
											}
										}
									}
								}
							}
						}
					}
					add_to_global_variable_list = {
						name = ottoman_side_list
						target = THIS
					}
				}
			}
		}
	}
}	

generate_balkan_league_side_list = {
	clear_global_variable_list = balkan_league_side_list
	every_country = {
		limit = {
			has_journal_entry = je_the_balkan_league
		}
		save_temporary_scope_as = balkan_league_member
		if = {
			limit = {
				NOT = { #just in case already added
					is_target_in_global_variable_list = {
						name = balkan_league_side_list
						target = THIS
					}
				}
			}
			add_to_global_variable_list = {
				name = balkan_league_side_list
				target = THIS
			}
		} 
		every_country = {
			limit = {
				NOR = { #not above, not already counted
					this = scope:balkan_league_member
					is_target_in_global_variable_list = {
						name = balkan_league_side_list
						target = THIS
					}
				}
				any_scope_treaty = {
					binds = scope:balkan_league_member
					any_scope_article = {
						OR = {
							has_type = alliance
							AND = {
								has_type = support_independence
								target_country = scope:balkan_league_member
							}
						}
					}
				}
				NOT = { #not if also Turk ally
					any_scope_treaty = {
						binds = c:TUR
						any_scope_article = {
							OR = {
								has_type = alliance
								has_type = defensive_pact
							}
						}
					} 
				} 
			}
			add_to_global_variable_list = {
				name = balkan_league_side_list
				target = THIS
			}
		}
	}
}

transfer_province = { # Changes ownership of PROVINCE(here use ID number without p:, eg xF5F6C2) from GIVER to TAKER countries (e.g. c:TUR). Automatically checks GIVER owns the state.
	if = {
		limit = {
			exists = $GIVER$
			exists = $TAKER$
			$TAKER$ != $GIVER$
			p:$PROVINCE$  = {
				$GIVER$ ?= state.owner
			}
		}
		p:$PROVINCE$.state.state_region = {
			set_owner_of_provinces = {
				country = $TAKER$
				provinces = { $PROVINCE$ }
			}
		}
	}
}

transfer_state = { # Changes ownership of any state within a STATE region (e.g. s:STATE_MONTENEGRO) from GIVER to TAKER countries (e.g. c:TUR). Automatically checks GIVER exists and owns the state.
	if = {
		limit = {
			exists = $GIVER$
			exists = $TAKER$
			$TAKER$ != $GIVER$
			$STATE$ = {
				any_scope_state = {
					$GIVER$ = owner
				}
			}
		}
		$STATE$ = {
			every_scope_state = {
				limit = {
					owner = $GIVER$
				}
				set_state_owner = $TAKER$
			}
		}
	}
}

balkan_war_give_tech = { # if c:TUR has $TECH$, and root doesn't, instant research it. Includes an else_if
	if = {
		limit = {
			c:TUR ?= {
				has_technology_researched = $TECH$
			}
			root = {
				NOT = {
					has_technology_researched = $TECH$
				}
			}
		}
		root = {
			add_technology_researched = $TECH$
			set_variable = {
				name = balkan_got_tech_cooldown
				years = 5
			} 
		}
	}
}

balkan_war_even_tech = {
	balkan_war_give_tech = {
		TECH = line_infantry
	}
	balkan_war_give_tech = {
		TECH = napoleonic_warfare
	}
	balkan_war_give_tech = {
		TECH = army_reserves
	}
	balkan_war_give_tech = {
		TECH = field_works
	}
	balkan_war_give_tech = {
		TECH = percussion_cap
	}
	balkan_war_give_tech = {
		TECH = rifling
	}
	balkan_war_give_tech = {
		TECH = triage
	}
	balkan_war_give_tech = {
		TECH = general_staff
	}
	balkan_war_give_tech = {
		TECH = modern_nursing
	}
	balkan_war_give_tech = {
		TECH = enlistment_offices
	}
	balkan_war_give_tech = {
		TECH = electric_telegraph
	}
	balkan_war_give_tech = {
		TECH = repeaters
	}
	balkan_war_give_tech = {
		TECH = handcranked_machine_gun
	}
	balkan_war_give_tech = {
		TECH = military_statistics
	}
	balkan_war_give_tech = {
		TECH = modern_nursing
	}
	balkan_war_give_tech = {
		TECH = bolt_action_rifles
	}
	balkan_war_give_tech = {
		TECH = automatic_machine_guns
	}
	balkan_war_give_tech = {
		TECH = trench_works
	}
	balkan_war_give_tech = {
		TECH = war_propaganda
	}
	balkan_war_give_tech = {
		TECH = wargaming
	}
	balkan_war_give_tech = {
		TECH = defense_in_depth
	}
	balkan_war_give_tech = { #era 5
		TECH = nco_training
	}
	balkan_war_give_tech = {
		TECH = chemical_warfare
	}
	balkan_war_give_tech = {
		TECH = stormtroopers
	}
	balkan_war_give_tech = {
		TECH = concrete_fortifications
	}
	balkan_war_give_tech = {
		TECH = military_aviation
	}
	balkan_war_give_tech = {
		TECH = flamethrowers
	}
	balkan_war_give_tech = {
		TECH = mobile_armor
	}
}

destroy_barracks = { #Used to destroy and rebuild barracks in montenegrin_raiding.1 and montenegrin_raiding.2
	custom_tooltip = {
		text = mon_lost_men_tt
		save_temporary_scope_value_as = {
			name = barracks_amount
			value = barracks_levels_to_leave_unburned
		}
		random_scope_state = {
			limit = {
				state_region = s:STATE_MONTENEGRO
			}
			remove_building = building_barracks
			create_building = {
				building = "building_barracks"
				level = scope:barracks_amount
					reserves = 1
			}
		}
	}
}

eastern_crisis_2_event_effects = {
	c:TUR ?= {
		add_modifier = {
			name = eastern_crisis_controlled
			days = moderately_long_modifier_time
		}
		every_country = {
			limit = {
				is_subject_of = root
				OR = {
					capital.region = sr:region_balkans
					has_interest_marker_in_region = region_balkans
				}
			}
			c:TUR.power_bloc ?= {
				add_leverage = { target = PREV value = 250 }
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:albanian
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:albanian
				days = very_long_modifier_time
				multiplier = eastern_crisis_fervor_loss
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:bosniak
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:bosniak
				days = very_long_modifier_time
				multiplier = eastern_crisis_fervor_loss
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:bulgarian
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:bulgarian
				days = very_long_modifier_time
				multiplier = eastern_crisis_fervor_loss
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:croat
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:croat
				days = very_long_modifier_time
				multiplier = eastern_crisis_fervor_loss
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:greek
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:greek
				days = very_long_modifier_time
				multiplier = eastern_crisis_fervor_loss
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:romanian
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:romanian
				days = very_long_modifier_time
				multiplier = eastern_crisis_fervor_loss
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:serb
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:serb
				days = very_long_modifier_time
				multiplier = eastern_crisis_fervor_loss
			}
		}
	}
}

eastern_crisis_3_event_effects = {
	c:TUR ?= {
		add_modifier = {
			name = eastern_crisis_not_controlled
			days = moderately_long_modifier_time
		}
		if = {
			limit = {
				any_country = {
					OR = {
						is_subject_of = root
						capital.region = sr:region_balkans
					}
				}
			}
			custom_tooltip = {
				text = eastern_crisis_subjects_modifier__ten_years_tt
			}
			every_country = {
				limit = {
					OR = {
						is_subject_of = root
						capital.region = sr:region_balkans
					}
				}
				hidden_effect = { #covered by custom tooltip above
					add_modifier = {
						name = eastern_crisis_liberty_desire_increase
						days = long_modifier_time
						is_decaying = yes
					}
				}
			}
		}

		if = { #lose leverage
			limit = {
				exists = c:TUR.power_bloc
			}
			every_country = {
				limit = {
					capital.region = sr:region_balkans
				}
				c:TUR.power_bloc ?= {
					add_leverage = { target = PREV value = -500 }
				}
			}
		}

		if = {
			limit = {
				any_political_movement = {
					OR = {
						is_political_movement_type = movement_religious_majority
						is_political_movement_type = movement_religious_minority
						is_political_movement_type = movement_cultural_majority
						is_political_movement_type = movement_cultural_minority
					}
				}
			}
			every_political_movement = {
				limit = {
					OR = {
						is_political_movement_type = movement_religious_majority
						is_political_movement_type = movement_religious_minority
						is_political_movement_type = movement_cultural_majority
						is_political_movement_type = movement_cultural_minority
					}
				}
				add_modifier = {
					name = eastern_crisis_movement_attraction
					days = long_modifier_time
					is_decaying = yes
				}
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:albanian
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:albanian
				multiplier = eastern_crisis_fervor_gain
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:bosniak
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:bosniak
				multiplier = eastern_crisis_fervor_gain
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:bulgarian
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:bulgarian
				multiplier = eastern_crisis_fervor_gain
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:croat
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:croat
				multiplier = eastern_crisis_fervor_gain
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:greek
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:greek
				multiplier = eastern_crisis_fervor_gain
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:romanian
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:romanian
				multiplier = eastern_crisis_fervor_gain
			}
		}
		if = {
			limit = {
				any_scope_pop = {
					culture = cu:serb
				}
			}
			add_fervor_target_modifier = { #changes target
				culture = cu:serb
				multiplier = eastern_crisis_fervor_gain
			}
		}
	}
}
