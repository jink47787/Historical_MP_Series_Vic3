je_struggle_for_the_highveld = {
	icon = "gfx/interface/icons/invention_icons/nationalism.dds"

	group = je_group_historical_content

	scripted_button = saf_highveld_add_boer_as_primary_button
	scripted_button = saf_highveld_add_griqua_as_primary_button
	scripted_button = highveld_offer_boer_confederation_button
	scripted_button = highveld_offer_griqua_confederation_button

	is_shown_when_inactive = {
	}

	possible = {
	}

	is_shown_in_lobby = {
		capital = {
			is_in_geographic_region = geographic_region_south_africa
		}
		OR = {
			c:SAF ?= this
			any_primary_culture = {
				OR = {
					cu:boer = this
					has_discrimination_trait = heritage_southern_bantu
				}
			}
		}
		NOT = { is_country_type = decentralized }
	}

	immediate = {
		c:SAF ?= {
			save_scope_as = cape_colony_scope
		}
		cu:boer = {
			save_scope_as = boer_culture
		}
		cu:griqua = {
			save_scope_as = griqua_culture
		}
	}

	on_weekly_pulse = {
	}

	on_monthly_pulse = {
	}

	on_yearly_pulse = {
		random_events = {
			30 = 0
			80 = struggle_for_the_highveld.1 # The Battle of Vegkop
			50 = struggle_for_the_highveld.3 # The Natal Cession
			50 = struggle_for_the_highveld.5 # Blood River
		}
	}

	complete = {
		# Cape Colony must exert direct or indirect control over all of IRL South Africa and Swaziland and Lesotho
		trigger_if = {
			limit = {
				c:SAF ?= this
			}

			# Every other country with a capital in South Africa must either be a subject of Cape or of Cape's top overlord
			# But Cape /can/ be a subject and complete this
			custom_tooltip = {
				text = je_struggle_for_the_highveld_saf_success

				NOT = {
					any_state_region = {
						is_in_geographic_region = geographic_region_south_africa

						any_scope_state = {
							owner = {
								capital ?= {
									is_in_geographic_region = geographic_region_south_africa
								}
								NOR = {
									c:SAF ?= this
									is_country_type = decentralized
									is_subject_of = c:SAF
									AND = {
										c:SAF ?= { is_subject = yes }
										is_subject_of = c:SAF.top_overlord
									}
								}
							}
						}
					}
				}
			}
		}
		trigger_else = {
			# Both Boer and Southern Bantu states must become recognized to complete the JE, be independent, and have access to the sea

			is_country_type = recognized
			is_subject = no
			any_scope_state = {
				is_incorporated = yes
				is_coastal = yes
			}
		}
	}

	on_complete = {
		if = {
			limit = {
				c:SAF ?= this

				# Every other country with a capital in South Africa must either be a subject of Cape or of Cape's top overlord
				# But Cape /can/ be a subject and complete this
				custom_tooltip = {
					text = je_struggle_for_the_highveld_saf_success

					NOT = {
						any_state_region = {
							is_in_geographic_region = geographic_region_south_africa

							any_scope_state = {
								owner = {
									NOR = {
										c:SAF = this
										is_country_type = decentralized
									}
									capital ?= {
										NOT = { is_in_geographic_region = geographic_region_south_africa }
									}
									NOR = {
										is_subject_of = ROOT
										AND = {
											ROOT = { is_subject = yes }
											is_subject_of = ROOT.top_overlord
										}
									}
								}
							}
						}
					}
				}
			}
		}

		set_variable = highest_on_highveld

		show_as_tooltip = {
			if = {
				limit = { NOT = { owns_entire_state_region = STATE_NORTHERN_CAPE } }
				s:STATE_NORTHERN_CAPE = { add_claim = root }
			}
			if = {
				limit = { NOT = { owns_entire_state_region = STATE_CAPE_COLONY } }
				s:STATE_CAPE_COLONY = { add_claim = root }
			}
			if = {
				limit = { NOT = { owns_entire_state_region = STATE_EASTERN_CAPE } }
				s:STATE_EASTERN_CAPE = { add_claim = root }
			}
			if = {
				limit = { NOT = { owns_entire_state_region = STATE_VRYSTAAT } }
				s:STATE_VRYSTAAT = { add_claim = root }
			}
			if = {
				limit = { NOT = { owns_entire_state_region = STATE_TRANSVAAL } }
				s:STATE_TRANSVAAL = { add_claim = root }
			}
			if = {
				limit = { NOT = { owns_entire_state_region = STATE_ZULULAND } }
				s:STATE_ZULULAND = { add_claim = root }
			}
		}
		trigger_event = { id = struggle_for_the_highveld.6 }
	}

	fail = {
		# Fail conditions are actually set by one country doing the complete conditions above. These tooltips sum up the other combinations of completion states, and then have an always = no line so it looks like they haven't been achieved yet.

		# If any other country completes the JE, then you fail.

		trigger_if = {
			limit = {
				c:SAF ?= ROOT
			}
			exists = c:ZUL
			custom_tooltip = {
				text = je_struggle_for_the_highveld_saf_fail
				exists = c:ZUL
				OR = {
					c:ORA ?= { has_variable = highest_on_highveld }
					c:TRN ?= { has_variable = highest_on_highveld }
					c:NAL ?= { has_variable = highest_on_highveld }
					c:WBL ?= { has_variable = highest_on_highveld }
					c:PHL ?= { has_variable = highest_on_highveld }
					c:ZUL ?= { has_variable = highest_on_highveld }
					c:BST ?= { has_variable = highest_on_highveld }
					c:SWZ ?= { has_variable = highest_on_highveld }
				}
			}
		}

		# if SAF exists and ROOT is not SAF, then show the more complicated tooltips
		trigger_if = {
			limit = {
				exists = c:SAF
				NOT = { c:SAF = ROOT }
			}
			OR = {
				custom_tooltip = {
					text = je_struggle_for_the_highveld_saf_wins_everyone_else_fail
					c:SAF ?= { has_variable = highest_on_highveld }
				}

				custom_tooltip = {
					text = je_struggle_for_the_highveld_anyone_else_wins_everyone_else_fail
					NOT = { has_variable = highest_on_highveld }
					OR = {
						c:ORA ?= { has_variable = highest_on_highveld }
						c:TRN ?= { has_variable = highest_on_highveld }
						c:NAL ?= { has_variable = highest_on_highveld }
						c:WBL ?= { has_variable = highest_on_highveld }
						c:PHL ?= { has_variable = highest_on_highveld }
						c:ZUL ?= { has_variable = highest_on_highveld }
						c:BST ?= { has_variable = highest_on_highveld }
						c:SWZ ?= { has_variable = highest_on_highveld }
					}
				}
			}
		}
	}

	on_fail = {
		if = {
			limit = {
				c:SAF ?= this
			}
			show_as_tooltip = {
				c:SAF ?= { remove_primary_culture = cu:boer }
				c:SAF ?= { remove_primary_culture = cu:griqua }
			}
		}

		show_as_tooltip = {
			if = {
				limit = { root = { has_claim = s:STATE_NORTHERN_CAPE } }
				s:STATE_NORTHERN_CAPE = { remove_claim = root }
			}
			if = {
				limit = { root = { has_claim = s:STATE_CAPE_COLONY } }
				s:STATE_CAPE_COLONY = { remove_claim = root }
			}
			if = {
				limit = { root = { has_claim = s:STATE_EASTERN_CAPE } }
				s:STATE_EASTERN_CAPE = { remove_claim = root }
			}
			if = {
				limit = { root = { has_claim = s:STATE_VRYSTAAT } }
				s:STATE_VRYSTAAT = { remove_claim = root }
			}
			if = {
				limit = { root = { has_claim = s:STATE_TRANSVAAL } }
				s:STATE_TRANSVAAL = { remove_claim = root }
			}
			if = {
				limit = { root = { has_claim = s:STATE_ZULULAND } }
				s:STATE_ZULULAND = { remove_claim = root }
			}
		}
		trigger_event = { id = struggle_for_the_highveld.7 }
	}

	weight = 100

	should_be_pinned_by_default = yes
}
