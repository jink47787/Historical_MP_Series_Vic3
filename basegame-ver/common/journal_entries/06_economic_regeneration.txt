je_spa_economic_regeneration_master = {
    icon = "gfx/interface/icons/event_icons/event_industry.dds"

    group = je_group_spa_economic_regeneration

    is_shown_in_lobby = {
        OR = {
            c:SPA ?= this
            c:SPC ?= this
			was_formed_from = SPA
        }
        has_dlc_feature = ip4_content
    }

    is_shown_when_inactive = {
        has_dlc_feature = ip4_content
        OR = {
            c:SPA ?= this
			was_formed_from = SPA
        }
    }

    scripted_button = je_spa_economic_regeneration_reduce_economic_objectives_button

    status_desc = {
        first_valid = {
            triggered_desc = {
                desc = je_spa_economic_regeneration_master_status_loc_blank
                trigger = {
                    NOT = {
                        has_journal_entry = je_spa_economic_regeneration_master
                    }
                }
            }
            triggered_desc = {
                desc = je_spa_economic_regeneration_master_status_loc
                trigger = {
                    has_journal_entry = je_spa_economic_regeneration_master
                }
            }
        }
    }

    timeout = 7200

    possible = {
        trigger_if = {
            limit = {
                NOT = {
                    has_variable = je_spa_economic_regeneration_master_started_var
                }
            }
            has_technology_researched = nationalism
        }
        trigger_else_if = {
            limit = {
                has_variable = je_spa_economic_regeneration_master_started_var
            }
            NOT = {
                has_modifier = modifier_economic_regeneration_postponed
            }
            hidden_trigger = {
                NOT = {
                    has_variable = je_spa_economic_regeneration_master_completed_var
                }
            }
            has_technology_researched = nationalism
        }
        has_technology_researched = railways
        has_technology_researched = improved_fertilizer
    }

    immediate = {
        set_variable = je_spa_economic_regeneration_master_started_var
        set_variable = {
            name = spa_economic_regeneration_var
            value = 0
        }
        set_variable = {
            name = spa_economic_regeneration_goal_var
            value = 6
        }
        if = {
            limit = {
                NOT = {
                    has_variable = economic_regeneration_postponed_var
                }
            }
            trigger_event = {
                id = spa_economic_regeneration_events.1
                popup = yes
            }
        }
        else = {
            trigger_event = {
                id = spa_economic_regeneration_events.4
                popup = yes
            }
        }
    }

    can_deactivate = yes

    on_monthly_pulse = {
    }

    invalid = {
        has_modifier = modifier_economic_regeneration_postponed
    }

    complete = {
        hidden_trigger = {
            exists = var:spa_economic_regeneration_goal_var
        }
        trigger_if = {
            limit = {
                exists = var:spa_economic_regeneration_var
            }
            trigger_if = {
                limit = {
                    NOT = {
                        has_variable = reduced_economic_objectives_var
                    }
                }
                custom_tooltip = {
                    text = je_spa_economic_regeneration_master_completion_tt_1
                    var:spa_economic_regeneration_var >= var:spa_economic_regeneration_goal_var
                }
            }
            trigger_if = {
                limit = {
                    has_variable = reduced_economic_objectives_var
                }
                custom_tooltip = {
                    text = je_spa_economic_regeneration_master_completion_tt_2
                    var:spa_economic_regeneration_var >= var:spa_economic_regeneration_goal_var
                }
            }
        }
        trigger_else_if = {
            limit = {
                NOT = {
                    exists = var:spa_economic_regeneration_var
                }
            }
            custom_tooltip = {
                text = je_spa_economic_regeneration_master_completion_tt_1
                always = no
            }
        }
    }

    event_outcome_completed_effect_desc = {
        header = spa_economic_regeneration_events.5.a
        effect = {
            if = {
                limit = {
                    NOT = {
                        has_variable = reduced_economic_objectives_var
                    }
                }
                add_modifier = {
                    name = modifier_economic_regeneration_reward_greater
			        days = very_long_modifier_time
                    is_decaying = yes
                }
                ruler = {
                    add_modifier = {
                        name = modifier_great_reformer
                    }
                }
                active_law:lawgroup_economic_system ?= {
                    add_amendment = {
                        type = amendment_economic_regeneration_1
                        sponsor = PREV.ig:ig_industrialists
                        cooldown = 240
                    }
                }
            }
            else_if = {
                limit = {
                    has_variable = reduced_economic_objectives_var
                }
                add_modifier = {
                    name = modifier_economic_regeneration_reward_lesser
			        days = very_long_modifier_time
                    is_decaying = yes
                }
                ruler = {
                    add_modifier = {
                        name = modifier_capable_reformer
                    }
                }
                active_law:lawgroup_economic_system ?= {
                    add_amendment = {
                        type = amendment_economic_regeneration_2
                        sponsor = PREV.ig:ig_industrialists
                        cooldown = 240
                    }
                }
            }
        }
    }

    on_complete = {
        set_variable = je_spa_economic_regeneration_master_completed_var
        trigger_event = {
            id = spa_economic_regeneration_events.5
            popup = yes
        }
    }

    event_outcome_timeout_effect_desc = {
        header = spa_economic_regeneration_events.6.a
        effect = {
            if = {
                limit = {
                    exists = var:spa_economic_regeneration_var
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = reduced_economic_objectives_var
                        }
                    }
                    if = {
                        limit = {
                            var:spa_economic_regeneration_var >= 4
                        }
                        add_modifier = {
                            name = modifier_failed_economic_regeneration
                            days = long_modifier_time
                            multiplier = 0.5
                        }
                    }
                    else = {
                        add_modifier = {
                            name = modifier_failed_economic_regeneration
                            days = long_modifier_time
                        }
                    }
                }
                else_if = {
                    limit = {
                        has_variable = reduced_economic_objectives_var
                    }
                    if = {
                        limit = {
                            var:spa_economic_regeneration_var >= 2
                        }
                        add_modifier = {
                            name = modifier_failed_economic_regeneration
                            days = long_modifier_time
                            multiplier = 0.5
                        }
                        custom_tooltip = je_spa_economic_regeneration_master_timeout_tt_2
                    }
                    else = {
                        add_modifier = {
                            name = modifier_failed_economic_regeneration
                            days = long_modifier_time
                        }
                    }
                }
            }
            else = {
                add_modifier = {
                    name = modifier_failed_economic_regeneration
                    days = long_modifier_time
                }
            }
        }
    }

    on_timeout = {
        set_variable = je_spa_economic_regeneration_master_completed_var
        trigger_event = {
            id = spa_economic_regeneration_events.6
            popup = yes
        }
    }

    on_fail = {
        set_variable = je_spa_economic_regeneration_master_completed_var
    }

    weight = 100

    should_be_pinned_by_default = yes
}

je_spa_economic_regeneration_mining = {
    icon = "gfx/interface/icons/invention_icons/prospecting_tech.dds"

    group = je_group_spa_economic_regeneration

    scripted_button = je_spa_economic_regeneration_cheat_button

    possible = {
    }

    immediate = {
        s:STATE_ASTURIAS = {
            save_scope_as = asturias_scope
        }
        s:STATE_BASQUE_COUNTRY = {
            save_scope_as = basque_country_scope
        }
        s:STATE_LOWER_ANDALUSIA = {
            save_scope_as = lower_andalusia_scope
        }
    }

    on_monthly_pulse = {

    }

    complete = {
        trigger_if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            OR = {
                leading_producer_of = g:iron
                leading_producer_of = g:lead
                leading_producer_of = g:coal
                leading_producer_of = g:sulfur
            }
            country_has_building_group_levels = {
                type = bg_mining
                value  >= 40
            }
        }
        trigger_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            country_has_building_group_levels = {
                type = bg_mining
                value  >= 20
            }
        }
    }
    on_complete = {
        change_variable = {
            name = spa_economic_regeneration_var
            add = 1
        }
        trigger_event = {
            id = spa_economic_regeneration_events.3
            popup = yes
        }
        if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            custom_tooltip = je_spa_economic_regeneration_mining_upgrade_state_trait_tt_1
            show_as_tooltip = {
                add_modifier = {
                    name = modifier_spa_mineral_boom
                    days = long_modifier_time
                }
            }
            set_variable = je_spa_economic_regeneration_mining_success_var
        }
        else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            custom_tooltip = je_spa_economic_regeneration_mining_upgrade_state_trait_tt_2
            show_as_tooltip = {
                add_modifier = {
                    name = modifier_spa_mineral_boom
                    days = normal_modifier_time
                    multiplier = 0.5
                }
            }
        }
    }

    fail = {
        OR = {
            NOT = {
                has_journal_entry = je_spa_economic_regeneration_master
            }
            NOT = {
                has_state_in_state_region = STATE_BASQUE_COUNTRY
                has_state_in_state_region = STATE_ASTURIAS
                has_state_in_state_region = STATE_LOWER_ANDALUSIA
                has_state_in_state_region = STATE_MURCIA
            }
        }
    }

    on_fail = {
        add_modifier = {
            name = modifier_mineral_investment_dearth
            days = normal_modifier_time
        }
    }

    weight = 100

    should_be_pinned_by_default = yes
}

je_spa_economic_regeneration_light_industry = {
    icon = "gfx/interface/icons/invention_icons/manufacturies.dds"

    group = je_group_spa_economic_regeneration

    scripted_button = je_spa_economic_regeneration_cheat_button

    possible = {
    }

    immediate = {
    }

    on_monthly_pulse = {

    }

    complete = {
        trigger_if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            any_scope_state = {
                OR = {
                    state_has_building_group_levels = {
                        type = bg_light_industry
                        value >= 16
                    }
                    state_has_building_group_levels = {
                        type = bg_heavy_industry
                        value >= 8
                    }
                    state_has_building_group_levels = {
                        type = bg_military_industry
                        value >= 8
                    }
                }
                count >= 4
            }
            any_company = {
                company_is_prosperous = yes
                count >= 2
            }
        }
        trigger_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            country_has_building_group_levels = {
                type = bg_mining
                value  >= 20
            }
            any_scope_state = {
                OR = {
                    state_has_building_group_levels = {
                        type = bg_light_industry
                        value >= 7
                    }
                    state_has_building_group_levels = {
                        type = bg_heavy_industry
                        value >= 4
                    }
                    state_has_building_group_levels = {
                        type = bg_military_industry
                        value >= 4
                    }
                }
                count >= 4
            }
            any_company = {
                company_is_prosperous = yes
            }
        }
    }
    on_complete = {
        change_variable = {
            name = spa_economic_regeneration_var
            add = 1
        }
        if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            ig:ig_industrialists ?= {
                add_modifier = {
                    name = modifier_facilitated_manufacturing_boom
                    days = long_modifier_time
                }
            }
            show_as_tooltip = {
                custom_tooltip = {
                    text = every_state_following_requirements_tt
                }
                ordered_scope_state = {
                    order_by = gdp
					position = 0
					check_range_bounds = no
                    add_modifier = {
                        name = modifier_manufactoring_boom
                        days = long_modifier_time
                    }
                }
            }
            hidden_effect = {
                every_scope_state = {
                    limit = {
                        OR = {
                            state_has_building_group_levels = {
                                type = bg_light_industry
                                value >= 16
                            }
                            state_has_building_group_levels = {
                                type = bg_heavy_industry
                                value >= 8
                            }
                            state_has_building_group_levels = {
                                type = bg_military_industry
                                value >= 8
                            }
                        }
                    }
                    add_modifier = {
                        name = modifier_manufactoring_boom
                        days = long_modifier_time
                    }
                }
            }
        }
        else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            ig:ig_industrialists ?= {
                add_modifier = {
                    name = modifier_facilitated_manufacturing_boom
                    days = normal_modifier_time
                    multiplier = 0.5
                }
            }
            show_as_tooltip = {
                custom_tooltip = every_state_following_requirements_tt
                ordered_scope_state = {
                    order_by = gdp
					position = 0
					check_range_bounds = no
                    add_modifier = {
                        name = modifier_manufactoring_boom
                        days = normal_modifier_time
                        multiplier = 0.5
                    }
                }
            }
            hidden_effect = {
                every_scope_state = {
                    limit = {
                        OR = {
                            state_has_building_group_levels = {
                                type = bg_light_industry
                                value >= 7
                            }
                            state_has_building_group_levels = {
                                type = bg_heavy_industry
                                value >= 4
                            }
                            state_has_building_group_levels = {
                                type = bg_military_industry
                                value >= 4
                            }
                        }
                    }
                    add_modifier = {
                        name = modifier_manufactoring_boom
                        days = normal_modifier_time
                    }
                }
            }
        }
    }

    fail = {
        OR = {
            NOT = {
                has_journal_entry = je_spa_economic_regeneration_master
            }
        }
    }

    on_fail = {
        add_modifier = {
            name = modifier_industrial_investment_dearth
            days = normal_modifier_time
        }
    }

    weight = 100

    should_be_pinned_by_default = yes
}

je_spa_economic_regeneration_land_reform = {
    icon = "gfx/interface/icons/invention_icons/bureaucracy.dds"

    group = je_group_spa_economic_regeneration

    scripted_button = je_spa_economic_regeneration_cheat_button

    possible = {
    }

    immediate = {
        ig:ig_landowners ?= {
            save_scope_as = landowners_scope
        }
    }

    on_monthly_pulse = {

    }

    complete = {
        trigger_if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            any_scope_state = {
                state_region = {
                    is_homeland = cu:spanish
                }
                average_sol > 15
                count >= 12
            }
            OR = {
                AND = {
                    NOR = {
                        has_law = law_type:law_latifundias
                        has_law = law_type:law_serfdom
                    }
                    ig:ig_landowners ?= {
                        is_in_government = no
                    }
                    government_legitimacy > 75
                }
                AND = {
                    OR = {
                        has_law = law_type:law_latifundias
                        has_law = law_type:law_serfdom
                    }
                    ig:ig_landowners ?= {
                        is_in_government = yes
                        is_strongest_ig_in_government = yes
                    }
                    government_legitimacy > 75
                }
            }
        }
        trigger_else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            any_scope_state = {
                state_region = {
                    is_homeland = cu:spanish
                }
                average_sol > 10
                count >= 12
            }
            OR = {
                AND = {
                    NOR = {
                        has_law = law_type:law_latifundias
                        has_law = law_type:law_serfdom
                    }
                    ig:ig_landowners ?= {
                        is_in_government = no
                    }
                    government_legitimacy > 50
                }
                AND = {
                    OR = {
                        has_law = law_type:law_latifundias
                        has_law = law_type:law_serfdom
                    }
                    ig:ig_landowners ?= {
                        is_in_government = yes
                        is_strongest_ig_in_government = yes
                    }
                    government_legitimacy > 50
                }
            }
        }
    }
    on_complete = {
        change_variable = {
            name = spa_economic_regeneration_var
            add = 1
        }
        if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            show_as_tooltip = {
                custom_tooltip = {
                    text = je_spa_economic_regeneration_land_reform_tt_1
                }
                add_modifier = {
                    name = modifier_entrepreneurial_latifundistas
                    days = very_long_modifier_time
                }
                activate_law = law_type:law_expanded_latifundias
                custom_tooltip = {
                    text = je_spa_economic_regeneration_land_reform_tt_2
                }
                add_modifier = {
                    name = modifier_marginalized_latifundistas
                    days = very_long_modifier_time
                }
            }
            hidden_effect = {
                if = {
                    limit = {
                        NOR = {
                            has_law = law_type:law_latifundias
                            has_law = law_type:law_serfdom
                        }
                        ig:ig_landowners ?= {
                            is_in_government = no
                        }
                        government_legitimacy > 75
                    }
                    add_modifier = {
                        name = modifier_marginalized_latifundistas
                        days = very_long_modifier_time
                    }
                }
                else_if = {
                    limit = {
                        OR = {
                            has_law = law_type:law_latifundias
                            has_law = law_type:law_serfdom
                        }
                        ig:ig_landowners ?= {
                            is_in_government = yes
                            is_strongest_ig_in_government = yes
                        }
                        government_legitimacy > 75
                    }
                    set_variable = upgraded_latifundias_law_var
                    add_modifier = {
                        name = modifier_entrepreneurial_latifundistas
                        days = very_long_modifier_time
                    }
                    activate_law = law_type:law_expanded_latifundias
                }
            }
        }
        else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            show_as_tooltip = {
                custom_tooltip = {
                    text = je_spa_economic_regeneration_land_reform_tt_1
                }
                add_modifier = {
                    name = modifier_entrepreneurial_latifundistas
                    days = long_modifier_time
                    multiplier = 0.5
                }
                activate_law = law_type:law_expanded_latifundias
                custom_tooltip = {
                    text = je_spa_economic_regeneration_land_reform_tt_2
                }
                add_modifier = {
                    name = modifier_marginalized_latifundistas
                    days = long_modifier_time
                    multiplier = 0.5
                }
            }
            hidden_effect = {
                if = {
                    limit = {
                        NOR = {
                            has_law = law_type:law_latifundias
                            has_law = law_type:law_serfdom
                        }
                        ig:ig_landowners ?= {
                            is_in_government = no
                        }
                        government_legitimacy > 50
                    }
                    add_modifier = {
                        name = modifier_marginalized_latifundistas
                        days = long_modifier_time
                        multiplier = 0.5
                    }
                }
                else_if = {
                    limit = {
                        OR = {
                            has_law = law_type:law_latifundias
                            has_law = law_type:law_serfdom
                        }
                        ig:ig_landowners ?= {
                            is_in_government = yes
                            is_strongest_ig_in_government = yes
                        }
                        government_legitimacy > 50
                    }
                    set_variable = upgraded_latifundias_law_var
                    add_modifier = {
                        name = modifier_entrepreneurial_latifundistas
                        days = long_modifier_time
                        multiplier = 0.5
                    }
                    activate_law = law_type:law_expanded_latifundias
                }
            }
        }
    }

    fail = {
        OR = {
            NOT = {
                has_journal_entry = je_spa_economic_regeneration_master
            }
        }
    }

    weight = 100

    should_be_pinned_by_default = yes
}

je_spa_economic_regeneration_railways = {
    icon = "gfx/interface/icons/invention_icons/railways.dds"

    group = je_group_spa_economic_regeneration

    scripted_button = je_spa_economic_regeneration_cheat_button

    possible = {
    }

    immediate = {
    }

    on_monthly_pulse = {

    }

    complete = {
        trigger_if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            any_scope_state = {
                region = sr:region_iberia
                any_scope_building = {
                    is_building_type = building_railway
                    level >= 3
                }
                count >= 12
            }
        }
        trigger_else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            any_scope_state = {
                region = sr:region_iberia
                any_scope_building = {
                    is_building_type = building_railway
                    level >= 1
                }
                count >= 12
            }
        }
    }
    on_complete = {
        change_variable = {
            name = spa_economic_regeneration_var
            add = 1
        }
        if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            add_modifier = {
                name = modifier_arteries_of_the_nation
                days = very_long_modifier_time
            }
            add_modifier = {
                name = modifier_railway_magnates
                days = very_long_modifier_time
            }
        }
        else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            add_modifier = {
                name = modifier_arteries_of_the_nation
                days = long_modifier_time
                multiplier = 0.5
            }
            add_modifier = {
                name = modifier_railway_magnates
                days = long_modifier_time
                multiplier = 0.5
            }
        }
    }

    fail = {
        OR = {
            NOT = {
                has_journal_entry = je_spa_economic_regeneration_master
            }
        }
    }

    on_fail = {
        add_modifier = {
            name = modifier_entrenchment_of_local_power
            days = normal_modifier_time
        }
    }

    weight = 100

    should_be_pinned_by_default = yes
}

je_spa_economic_regeneration_modernise_agriculture = {
    icon = "gfx/interface/icons/invention_icons/threshing_machine.dds"

    group = je_group_spa_economic_regeneration

    scripted_button = je_spa_economic_regeneration_cheat_button

    possible = {
    }

    immediate = {
        set_variable = {
            name = je_spa_economic_regeneration_modernise_agriculture_timer_var
            value = 0
        }
    }

    on_monthly_pulse = {
        effect = {
            if = {
                limit = {
                    scope:journal_entry = {
                        NOT = {
                            has_variable = je_spa_economic_regeneration_creative_accounting_var
                        }
                    }
                }
                if = {
                    limit = {
                        any_scope_building = {
                            filter = {
                                is_building_group = bg_staple_crops
                                state = {
                                    state_region = {
                                        is_homeland = cu:spanish
                                    }
                                }
                            }
                            OR = {
                                has_active_production_method = pm_fertilization
                                hidden_trigger = {
                                    has_active_production_method = pm_fertilization_building_rice_farm
                                }
                            }
                            percent >= 0.8
                        }
                        any_scope_building = {
                            filter = {
                                is_building_group = bg_staple_crops
                                state = {
                                    state_region = {
                                        is_homeland = cu:spanish
                                    }
                                }
                            }
                            OR = {
                                has_active_production_method = pm_steam_threshers
                                hidden_trigger = {
                                    has_active_production_method = pm_steam_threshers_building_rice_farm
                                }
                            }
                            percent >= 0.8
                        }
                    }
                    change_variable = { name = je_spa_economic_regeneration_modernise_agriculture_timer_var add = 1 }
                }
                else = {
                    set_variable = { name = je_spa_economic_regeneration_modernise_agriculture_timer_var value = 0 }
                }
            }
            else_if = {
                limit = {
                    scope:journal_entry = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
                if = {
                    limit = {
                        any_scope_building = {
                            filter = {
                                is_building_group = bg_staple_crops
                                state = {
                                    state_region = {
                                        is_homeland = cu:spanish
                                    }
                                }
                            }
                            OR = {
                                has_active_production_method = pm_fertilization
                                hidden_trigger = {
                                    has_active_production_method = pm_fertilization_building_rice_farm
                                }
                            }
                            percent >= 0.4
                        }
                        any_scope_building = {
                            filter = {
                                is_building_group = bg_staple_crops
                                state = {
                                    state_region = {
                                        is_homeland = cu:spanish
                                    }
                                }
                            }
                            OR = {
                                has_active_production_method = pm_steam_threshers
                                hidden_trigger = {
                                    has_active_production_method = pm_steam_threshers_building_rice_farm
                                }
                            }
                            percent >= 0.4
                        }
                    }
                    change_variable = { name = je_spa_economic_regeneration_modernise_agriculture_timer_var add = 1 }
                }
                else = {
                    set_variable = { name = je_spa_economic_regeneration_modernise_agriculture_timer_var value = 0 }
                }
            }
        }
    }

    complete = {
        trigger_if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            custom_tooltip = {
                text = je_spa_economic_regeneration_modernise_agriculture_tt_1
                var:je_spa_economic_regeneration_modernise_agriculture_timer_var >= 24
            }
            any_scope_building = {
                filter = {
                    is_building_group = bg_staple_crops
                    state = {
                        state_region = {
                            is_homeland = cu:spanish
                        }
                    }
                }
                OR = {
                    has_active_production_method = pm_fertilization
                    hidden_trigger = {
                        has_active_production_method = pm_fertilization_building_rice_farm
                    }
                }
                percent >= 0.8
            }
            any_scope_building = {
                filter = {
                    is_building_group = bg_staple_crops
                    state = {
                        state_region = {
                            is_homeland = cu:spanish
                        }
                    }
                }
                OR = {
                    has_active_production_method = pm_steam_threshers
                    hidden_trigger = {
                        has_active_production_method = pm_steam_threshers_building_rice_farm
                    }
                }
                percent >= 0.8
            }
        }
        trigger_else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            custom_tooltip = {
                text = je_spa_economic_regeneration_modernise_agriculture_tt_2
                var:je_spa_economic_regeneration_modernise_agriculture_timer_var >= 12
            }
            any_scope_building = {
                filter = {
                    is_building_group = bg_staple_crops
                    state = {
                        state_region = {
                            is_homeland = cu:spanish
                        }
                    }
                }
                OR = {
                    has_active_production_method = pm_fertilization
                    hidden_trigger = {
                        has_active_production_method = pm_fertilization_building_rice_farm
                    }
                }
                percent >= 0.4
            }
            any_scope_building = {
                filter = {
                    is_building_group = bg_staple_crops
                    state = {
                        state_region = {
                            is_homeland = cu:spanish
                        }
                    }
                }
                OR = {
                    has_active_production_method = pm_steam_threshers
                    hidden_trigger = {
                        has_active_production_method = pm_steam_threshers_building_rice_farm
                    }
                }
                percent >= 0.4
            }
        }
    }
    on_complete = {
        change_variable = {
            name = spa_economic_regeneration_var
            add = 1
        }
        if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            show_as_tooltip = {
                custom_tooltip = {
                    text = every_state_following_requirements_tt
                }
                ordered_scope_state = {
                    order_by = gdp
					position = 0
					check_range_bounds = no
                    add_modifier = {
                        name = modifier_population_boom
                        days = long_modifier_time
                    }
                }
            }
            hidden_effect = {
                every_scope_state = {
                    limit = {
                        any_scope_building = {
                            OR = {
                                has_active_production_method = pm_steam_threshers
                                hidden_trigger = {
                                    has_active_production_method = pm_steam_threshers_building_rice_farm
                                }
                            }
                        }
                        state_region = {
                            is_homeland = cu:spanish
                        }
                    }
                    add_modifier = {
                        name = modifier_population_boom
                        days = long_modifier_time
                    }
                }
            }
        }
        else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            show_as_tooltip = {
                custom_tooltip = {
                    text = every_state_following_requirements_tt
                }
                ordered_scope_state = {
                    order_by = gdp
					position = 0
					check_range_bounds = no
                    add_modifier = {
                        name = modifier_population_boom
                        days = long_modifier_time
                    }
                }
            }
            hidden_effect = {
                every_scope_state = {
                    limit = {
                        any_scope_building = {
                            OR = {
                                has_active_production_method = pm_steam_threshers
                                hidden_trigger = {
                                    has_active_production_method = pm_steam_threshers_building_rice_farm
                                }
                            }
                        }
                        state_region = {
                            is_homeland = cu:spanish
                        }
                    }
                    add_modifier = {
                        name = modifier_population_boom
                        days = normal_modifier_time
                        multiplier = 0.5
                    }
                }
            }
        }
    }

    fail = {
        OR = {
            NOT = {
                has_journal_entry = je_spa_economic_regeneration_master
            }
        }
    }

    on_fail = {
        add_modifier = {
            name = modifier_falling_birthrates
            days = normal_modifier_time
        }
    }

    weight = 100

    should_be_pinned_by_default = yes
}

je_spa_economic_regeneration_ultramar = {
    icon = "gfx/interface/icons/invention_icons/colonization.dds"

    group = je_group_spa_economic_regeneration

    scripted_button = je_spa_economic_regeneration_cheat_button

    possible = {
    }

    immediate = {
    }

    on_monthly_pulse = {

    }

    complete = {
        trigger_if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            any_subject_or_below = {
                country_is_colonial_or_company = yes
                count >= 4
            }
            any_subject_or_below = {
                country_is_colonial_or_company = yes
                liberty_desire < define:NDiplomacy|WAR_GOAL_INFAMY_LOW_LIBERTY_DESIRE_THRESHOLD
                country_has_building_group_levels = {
                    type = bg_plantations
                    value >= 40
                }
            }
        }
        trigger_else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            any_subject_or_below = {
                country_is_colonial_or_company = yes
                count >= 2
            }
            any_subject_or_below = {
                country_is_colonial_or_company = yes
                liberty_desire < define:NDiplomacy|WAR_GOAL_INFAMY_LOW_LIBERTY_DESIRE_THRESHOLD
                country_has_building_group_levels = {
                    type = bg_plantations
                    value >= 20
                }
            }
        }
    }

    on_complete = {
        change_variable = {
            name = spa_economic_regeneration_var
            add = 1
        }
        if = {
            limit = {
                scope:journal_entry = {
                    NOT = {
                        has_variable = je_spa_economic_regeneration_creative_accounting_var
                    }
                }
            }
            show_as_tooltip = {
                custom_tooltip = {
                    text = every_colonial_subject_following_requirements_tt
                }
                ordered_subject_or_below = {
                    order_by = gdp
					position = 0
					check_range_bounds = no
                    add_modifier = {
                        name = modifier_integrated_colony
                        days = long_modifier_time
                    }
                }
            }
            hidden_effect = {
                every_subject_or_below = {
                    limit = {
                        country_is_colonial_or_company = yes
                        liberty_desire < define:NDiplomacy|WAR_GOAL_INFAMY_LOW_LIBERTY_DESIRE_THRESHOLD
                        country_has_building_group_levels = {
                            type = bg_plantations
                            value >= 40
                        }
                    }
                    add_modifier = {
                        name = modifier_integrated_colony
                        days = long_modifier_time
                    }
                }
            }
        }
        else_if = {
            limit = {
                scope:journal_entry = {
                    has_variable = je_spa_economic_regeneration_creative_accounting_var
                }
            }
            show_as_tooltip = {
                custom_tooltip = {
                    text = every_colonial_subject_following_requirements_tt
                }
                ordered_subject_or_below = {
                    order_by = gdp
					position = 0
					check_range_bounds = no
                    add_modifier = {
                        name = modifier_integrated_colony
                        days = normal_modifier_time
                        multiplier = 0.5
                    }
                }
            }
            hidden_effect = {
                every_subject_or_below = {
                    limit = {
                        country_is_colonial_or_company = yes
                        liberty_desire < define:NDiplomacy|WAR_GOAL_INFAMY_LOW_LIBERTY_DESIRE_THRESHOLD
                        country_has_building_group_levels = {
                            type = bg_plantations
                            value >= 20
                        }
                    }
                    add_modifier = {
                        name = modifier_integrated_colony
                        days = normal_modifier_time
                        multiplier = 0.5
                    }
                }
            }
        }
    }

    fail = {
        OR = {
            NOT = {
                has_journal_entry = je_spa_economic_regeneration_master
            }
        }
    }

    on_fail = {
        if = {
            limit = {
                any_subject_or_below = {
                    country_is_colonial_or_company = yes
                }
            }
            every_subject_or_below = {
                limit = {
                    country_is_colonial_or_company = yes
                }
                add_modifier = {
                    name = modifier_neglected_colony
                    days = normal_modifier_time
                }
            }
        }
    }

    weight = 100

    should_be_pinned_by_default = yes
}
