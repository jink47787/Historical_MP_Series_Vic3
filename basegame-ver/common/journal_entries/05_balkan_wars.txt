je_the_balkan_league = {

	icon = "gfx/interface/icons/event_icons/event_military.dds"
	scripted_progress_bar = balkan_league_timeout_bar

	scripted_button = je_the_balkan_league_research_mil_tech_start_button
	scripted_button = je_the_balkan_league_research_mil_tech_stop_button
	scripted_button = je_the_balkan_league_invite_vassals_button
	scripted_button = je_the_balkan_league_overwork_arms_industries_start_button
	scripted_button = je_the_balkan_league_overwork_arms_industries_stop_button
	scripted_button = je_the_balkan_league_muster_button
	scripted_button = je_the_balkan_league_resign_button
	scripted_button = je_the_balkan_league_start_war

	group = je_group_historical_content
	should_be_pinned_by_default = yes

	weight = 200

	on_monthly_pulse = {
		random_events = {
			200 = 0
			20 = balkan_wars.8  #A Student of Strategy
			20 = balkan_wars.9  #Caught in the Middle
			20 = balkan_wars.10 #Surplus Management
		}
	}

	on_weekly_pulse = {
		effect = { #checks allies
			generate_balkan_league_side_list = yes
			generate_ottoman_side_list = yes
		}
	}

	is_shown_in_lobby = {
		is_balkan_league_candidate = yes
		NOT = {
			c:MON ?= THIS
		}
	}

	is_shown_when_inactive = {
		has_dlc_feature = ip3_content
		is_balkan_league_candidate = yes
	}

	possible = {
		exists = c:TUR
		are_all_balkan_league_countries_independent = yes
		OR = { #tied to National Awakening JE fervor
			cu:serb.culture_current_fervor > 75
			cu:bulgarian.culture_current_fervor > 75
			cu:greek.culture_current_fervor > 75
		}
		c:TUR ?= {
			OR = {
				any_enemy_in_diplo_play = {
					country_rank >= rank_value:great_power
				}
				custom_tooltip = {
					text = ottoman_in_crisis_tt
					c:TUR ?= {
						OR = {
							has_global_variable = eastern_crisis_happened
							has_variable = failed_sick_man_main
							has_variable = failed_sick_man_separatism
							has_variable = grand_collapse_started
						}
					}
				}
			}
		}
	}

	immediate = {
        trigger_event = {
            id = balkan_wars.1
            days = 3
            popup = yes
        }
		sr:region_balkans = {
			save_scope_as = balkans_scope
		}
		c:TUR ?= {
			save_scope_as = ottoman_empire_scope
		}
		set_global_variable = { #what if no one joins
			name = je_the_balkan_league_started
			days = 90
		}
		generate_balkan_league_side_list = yes
		generate_ottoman_side_list = yes
	}

	complete = {
		OR = {
			NOT = {
				exists = c:TUR
			}
			sr:region_balkans = {
				any_scope_state = {
		 			owner = c:TUR
		 			count = 0
				}
			}
		}
	}

	on_complete = {
		trigger_event = {
           id = balkan_wars.2
        }
        set_variable = first_balkan_war_successful
		spoils_of_war_initiation_gre = yes
		spoils_of_war_initiation_mon = yes
		spoils_of_war_initiation_bul = yes
		spoils_of_war_initiation_ser = yes
		spoils_of_war_initiation_wal = yes
		the_balkan_league_activated_modifier_cleanser = yes

		custom_tooltip = je_the_balkan_league_complete_header_tt
			every_state_region = {
				limit = {
					any_scope_state = {
					owner = c:TUR
					region = sr:region_balkans
				}
			}
			custom_tooltip = je_the_balkan_league_complete_tt
		}
	}

	event_outcome_completed_effect_desc = {
		effect = {
			add_modifier = {
				name = balkan_wars_victorious_balkan_league_mod
				days = very_long_modifier_time
				is_decaying = yes
			}
			if = {
				limit = {
					has_variable = balkan_league_fought_alone_var
				}
				custom_tooltip = balkan_wars.2.tt_1
				add_modifier = {
					name = modifier_balkan_wars_won_alone
					days = very_long_modifier_time
					is_decaying = yes
				}
			}
		}
	}

	fail = {
		OR = {
			custom_tooltip = {
				text = balkan_wars_league_fail_timeout_tt
				has_journal_entry = je_the_balkan_league
				je:je_the_balkan_league = {
					"scripted_bar_progress(balkan_league_timeout_bar)" <= 1
				}
			}
			hidden_trigger = {
				OR = {
					has_modifier = balkan_wars_traitor_mod
					has_variable = bp_member_backs_down
				}
			}
			custom_tooltip = {
				text = balkan_wars_league_fail_by_losing_the_war_tt
				has_variable = lost_balkan_wars
			}
			custom_tooltip = {
				text = balkan_wars_league_fail_by_rejecting_immediately_tt
				has_variable = balkan_league_immediate_rejector
			}
		}
	}

	on_fail = {
		if = {
			limit = { # Resigned before the war started.
				has_modifier = balkan_wars_traitor_mod
			}
		    trigger_event = {
            	id = balkan_wars.5
           		days = 0
            	popup = yes
        	}
		}
		if = {
			limit = { # Lost the war, but still not a subject.
				has_variable = lost_balkan_wars
				is_subject = no
			}
		    trigger_event = {
	            id = balkan_wars.6
	            days = 0
	            popup = yes
        	}
		}
		if = {
			limit = { # Became a subject before the war began OR as a result of losing the war
				is_subject = yes
				is_diplomatic_play_committed_participant = no
			}
		    trigger_event = {
	            id = balkan_wars.3
	            days = 0
	            popup = yes
        	}
		}
		the_balkan_league_activated_modifier_cleanser = yes
		remove_variable = bp_member_backs_down
		generate_balkan_league_side_list = yes
		generate_ottoman_side_list = yes
	}

	event_outcome_failed_desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					is_subject = no
					NOT = {
						has_modifier = balkan_wars_traitor_mod
					}
				}
				desc = event_effects_balkan_wars.6_tt
			}
			triggered_desc = {
				trigger = {
					has_modifier = balkan_wars_traitor_mod
				}
				desc = event_effects_balkan_wars.5_tt
			}
			triggered_desc = {
				trigger = {
					is_subject = yes
					NOT = {
						has_modifier = balkan_wars_traitor_mod
					}
				}
				desc = event_effects_balkan_wars.3_tt
			}
		}
	}

	invalid = {
		hidden_trigger = {
    		NOT = {
				has_global_variable = je_the_balkan_league_started
    		}
		}
		NOT = {
			any_diplomatically_relevant_country = {
				NOT = {
					this = root
				}
				has_journal_entry = je_the_balkan_league
			}
		}
		c:TUR ?= {
			any_subject_or_below = {
				exists = this
				count = 0
			}
		}
	}

	on_invalid = {
		trigger_event = {
            id = balkan_wars.4
        }
        the_balkan_league_activated_modifier_cleanser = yes
	}
}

je_spoils_of_war = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"

	group = je_group_historical_content
	should_be_pinned_by_default = yes

	weight = 200

	on_monthly_pulse = {
		random_events = {
			200 = 0
			20 = balkan_wars.9 #Caught in the Middle
		}
	}

	immediate = {
	}

	complete = { # if we own designated state regions that are our culture homelands in the balkans region
		trigger_if = {
			limit = {
				c:GRE ?= this
			}
			spoils_of_war_complete_gre = yes
		}

		trigger_if = {
			limit = {
				c:MON ?= this
			}
			spoils_of_war_complete_mon = yes
		}

		trigger_if = {
			limit = {
				c:BUL ?= this
			}
			spoils_of_war_complete_bul = yes
		}

		trigger_if = {
			limit = {
				OR = {
					c:SER ?= this
					c:YUG ?= this
				}
			}
			spoils_of_war_complete_ser = yes
		}

		trigger_if = {
			limit = {
				c:ALB ?= THIS
			}
			spoils_of_war_complete_alb = yes
		}

		trigger_if = {
			limit = {
				OR = {
					c:ROM ?= this
					c:WAL ?= this
					c:MOL ?= this
				}
			}
			spoils_of_war_complete_rom = yes
		}
		custom_tooltip = { # Can only time out
			text = je_spoils_of_war_timed_out_tt
			always = no
		}
	}

	on_complete = {
		show_as_tooltip = {
			random_primary_culture = {
				save_scope_as = primary_culture_scope
			}
			owner = {
				add_loyalists = {
					value = very_large_radicals
					culture = scope:primary_culture_scope
				}
			}
			add_modifier = {
				name = balkan_wars_victorious_second_balkan_war_mod
				days = very_long_modifier_time
				is_decaying = yes
			}
			custom_tooltip = homeland_states_spoils_of_war_header_tt
			if = {
				limit = {
					c:WAL ?= this
				}
				every_state_region = {
					limit = {
						is_homeland = scope:primary_culture_scope
						region = sr:region_danubia
					}
					custom_tooltip = homeland_states_spoils_of_war_tt
				}
			}
			else = {
				every_state_region = {
					limit = {
						is_homeland = scope:primary_culture_scope
						region = sr:region_balkans
					}
					custom_tooltip = homeland_states_spoils_of_war_tt
				}
			}
			set_variable = achievement_teamkiller_var
		}
	}

	timeout = 3650

	on_timeout = {
		hidden_effect = {
			if = {
				limit = {
					OR = {
						AND = {
							OR = {
								c:ROM ?= this
								c:WAL ?= this
								c:MOL ?= this
							}
							spoils_of_war_complete_rom = yes
						}
						AND = {
							c:GRE ?= this
							spoils_of_war_complete_gre = yes
						}
						AND = {
							c:MON ?= this
							spoils_of_war_complete_mon = yes
						}
						AND = {
							c:BUL ?= this
							spoils_of_war_complete_bul = yes
						}
						AND = {
							OR = {
								c:SER ?= this
								c:YUG ?= this
							}
							spoils_of_war_complete_ser = yes
						}
						AND = {
							c:ALB ?= this
							spoils_of_war_complete_alb = yes
						}
					}
				}
				random_primary_culture = {
					save_scope_as = primary_culture_scope
				}
				owner = {
					add_loyalists = {
						value = very_large_radicals
						culture = scope:primary_culture_scope
					}
				}
				add_modifier = {
					name = balkan_wars_victorious_second_balkan_war_mod
					days = very_long_modifier_time
					is_decaying = yes
				}
				custom_tooltip = homeland_states_spoils_of_war_header_tt
				if = {
					limit = {
						c:WAL ?= this
					}
					every_state_region = {
						limit = {
							is_homeland = scope:primary_culture_scope
							region = sr:region_danubia
						}
						custom_tooltip = homeland_states_spoils_of_war_tt
					}
				}
				else = {
					every_state_region = {
						limit = {
							is_homeland = scope:primary_culture_scope
							region = sr:region_balkans
						}
						custom_tooltip = homeland_states_spoils_of_war_tt
					}
				}
				set_variable = achievement_teamkiller_var
			}
		}
	}
}
