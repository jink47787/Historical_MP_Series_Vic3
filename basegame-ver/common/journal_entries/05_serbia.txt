je_serbian_throne = {

	group = je_group_historical_content
	icon = "gfx/interface/icons/law_icons/monarchy.dds"

	is_shown_in_lobby = {
		has_dlc_feature = ip3_content #National Awakening
		c:SER ?= THIS
	}

	scripted_progress_bar = serbian_dethrone_bar
	scripted_button = je_tot_slander_button
	scripted_button = je_tot_campaign_button

	should_be_pinned_by_default = yes
	transferable = no
	weight = 10000

	status_desc = {
        first_valid = {
            triggered_desc = {
                desc = je_serbian_throne_status_loc_karadordevic_dominance
                trigger = {
					OR = {
						AND = {
							ruler = {
								has_variable = house_karadordevic
							}
							je:je_serbian_throne ?= {
								"scripted_bar_progress(serbian_dethrone_bar)" >= 400
								"scripted_bar_progress(serbian_dethrone_bar)" <= 500
							}
						}
						AND = {
							ruler = {
								has_variable = house_obrenovic
							}
							je:je_serbian_throne ?= {
								"scripted_bar_progress(serbian_dethrone_bar)" >= 0
								"scripted_bar_progress(serbian_dethrone_bar)" <= 99
							}
						}
					}
                }
            }
            triggered_desc = {
                desc = je_serbian_throne_status_loc_karadordevic_leaning
                trigger = {
					OR = {
						AND = {
							ruler = {
								has_variable = house_karadordevic
							}
							je:je_serbian_throne ?= {
								"scripted_bar_progress(serbian_dethrone_bar)" >= 300
								"scripted_bar_progress(serbian_dethrone_bar)" <= 399
							}
						}
						AND = {
							ruler = {
								has_variable = house_obrenovic
							}
							je:je_serbian_throne ?= {
								"scripted_bar_progress(serbian_dethrone_bar)" >= 100
								"scripted_bar_progress(serbian_dethrone_bar)" <= 199
							}
						}
					}
                }
            }
            triggered_desc = {
                desc = je_serbian_throne_status_loc_neutral
                trigger = {
					je:je_serbian_throne ?= {
						"scripted_bar_progress(serbian_dethrone_bar)" >= 200
						"scripted_bar_progress(serbian_dethrone_bar)" <= 299
					}
                }
            }
            triggered_desc = {
                desc = je_serbian_throne_status_loc_obrenovic_leaning
                trigger = {
					OR = {
						AND = {
							ruler = {
								has_variable = house_karadordevic
							}
							je:je_serbian_throne ?= {
								"scripted_bar_progress(serbian_dethrone_bar)" >= 100
								"scripted_bar_progress(serbian_dethrone_bar)" <= 199
							}
						}
						AND = {
							ruler = {
								has_variable = house_obrenovic
							}
							je:je_serbian_throne ?= {
								"scripted_bar_progress(serbian_dethrone_bar)" >= 300
								"scripted_bar_progress(serbian_dethrone_bar)" <= 399
							}
						}
					}
                }
            }
            triggered_desc = {
                desc = je_serbian_throne_status_loc_obrenovic_dominance
                trigger = {
					OR = {
						AND = {
							ruler = {
								has_variable = house_karadordevic
							}
							je:je_serbian_throne ?= {
								"scripted_bar_progress(serbian_dethrone_bar)" >= 0
								"scripted_bar_progress(serbian_dethrone_bar)" <= 99
							}
						}
						AND = {
							ruler = {
								has_variable = house_obrenovic
							}
							je:je_serbian_throne ?= {
								"scripted_bar_progress(serbian_dethrone_bar)" >= 400
								"scripted_bar_progress(serbian_dethrone_bar)" <= 500
							}
						}
					}
                }
            }
        }
    }

	immediate = {
		
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					scope:journal_entry ?= {
						"scripted_bar_progress(serbian_dethrone_bar)" <= 0
					}
				}
				trigger_event = { id = serbian_throne.10 popup = yes }
			}
		}
		random_events = {
			400 = 0
			5 = serbian_throne.1 #clerical publicity
			5 = serbian_throne.3 #exposing hypocrites
			5 = serbian_throne.4 #renegade hajduks
			5 = serbian_throne.5 #urban rebels
			5 = serbian_throne.6 #plea for aid
		}
	}

	complete = {
		custom_tooltip = {
			text = je_serbian_throne_complete_timer_tt
			je:je_serbian_throne ?= {
				"scripted_bar_progress(serbian_dethrone_bar)" >= 500
			}
		}
	}

	on_complete = {
		trigger_event = { id = serbian_throne.9 }
		hidden_effect = {
			serbian_throne_modifier_cleanser = yes
			serbian_throne_variable_cleanser = yes
		}
	}
	
	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_serbian_throne.9_tt
			}
		}
	}

	custom_failure_header = je_serbian_throne_fail_header

	fail = {
		custom_tooltip = {
			text = je_serbian_throne_fail_timer_tt
			je:je_serbian_throne ?= {
				"scripted_bar_progress(serbian_dethrone_bar)" <= 0
			}
		}
		hidden_trigger = {
			always = no
		}
	}

	custom_on_failure_header = je_serbian_throne_on_fail_header

	on_fail = {
		show_as_tooltip = {
			trigger_event = { id = serbian_throne.10 }
		}
	}
	
	event_outcome_failed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_serbian_throne.10_tt
			}
		}
	}

	invalid = {
		NOT = {
			has_law_or_variant = law_type:law_monarchy
		}
	}

	on_invalid = {
		trigger_event = { id = serbian_throne.11 }
		hidden_effect = {
			serbian_throne_modifier_cleanser = yes
			serbian_throne_variable_cleanser = yes
		}
	}
}
