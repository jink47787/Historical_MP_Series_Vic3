# Monuments for IP3

#### Kaiserforum ###
je_kaiserforum = {
    icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	group = je_group_technology
    scripted_button = je_kaiserforum_kaisergelb_button

    is_shown_when_inactive = {
        has_dlc_feature = ip3_content
        any_scope_state = {
            state_region = s:STATE_AUSTRIA
        }
    }

    possible = {
        has_technology_researched = reinforced_concrete
        any_scope_state = {
            state_region = s:STATE_AUSTRIA
        }
        NOR = {
            has_law_or_variant = law_type:law_command_economy
            investment_pool_gross_income < 1000
        }
    }

    status_desc = {
        first_valid = {
            triggered_desc = {
                desc = kaiserforum_4_built_complete_status_loc
                trigger = {
                    has_building = building_kaiserforum_4
                }
            }
            triggered_desc = {
                desc = kaiserforum_3_built_complete_status_loc
                trigger = {
                    has_building = building_kaiserforum_3
                }
            }
            triggered_desc = {
                desc = kaiserforum_4_ready_status_loc
                trigger = {
                    has_building = building_kaiserforum_2
                    has_variable = accepted_kaisergelb_kaiserforum
                    NOT = {
                        has_building = building_kaiserforum_4
                    }
                }
            }
            triggered_desc = {
                desc = kaiserforum_3_ready_status_loc
                trigger = {
                    has_building = building_kaiserforum_2
                    has_variable = accepted_kaiserforum
                    NOT = {
                        has_building = building_kaiserforum_3
                    }
                }
            }
            triggered_desc = {
                desc = kaiserforum_2_built_kaiserforum_3_or_4_ready_status_loc
                trigger = {
                    has_building = building_kaiserforum_2
                    NOR = {
                        has_building = building_kaiserforum_3
                        has_building = building_kaiserforum_4
                    }
                }
            }
            triggered_desc = {
                desc = kaiserforum_1_built_kaiserforum_2_ready_status_loc
                trigger = {
                    has_building = building_kaiserforum_1
                    NOR = {
                        has_building = building_kaiserforum_2
                        has_building = building_kaiserforum_3
                        has_building = building_kaiserforum_4
                    }
                }
            }
            triggered_desc = {
                desc = kaiserforum_0_built_kaiserforum_1_ready_status_loc
                trigger = {
                    NAND = {
                        has_building = building_kaiserforum_1
                        has_building = building_kaiserforum_2
                        has_building = building_kaiserforum_3
                        has_building = building_kaiserforum_4
                    }
                }
            }
            triggered_desc = {
                desc = no_kaiserforum_status_loc
                trigger = {
                    NOT = {
                        has_journal_entry = je_kaiserforum
                    }
                }
            }
        }
    }

    immediate = {
        random_scope_state = {
            limit = {
                state_region = s:STATE_AUSTRIA
            }
            save_scope_as = relevant_state
        }
        ig:ig_devout = {
            save_scope_as = relevant_ig
        }
        trigger_event = { id = kaiserforum.1 popup = yes }
    }

    on_weekly_pulse = {
        effect = { # checks if the next phase is being constructed
            destroy_building_kaiserforum_1 = yes
            destroy_building_kaiserforum_2 = yes
        }
    }

    complete = {
        trigger_if = {
            limit = {
                NOT = {
                    has_variable = accepted_kaisergelb_kaiserforum
                }
            }
            custom_tooltip = {
                text = kaiserforum_complete_tt
                any_scope_state = {
                    state_region = s:STATE_AUSTRIA
                    has_building = building_kaiserforum_3
                }
            }
        }
        trigger_if = { # Imperial Yellow Kaiserforum
            limit = {
                has_variable = accepted_kaisergelb_kaiserforum
            }
            custom_tooltip = {
                text = kaisergelb_kaiserforum_complete_tt
                any_scope_state = {
                    state_region = s:STATE_AUSTRIA
                    has_building = building_kaiserforum_4
                }
            }
        }
        trigger_if = {
            limit = {
                AND = {
                    has_game_rule = allow_monument_effects
                    NOT = {
                        has_variable = accepted_kaisergelb_kaiserforum
                    }
                }
            }
            custom_tooltip = {
                text = kaiserforum_populated_tt
                any_scope_state = {
                    state_region = s:STATE_AUSTRIA
                    any_scope_building = {
                        is_building_type = building_kaiserforum_3
                        occupancy >= 0.5
                    }
                }
            }
        }
        trigger_if = {
            limit = {
                AND = {
                    has_game_rule = allow_monument_effects
                    has_variable = accepted_kaisergelb_kaiserforum
                }
            }
            custom_tooltip = {
                text = kaisergelb_kaiserforum_populated_tt
                any_scope_state = {
                    state_region = s:STATE_AUSTRIA
                    any_scope_building = {
                        is_building_type = building_kaiserforum_4
                        occupancy >= 0.5
                    }
                }
            }
        }
    }

    on_complete = {
        trigger_event = { id = kaiserforum.5 popup = yes }
    }

    event_outcome_completed_effect_desc = {
        header = kaiserforum.5.a
        effect = {
            random_scope_state = {
                limit = {
                    state_region = s:STATE_AUSTRIA
                }
                add_modifier = {
                    name = kaiserforum_loc_efforts
                    days = moderately_long_modifier_time
                }
            }
        }
    }

    event_outcome_completed_effect_desc = {
        header = kaiserforum.5.b
        effect = {
            add_modifier = {
                name = kaiserforum_int_acclaim
                days = moderately_long_modifier_time
            }
        }
    }

    invalid = {
        OR = {
            has_variable = rejected_kaiserforum_project
            AND = {
                NOT = {
                    s:STATE_AUSTRIA = {
                        any_scope_state = {
                            owner = root
                        }
                    }
                }
                NOT = {
                    s:STATE_AUSTRIA = {
                        any_scope_state = {
                            owner = {
                               is_diplomatic_play_enemy_of = root
                            }
                        }
                    }
                }
            }
        }
    }

    weight = 1000

    should_be_pinned_by_default = yes
}
