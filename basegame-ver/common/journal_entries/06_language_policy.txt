je_vernacular_policy = {
	group = je_group_historical_content
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	# Spanish buttons
	scripted_button = je_vernacular_policy_accept_catalan_button
	scripted_button = je_vernacular_policy_accept_aragonese_button
	scripted_button = je_vernacular_policy_accept_asturleonese_button
	scripted_button = je_vernacular_policy_accept_galician_button
	scripted_button = je_vernacular_policy_accept_basque_button

	# French buttons
	scripted_button = je_vernacular_policy_accept_francoprovencal_button
	scripted_button = je_vernacular_policy_accept_breton_button
	scripted_button = je_vernacular_policy_accept_occitan_button
	scripted_button = je_vernacular_policy_accept_wallonian_button

	is_shown_when_inactive = {
        has_dlc_feature = ip4_content
		OR = {
			AND = {
				OR = {
					c:SPA ?= this
					was_formed_from = SPA
				}
				any_scope_state = {
					state_region = {
						is_homeland = cu:spanish
						OR = {
							is_homeland = cu:catalan
							is_homeland = cu:aragonese
							is_homeland = cu:asturleonese
							is_homeland = cu:galician
							is_homeland = cu:basque
						}
					}
					has_building = building_railway
				}
			}
			AND = {
				OR = {
					c:FRA ?= this
					was_formed_from = FRA
				}
				any_scope_state = {
					state_region = {
						is_homeland = cu:french
						OR = {
							is_homeland = cu:francoprovencal
							is_homeland = cu:occitan
							is_homeland = cu:breton
							is_homeland = cu:wallonian
						}
					}
					has_building = building_railway
				}
			}
		}
		NOT = {
			has_variable = je_vernacular_policy_var
		}
	}

	possible = {
		has_technology_researched = nationalism
		institution_investment_level = {
			institution = institution_schools
			value >= 4
		}
		trigger_if = {
			limit = {
				OR = {
					c:SPA ?= this
					was_formed_from = SPA
				}
			}
			any_scope_state = {
				state_region = {
					is_homeland = cu:spanish
					OR = {
						is_homeland = cu:catalan
						is_homeland = cu:aragonese
						is_homeland = cu:asturleonese
						is_homeland = cu:galician
						is_homeland = cu:basque
					}
				}
				count >= 4
			}
		}
		trigger_if = {
			limit = {
				OR = {
					c:FRA ?= this
					was_formed_from = FRA
				}
			}
			any_scope_state = {
				state_region = {
					is_homeland = cu:french
					OR = {
						is_homeland = cu:francoprovencal
						is_homeland = cu:occitan
						is_homeland = cu:breton
						is_homeland = cu:wallonian
					}
				}
				count >= 4
			}
		}
	}

	immediate = {
		set_variable = je_vernacular_policy_var
		if = {
			limit = {
				OR = {
					c:SPA ?= this
					was_formed_from = SPA
				}
			}
			cu:spanish ={
				save_scope_as = official_culture_scope
			}
		}
		else_if = {
			limit = {
				OR = {
					c:FRA ?= this
					was_formed_from = FRA
				}
			}
			cu:french ={
				save_scope_as = official_culture_scope
			}
		}
		trigger_event = {
			id = vernacular_events.1
			popup = yes
		}
	}

	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					has_variable = chose_assimilation_var
				}
				clear_variable_list = vernacular_policy_assimilation_states
				every_scope_state = {
					limit = {
						state_region = {
							is_homeland = scope:official_culture_scope
						}
						culture_percent_state = {
							target = scope:official_culture_scope
							value < 0.6
						}
					}
					root = {
						add_to_variable_list = {
							name = vernacular_policy_assimilation_states
							target = prev
						}
					}
				}
			}
		}
	}

	complete = {
		OR = { # This strange OR wrap is for the sake of a sensible completion trigger block in the JE preview. This may rely on a bug to display correctly :B
			trigger_if = {
				limit = {
					NOT = {
						has_variable = chose_integration_var # inverted checks to enable sensible completion trigger block in the JE preview
					}
				}
				trigger_if = {
					limit = {
						OR = {
							c:SPA ?= this
							was_formed_from = SPA
						}
					}
					any_scope_state = {
						filter = {
							state_region = {
								is_homeland = cu:spanish
							}
						}
						culture_percent_state = {
							target = cu:spanish
							value >= 0.6
						}
						custom_tooltip = {
							text = VERNACULAR_POLICY_ASSIMILATION_STATES_TT
						}
						percent = 1
					}
				}
				trigger_else_if = {
					limit = {
						OR = {
							c:FRA ?= this
							was_formed_from = FRA
						}
					}
					any_scope_state = {
						filter = {
							state_region = {
								is_homeland = cu:french
							}
						}
						culture_percent_state = {
							target = cu:french
							value >= 0.6
						}
						custom_tooltip = {
							text = VERNACULAR_POLICY_ASSIMILATION_STATES_TT
						}
						percent = 1
					}
				}
			}
			trigger_if = {
				limit = {
					NOT = {
						has_variable = chose_assimilation_var # inverted checks to enable sensible completion trigger block in the JE preview
					}
				}
				trigger_if = {
					limit = {
						OR = {
							c:SPA ?= this
							was_formed_from = SPA
						}
					}
					AND = {
						trigger_if = {
							limit = {
								any_scope_state = {
									culture_percent_state = {
										target = cu:catalan
										value > 0
									}
									state_region = {
										is_homeland = cu:catalan
									}
								}
							}
							country_has_primary_culture = cu:catalan
						}
						trigger_if = {
							limit = {
								any_scope_state = {
									culture_percent_state = {
										target = cu:aragonese
										value > 0
									}
									state_region = {
										is_homeland = cu:aragonese
									}
								}
							}
							country_has_primary_culture = cu:aragonese
						}
						trigger_if = {
							limit = {
								any_scope_state = {
									culture_percent_state = {
										target = cu:asturleonese
										value > 0
									}
									state_region = {
										is_homeland = cu:asturleonese
									}
								}
							}
							country_has_primary_culture = cu:asturleonese
						}
						trigger_if = {
							limit = {
								any_scope_state = {
									culture_percent_state = {
										target = cu:galician
										value > 0
									}
									state_region = {
										is_homeland = cu:galician
									}
								}
							}
							country_has_primary_culture = cu:galician
						}
						trigger_if = {
							limit = {
								any_scope_state = {
									culture_percent_state = {
										target = cu:basque
										value > 0
									}
									state_region = {
										is_homeland = cu:basque
									}
								}
							}
							country_has_primary_culture = cu:basque
						}
					}
				}
				trigger_else_if = {
					limit = {
						OR = {
							c:FRA ?= this
							was_formed_from = FRA
						}
					}
					AND = {
						trigger_if = {
							limit = {
								any_scope_state = {
									culture_percent_state = {
										target = cu:occitan
										value > 0
									}
									state_region = {
										is_homeland = cu:occitan
									}
								}
							}
							country_has_primary_culture = cu:occitan
						}
						trigger_if = {
							limit = {
								any_scope_state = {
									culture_percent_state = {
										target = cu:francoprovencal
										value > 0
									}
									state_region = {
										is_homeland = cu:francoprovencal
									}
								}
							}
							country_has_primary_culture = cu:francoprovencal
						}
						trigger_if = {
							limit = {
								any_scope_state = {
									culture_percent_state = {
										target = cu:breton
										value > 0
									}
									state_region = {
										is_homeland = cu:breton
									}
								}
							}
							country_has_primary_culture = cu:breton
						}
						trigger_if = {
							limit = {
								any_scope_state = {
									culture_percent_state = {
										target = cu:wallonian
										value > 0
									}
									state_region = {
										is_homeland = cu:wallonian
									}
								}
							}
							country_has_primary_culture = cu:wallonian
						}
					}
				}
			}
		}
	}

	on_complete = {
		clear_variable_list = vernacular_policy_assimilation_states
		if = {
			limit = {
				has_variable = chose_assimilation_var
			}
			trigger_event = {
				id = vernacular_events.2
				popup = yes
			}
		}
		if = {
			limit = {
				has_variable = chose_integration_var
			}
			trigger_event = {
				id = vernacular_events.3
				popup = yes
			}
		}
		if = {
			limit = {
				has_modifier = modifier_france_breton_integration_aid
			}
			remove_modifier = modifier_france_breton_integration_aid
		}
		if = {
			limit = {
				has_modifier = modifier_spain_basque_integration_aid
			}
			remove_modifier = modifier_spain_basque_integration_aid
		}
	}

	invalid = {
		has_variable = chose_to_not_care_var
	}

	weight = 10000

	should_be_pinned_by_default = yes
}

