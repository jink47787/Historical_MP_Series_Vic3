decision_revoke_banishment_law = {
	is_shown = {
		has_dlc_feature = ip4_content
		c:POR ?= ROOT
		any_character_in_void = {
			has_template = POR_miguel_i_de_braganca_template
		}
	}

	possible = {
		any_interest_group = {
			leader = {
				has_ideology = ideology:ideology_miguelist
			}
			is_in_government = yes
		}
	}

	when_taken = {
		every_interest_group = {
			limit = {
				NOT = { leader = { has_ideology = ideology:ideology_miguelist } }
				OR = {
					is_interest_group_type = ig_industrialists
					is_interest_group_type = ig_petty_bourgeoisie
					is_interest_group_type = ig_intelligentsia
					is_interest_group_type = ig_trade_unions
				}
			}
			add_modifier = {
				name = modifier_banishment_law_repealed
				days = normal_modifier_time
			}
		}
		add_loyalists = {
			pop_type = aristocrats
			value = medium_radicals
		}
		custom_tooltip = {
			text = miguel_invited_back_tt
			random_character_in_void = {
				limit = {
					has_template = POR_miguel_i_de_braganca_template
				}
				remove_character_role = politician
				add_character_role = agitator
				free_character_from_void = yes
			}
		}
	}

	ai_chance = {
		value = 10
	}
}

decision_depose_ruling_dynasty = {
	is_shown = {
		OR = {
			has_dlc_feature = voice_of_the_people_content
			has_dlc_feature = ip4_content
		}
		OR = {
			country_has_primary_culture = cu:french
			country_has_primary_culture = cu:spanish
			country_has_primary_culture = cu:portuguese
			country_has_primary_culture = cu:iberian
		}
		has_law = law_type:law_monarchy
		is_revolutionary = no
		is_secessionist = no
	}

	possible = {
		NOR = {
			hidden_trigger = { has_variable = coup_event_active }
			has_journal_entry = je_ip4_coup
			is_involved_in_journal_entry = je_the_first_carlist_war
		}
		any_scope_character = {
			OR = {
				has_role = general
				has_role = admiral
			}
			character_has_ideology_conflicting_with_ruling_dynasty = yes
			NOT = { # You cannot hire a communist to install the Orleanists on the throne
				law_stance = {
					law = law_type:law_monarchy
					value <= disapprove
				}
			}
			custom_tooltip = {
				text = ig_sufficiently_upset_tt
				interest_group = {
					ig_approval < 0
				}
				has_variable = monthly_cached_commander_coup_strength
			}
			trigger_if = {
				limit = {
					has_variable = monthly_cached_commander_coup_strength
				}
				custom_tooltip = {
					text = coup_strength_greater_than_coup_resistance_tt
					var:monthly_cached_commander_coup_strength >= root.country_coup_resistance
				}
			}
		}
	}

	when_taken = {
		ordered_scope_character = {
			limit = {
				OR = {
					has_role = general
					has_role = admiral
				}
				has_variable = monthly_cached_commander_coup_strength
				character_has_ideology_conflicting_with_ruling_dynasty = yes
				NOT = { # You cannot hire a communist to install the Orleanists on the throne
					law_stance = {
						law = law_type:law_monarchy
						value <= disapprove
					}
				}
				var:monthly_cached_commander_coup_strength >= root.country_coup_resistance
				interest_group = {
					ig_approval < 0
				}
			}
			order_by = popularity
			position = 0
			save_scope_as = temp_golpista
		}
		if = {
			limit = {
				exists = scope:temp_golpista
			}
			custom_tooltip = {
				text = begin_dynastic_coup_tt
			}
			scope:temp_golpista ?= {
				set_variable = commander_doing_coup_on_player_behalf
				add_modifier = {
					name = modifier_dynastic_coup
					days = short_modifier_time
				}
			}
			if = {
				limit = {
					exists = scope:temp_golpista
				}
				create_coup_from_character = {
					CHARACTER = scope:temp_golpista
				}
			}
		}
		else = {
			custom_tooltip = begin_dynastic_coup_scopeless_tt
		}
	}

	ai_chance = {
		value = 10
	}
}

decision_reorganize_iberian_crowns = {
	is_shown = {
		has_dlc_feature = ip4_content
		c:POR ?= ROOT
		has_law = law_type:law_monarchy
		NOT = {
			has_variable = reorganized_iberia_var
		}
	}

	possible = {
		OR = {
			c:SPA ?= {
				is_subject_of = ROOT
				NOT = {
					is_subject_type = subject_type_personal_union
				}
			}
			AND = {
				custom_tooltip = {
					text = spa_does_not_exist_tt
					NOT = {
						exists = c:SPA
					}
				}
				owns_entire_state_region = STATE_NEW_CASTILE
			}
		}
	}

	when_taken = {
		set_variable = reorganized_iberia_var
		if = {
			limit = {
				exists = c:SPA
				c:SPA ?= {
					is_subject_of = ROOT
				}
			}
			c:SPA ?= {
				if = {
					limit = {
						NOT = {
							has_law = law_type:law_monarchy
						}
					}
					activate_law = law_type:law_monarchy
				}
				change_subject_type = subject_type_personal_union
			}
		}
		else_if = {
			limit = {
				AND = {
					NOT = {
						exists = c:SPA
					}
					owns_entire_state_region = STATE_NEW_CASTILE
				}
			}
			random_scope_state = {
				limit = {
					state_region = s:STATE_NEW_CASTILE
				}
				save_scope_as = castile_scope
			}
			custom_tooltip = {
				text = portugal_spawn_spain_tt
				create_country = {
					origin = root
					tag = SPA
					state = scope:castile_scope
					on_created = {
					}
				}
				every_state_in_castile = {
					limit = {
						OR = {
							owner ?= ROOT
							owner = {
								is_subject_of = ROOT
							}
						}
						NOT = {
							c:SPA ?= owner
						}
						state_region = {
							is_homeland = cu:spanish
						}
					}
					set_state_owner = c:SPA
				}
				every_state_in_aragon = {
					limit = {
						OR = {
							owner ?= ROOT
							owner = {
								is_subject_of = ROOT
							}
						}
						NOT = {
							c:SPA ?= owner
						}
						state_region = {
							is_homeland = cu:spanish
						}
					}
					set_state_owner = c:SPA
				}
			}
			create_diplomatic_pact = {
				country = c:SPA
				type = personal_union
			}
		}
		else = {
			custom_tooltip = {
				text = portugal_spawn_spain_tt
			}
		}
	}

	ai_chance = {
		value = 10 # You never know
	}
}

decision_restore_kingdom_of_brazil = {
	is_shown = {
		has_dlc_feature = ip4_content
		c:POR ?= ROOT
		has_law = law_type:law_monarchy
		NOT = {
			has_variable = restored_kingdom_of_brazil_var
		}
	}

	possible = {
		OR = {
			c:BRZ ?= {
				is_subject_of = ROOT
				NOT = {
					is_subject_type = subject_type_personal_union
				}
			}
			AND = {
				custom_tooltip = {
					text = brz_does_not_exist_tt
					NOT = {
						exists = c:BRZ
					}
				}
				owns_entire_state_region = STATE_RIO_DE_JANEIRO
			}
		}
	}

	when_taken = {
		set_variable = restored_kingdom_of_brazil_var
		if = {
			limit = {
				exists = c:BRZ
				c:BRZ ?= {
					is_subject_of = ROOT
				}
			}
			c:BRZ ?= {
				set_variable = kingdom_var
				if = {
					limit = {
						NOT = {
							has_law = law_type:law_monarchy
						}
					}
					activate_law = law_type:law_monarchy
				}
				change_subject_type = subject_type_personal_union
			}
		}
		else_if = {
			limit = {
				AND = {
					NOT = {
						exists = c:BRZ
					}
					owns_entire_state_region = STATE_RIO_DE_JANEIRO
				}
			}
			random_scope_state = {
				limit = {
					state_region = s:STATE_RIO_DE_JANEIRO
				}
				save_scope_as = rio_scope
			}
			custom_tooltip = {
				text = portugal_spawn_brazil_tt
				create_country = {
					origin = root
					tag = BRZ
					state = scope:rio_scope
					on_created = {
						set_variable = kingdom_var
					}
				}
				every_state_in_brazil = {
					limit = {
						OR = {
							owner ?= ROOT
							owner = {
								is_subject_of = ROOT
							}
						}
						NOT = {
							c:BRZ ?= owner
						}
					}
					set_state_owner = c:BRZ
				}
			}
			create_diplomatic_pact = {
				country = c:BRZ
				type = personal_union
			}
		}
		else = {
			custom_tooltip = {
				text = portugal_spawn_brazil_tt
			}
		}
	}

	ai_chance = {
		value = 100
	}
}
