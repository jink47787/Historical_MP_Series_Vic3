namespace = iberia

# Startup event
iberia.1 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = iberia.1.t
	desc = iberia.1.d
	flavor = iberia.1.f

    event_image = {
		video = "votp_monarch_holding_court"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		capital = {
			is_in_geographic_region = geographic_region_iberia
		}
		has_technology_researched = pan-nationalism
		NOR = {
			has_variable = pursued_iberian_unification
			has_variable = against_iberian_unification
			has_journal_entry = je_iberia
		}
	}

	cancellation_trigger = {

	}

	immediate = {

	}

	cooldown = { days = never_fire_again_modifier_time }

	option = {
		name = iberia.1.a_1
		trigger = {
			NOT = {
				has_law = law_type:law_council_republic
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				trigger = {
					ruler = {
						has_trait = ambitious
					}
				}
				add = 25
			}
			modifier = {
				trigger = {
					country_rank >= rank_value:major_power
				}
				add = 25
			}
			modifier = {
				trigger = {
					country_rank >= rank_value:great_power
				}
				add = 50
			}
			modifier = {
				trigger = {
					ruler = {
						has_trait = ambitious
					}
				}
				add = 25
			}
		}
		set_variable = pursued_iberian_unification
		custom_tooltip = je_iberia_activate_tt
		save_scope_as = iberia_forming_country
		every_country_in_iberia = {
			limit = {
				NOT = {
					has_variable = pursued_iberian_unification
					THIS = ROOT
				}
			}
			trigger_event = { id = iberia.11 popup = yes }
		}
	}

	option = {
		name = iberia.1.a_2
		trigger = {
			has_law = law_type:law_council_republic
		}
		ai_chance = {
			base = 100
			modifier = {
				trigger = {
					ruler = {
						has_trait = ambitious
					}
				}
				add = 25
			}
			modifier = {
				trigger = {
					country_rank >= rank_value:major_power
				}
				add = 25
			}
			modifier = {
				trigger = {
					country_rank >= rank_value:great_power
				}
				add = 50
			}
			modifier = {
				trigger = {
					has_law = law_type:law_anarchy
				}
				add = 100
			}
		}
		set_variable = pursued_iberian_unification
		custom_tooltip = je_iberia_activate_tt
		save_scope_as = iberia_forming_country
		every_country_in_iberia = {
			limit = {
				NOR = {
					has_variable = pursued_iberian_unification
					has_variable = against_iberian_unification
					THIS = ROOT
				}
			}
			trigger_event = { id = iberia.11 popup = yes }
		}
	}

	option = {
		name = iberia.1.b
		default_option = yes
		ai_chance = {
			base = 90
		}
		set_variable = against_iberian_unification
		custom_tooltip = je_iberia_discard_tt
		custom_tooltip = je_iberia_may_activate_again_warning_tt
	}
}

iberia.11 = { # Someone else is pursuing unification
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = iberia.11.t
	desc = iberia.11.d
	flavor = iberia.11.f

    event_image = {
		video = "votp_monarch_holding_court"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		NOR = {
			has_variable = pursued_iberian_unification
			has_variable = against_iberian_unification
		}
	}

	cancellation_trigger = {

	}

	immediate = {
	}

	cooldown = { days = never_fire_again_modifier_time }

	option = {
		name = iberia.1.a_1
		trigger = {
			NOT = {
				has_law = law_type:law_council_republic
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				trigger = {
					ruler = {
						has_trait = ambitious
					}
				}
				add = 10
			}
			modifier = {
				trigger = {
					"scope:iberia_forming_country.relations(ROOT)" > relations_threshold:cordial
				}
				add = 10
			}
			modifier = {
				trigger = {
					"scope:iberia_forming_country.relations(ROOT)" > relations_threshold:amicable
				}
				add = 10
			}
			modifier = {
				trigger = {
					"scope:iberia_forming_country.relations(ROOT)" > relations_threshold:friendly
				}
				add = 10
			}
			modifier = {
				trigger = {
					is_in_same_power_bloc = scope:iberia_forming_country
				}
				add = 60
			}
			modifier = {
				trigger = {
					country_rank >= rank_value:great_power
				}
				add = 50
			}
		}
		if = {
			limit = {
				NOT = {
					is_involved_in_journal_entry = je_iberia
				}
			}
			je:je_iberia = {
				add_involved_country = ROOT
			}
		}
	}

	option = {
		name = iberia.1.a_2
		trigger = {
			has_law = law_type:law_council_republic
		}
		ai_chance = {
			base = 100
			modifier = {
				trigger = {
					ruler = {
						has_trait = ambitious
					}
				}
				add = 10
			}
			modifier = {
				trigger = {
					"scope:iberia_forming_country.relations(ROOT)" >= relations_threshold:cordial
				}
				add = 10
			}
			modifier = {
				trigger = {
					"scope:iberia_forming_country.relations(ROOT)" >= relations_threshold:amicable
				}
				add = 10
			}
			modifier = {
				trigger = {
					"scope:iberia_forming_country.relations(ROOT)" >= relations_threshold:friendly
				}
				add = 10
			}
			modifier = {
				trigger = {
					country_rank >= rank_value:great_power
				}
				add = 50
			}
			modifier = {
				trigger = {
					is_in_same_power_bloc = scope:iberia_forming_country
				}
				add = 60
			}
			modifier = {
				trigger = {
					has_law = law_type:law_anarchy
				}
				add = 100
			}
		}
		if = {
			limit = {
				NOT = {
					is_involved_in_journal_entry = je_iberia
				}
			}
			je:je_iberia = {
				add_involved_country = ROOT
			}
		}
	}

	option = {
		name = iberia.1.b
		default_option = yes
		ai_chance = {
			base = 90
			modifier = {
				trigger = {
					"scope:iberia_forming_country.relations(ROOT)" >= relations_threshold:cordial
				}
				add = -10
			}
			modifier = {
				trigger = {
					"scope:iberia_forming_country.relations(ROOT)" >= relations_threshold:amicable
				}
				add = -10
			}
			modifier = {
				trigger = {
					"scope:iberia_forming_country.relations(ROOT)" >= relations_threshold:friendly
				}
				add = -10
			}
			modifier = {
				trigger = {
					is_in_same_power_bloc = scope:iberia_forming_country
				}
				add = -10
			}
			modifier = {
				trigger = {
					is_subject = yes
					overlord ?= {
						is_in_geographic_region = geographic_region_iberia
					}
				}
				add = -1000
			}
		}
		set_variable = against_iberian_unification
		custom_tooltip = je_iberia_discard_tt
		custom_tooltip = je_iberia_made_visible_tt
		change_relations = {
			country = scope:iberia_forming_country
			value = -20
		}
	}
}

# Formation event
iberia.2 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = iberia.2.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = iberia.2.d_1
				trigger = {
					has_law = law_type:law_anarchy
				}
			}
			triggered_desc = {
				desc = iberia.2.d_2
				trigger = {
					has_law_or_variant = law_type:law_council_republic
				}
			}
			triggered_desc = {
				desc = iberia.2.d_3
				trigger = {
					has_law = law_type:law_monarchy
				}
			}
			triggered_desc = {
				desc = iberia.2.d_4
				trigger = {
					has_law = law_type:law_theocracy
				}
			}
			triggered_desc = {
				desc = iberia.2.d_5
				trigger = {
					always = yes
				}
			}
		}
	}
	flavor = iberia.2.f

    event_image = {
		video = "unspecific_ruler_speaking_to_people"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		capital = {
			is_in_geographic_region = geographic_region_iberia
		}
		has_technology_researched = pan-nationalism
	}

	cancellation_trigger = {

	}

	immediate = {
		set_global_variable = has_formed_ibe
		save_scope_as = formation_country
		every_country = {
			limit = {
				has_diplomatic_relevance = ROOT
			}
			post_notification = unification_notification_ibe
		}
	}

	option = {
		name = iberia.2.a
		default_option = yes
		trigger = {
			coa_republic_trigger = yes
			NOT = {
				has_law = law_type:law_council_republic
			}
		}
		add_modifier = {
			name = unification_prestige
			days = very_long_modifier_time
		}
		unification_claims_effect = yes
		custom_tooltip = iberia_with_union_flag_tt
	}

	option = {
		name = iberia.2.b
		trigger = {
			coa_republic_trigger = yes
			NOT = {
				has_law = law_type:law_council_republic
			}
		}
		add_modifier = {
			name = unification_prestige
			days = very_long_modifier_time
		}
		unification_claims_effect = yes
		custom_tooltip = iberia_with_tricolor_flag_tt
		set_variable = iberia_republic_2
	}

	option = {
		name = iberia.2.c
		trigger = {
			coa_republic_trigger = yes
			NOT = {
				has_law = law_type:law_council_republic
			}
		}
		add_modifier = {
			name = unification_prestige
			days = very_long_modifier_time
		}
		unification_claims_effect = yes
		custom_tooltip = iberia_with_federal_flag_tt
		set_variable = iberia_republic_3
	}

	option = {
		name = iberia.2.e
		trigger = {
			coa_communist_trigger = yes
		}
		add_modifier = {
			name = communist_unification_prestige
			days = very_long_modifier_time
		}
		unification_claims_effect = yes
	}

	option = {
		name = iberia.2.g
		trigger = {
			NOR = {
				coa_communist_trigger = yes
				coa_republic_trigger = yes
			}
		}
		add_modifier = {
			name = unification_prestige
			days = very_long_modifier_time
		}
		unification_claims_effect = yes
	}
}

iberia.3 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = iberia.3.t
	desc = iberia.3.d
	flavor = iberia.3.f

    event_image = {
		video = "ip4_university_lecture"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		capital = {
			is_in_geographic_region = geographic_region_iberia
		}
		has_technology_researched = pan-nationalism
	}

	cancellation_trigger = {
		NOT = {
			is_involved_in_journal_entry = je_iberia
		}
	}

	immediate = {

	}

	option = {
		name = iberia.3.a
		default_option = yes
		custom_tooltip = esperanto_optional_tt
		je:je_iberia = {
			set_variable = { name = esperanto_var value = 1 }
		}
		add_radicals = {
			value = small_radicals
		}
	}

	option = {
		name = iberia.3.b
		custom_tooltip = esperanto_mandatory_tt
		je:je_iberia = {
			set_variable = { name = esperanto_var value = 2 }
		}
		add_radicals = {
			value = large_radicals
		}
	}

	option = {
		name = iberia.3.c
		custom_tooltip = esperanto_mandatory_tt
		je:je_iberia = {
			set_variable = { name = esperanto_var value = 2 }
			set_variable = esperantia_var
		}
		add_radicals = {
			value = large_radicals
		}
		custom_tooltip = esperantia_tt
	}
}
