namespace = two_spains

# Startup event
two_spains.1 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = two_spains.1.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = two_spains.1.d_1
				trigger = {
					ruler ?= {
						NOT = {
							has_ideology = ideology:ideology_carlist
						}
					}
				}
			}
			triggered_desc = {
				desc = two_spains.1.d_2
				trigger = {
					ruler ?= {
						has_ideology = ideology:ideology_carlist
					}
				}
			}
		}
	}
	flavor = two_spains.1.f

    event_image = {
		video = "votp_monarch_holding_court"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		is_revolutionary = no
        is_secessionist = no
        NOR = {
            has_law_or_variant = law_type:law_council_republic
			has_variable = two_spains_initialised
        }
	}

	cancellation_trigger = {
		OR = {
			is_revolutionary = yes
			is_secessionist = yes
			has_law_or_variant = law_type:law_council_republic
		}
	}

	immediate = {
		set_variable = two_spains_initialised
	}

	option = {
		name = two_spains.1.a
		default_option = yes
		show_as_tooltip = {
			add_journal_entry = { type = je_the_two_spains }
		}
		if = {
			limit = {
				NOT = {
					any_political_movement = {
						is_political_movement_type = movement_liberal
					}
				}
			}
			create_political_movement = { type = movement_liberal }
		}
		if = {
			limit = {
				NOT = {
					any_political_movement = {
						is_political_movement_type = movement_carlist
					}
				}
			}
			create_political_movement = { type = movement_carlist }
		}
	}
}

# Liberal Victory
two_spains.2 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = two_spains.2.t
	desc = two_spains.2.d
	flavor = two_spains.2.f

    event_image = {
		video = "votp_agitator_speaking"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		# Triggered by Journal Entry
	}

	cancellation_trigger = {

	}

	immediate = {
		set_variable = spa_two_spains_liberal_victory
	}

	option = {
		name = two_spains.2.a
		default_option = yes
		custom_tooltip = two_spains_liberal_ideologies_tt
		add_loyalists = {
			value = large_radicals
			strata = middle
		}
		add_loyalists = {
			value = large_radicals
			strata = lower
		}
		if = {
			limit = {
				country_has_voting_franchise = yes
			}
			add_modifier = {
				name = modifier_libertad_igualdad_fraternidad
				days = stupidly_long_modifier_time
				is_decaying = yes
			}
		}
		else = {
			add_modifier = {
				name = modifier_libertad_igualdad_fraternidad_no_voting
				days = stupidly_long_modifier_time
				is_decaying = yes
			}
		}
		ig:ig_armed_forces = {
			if = {
				limit = {
					has_ideology = ideology:ideology_conservative_praetorian
				}
				remove_ideology = ideology_conservative_praetorian
			}
			if = {
				limit = {
					NOT = {
						has_ideology = ideology:ideology_liberal_praetorian
					}
				}
				add_ideology = ideology_liberal_praetorian
			}
		}
	}

	option = {
		name = two_spains.2.b
		custom_tooltip = two_spains_liberal_ideologies_tt
		custom_tooltip = two_spains_military_liberal_ideologies_tt
		set_variable = spa_liberal_military_var
		ig:ig_armed_forces ?= {
			add_modifier = { name = modifier_republican_spirit days = stupidly_long_modifier_time is_decaying = yes }
			remove_ideology = ideology_patriotic
			add_ideology = ideology_republican
		}
		ig:ig_armed_forces = {
			if = {
				limit = {
					has_ideology = ideology:ideology_conservative_praetorian
				}
				remove_ideology = ideology_conservative_praetorian
			}
			if = {
				limit = {
					NOT = {
						has_ideology = ideology:ideology_liberal_praetorian
					}
				}
				add_ideology = ideology_liberal_praetorian
			}
		}
	}
}

# Conservative Victory
two_spains.3 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = two_spains.3.t
	desc = two_spains.3.d
	flavor = two_spains.3.f

    event_image = {
		video = "southamerica_christianity"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		# Triggered by Journal Entry
	}

	cancellation_trigger = {

	}

	immediate = {
		set_variable = spa_two_spains_conservative_victory
	}

	option = {
		name = two_spains.3.a
		default_option = yes
		custom_tooltip = two_spains_conservative_ideologies_tt
		add_modifier = { name = modifier_god_fatherland_fuero_king days = stupidly_long_modifier_time is_decaying = yes }
		add_loyalists = {
			value = very_large_radicals
			pop_type = aristocrats
		}
		add_loyalists = {
			value = very_large_radicals
			pop_type = clergymen
		}
		add_loyalists = {
			value = very_large_radicals
			pop_type = peasants
		}
		ig:ig_armed_forces = {
			if = {
				limit = {
					has_ideology = ideology:ideology_liberal_praetorian
				}
				remove_ideology = ideology_liberal_praetorian
			}
			if = {
				limit = {
					NOT = {
						has_ideology = ideology:ideology_conservative_praetorian
					}
				}
				add_ideology = ideology_conservative_praetorian
			}
		}
	}

	option = {
		name = two_spains.3.b
		custom_tooltip = two_spains_conservative_ideologies_tt
		add_modifier = { name = modifier_the_world_made_right_again days = stupidly_long_modifier_time is_decaying = yes }
		ig:ig_devout = {
			add_modifier = {
				name = modifier_shepherds_of_revelation
				days = stupidly_long_modifier_time
			}
		}
		ig:ig_armed_forces = {
			if = {
				limit = {
					has_ideology = ideology:ideology_liberal_praetorian
				}
				remove_ideology = ideology_liberal_praetorian
			}
			if = {
				limit = {
					NOT = {
						has_ideology = ideology:ideology_conservative_praetorian
					}
				}
				add_ideology = ideology_conservative_praetorian
			}
		}
	}
}

# Glorious Revolution
two_spains.4 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = {
		first_valid = {
			triggered_desc = {
				desc = two_spains.4.t_1
				trigger = {
					NOT = {
						has_variable = glorious_revolution_var
					}
				}
			}
			triggered_desc = {
				desc = two_spains.4.t_2
				trigger = {
					has_variable = glorious_revolution_var
				}
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				desc = two_spains.4.d_1
				trigger = {
					NOT = {
						scope:golpista_general ?= {
							is_ruler = yes
						}
					}
				}
			}
			triggered_desc = {
				desc = two_spains.4.d_2
				trigger = {
					scope:golpista_general ?= {
						is_ruler = yes
					}
				}
			}
		}
	}
	flavor = two_spains.4.f

    event_image = {
		video = "ip4_abdication"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		# Triggered by Coup
	}

	cancellation_trigger = {

	}

	immediate = {
		random_character_in_void = {
			limit = {
				has_variable = deposed_spanish_monarch
			}
			save_scope_as = deposed_spanish_monarch
			if = {
				limit = {
					has_variable = house_bourbon
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 1 } }
			}
			if = {
				limit = {
					has_variable = house_hohenzollern
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 2 } }
			}
			if = {
				limit = {
					has_variable = house_savoy
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 3 } }
			}
			if = {
				limit = {
					has_variable = house_espartero
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 4 } }
			}
			if = {
				limit = {
					has_variable = house_bonaparte
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 5 } }
			}
			if = {
				limit = {
					has_variable = house_braganca
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 6 } }
			}
		}
		save_scope_as = spain_scope
	}

	option = { # Journal Entry
		name = two_spains.4.a
		set_variable = glorious_revolution_var
		custom_tooltip = {
			text = activate_provisional_government_tt
			add_journal_entry = { type = je_spain_provisional_government }
		}
	}
}

# Glorious Revolution - Debug event
two_spains.41 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	orphan = yes

	title = {
		first_valid = {
			triggered_desc = {
				desc = two_spains.4.t_1
				trigger = {
					NOT = {
						has_variable = glorious_revolution_var
					}
				}
			}
			triggered_desc = {
				desc = two_spains.4.t_2
				trigger = {
					has_variable = glorious_revolution_var
				}
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				desc = two_spains.4.d_1
				trigger = {
					NOT = {
						scope:golpista_general ?= {
							is_ruler = yes
						}
					}
				}
			}
			triggered_desc = {
				desc = two_spains.4.d_2
				trigger = {
					scope:golpista_general ?= {
						is_ruler = yes
					}
				}
			}
		}
	}
	flavor = two_spains.4.f

    event_image = {
		video = "ip4_abdication"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		# Triggered by Coup
	}

	cancellation_trigger = {

	}

	immediate = {
		remove_regency_modifier = yes
		random_scope_character = {
			limit = {
				OR = {
					has_role = general
					has_role = admiral
				}
			}
			save_scope_as = golpista_general
			interest_group = {
				save_scope_as = golpista_ig
			}
		}
		add_modifier = modifier_regency
		hidden_effect = {
			heir ?= {
				set_variable = deposed_spanish_heir
				place_character_in_void = 500
			}
			ruler = {
				set_variable = deposed_spanish_monarch
				place_character_in_void = 500
			}
		}
		scope:golpista_ig.leader ?= {
			set_character_as_ruler = yes
		}
		set_variable = glorious_revolution_coup_var
		random_character_in_void = {
			limit = {
				has_variable = deposed_spanish_monarch
			}
			save_scope_as = deposed_spanish_monarch
			if = {
				limit = {
					has_variable = house_bourbon
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 1 } }
			}
			if = {
				limit = {
					has_variable = house_hohenzollern
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 2 } }
			}
			if = {
				limit = {
					has_variable = house_savoy
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 3 } }
			}
			if = {
				limit = {
					has_variable = house_espartero
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 4 } }
			}
			if = {
				limit = {
					has_variable = house_bonaparte
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 5 } }
			}
			if = {
				limit = {
					has_variable = house_braganca
				}
				ROOT = { set_variable = { name = spa_couped_dynasty value = 6 } }
			}
		}
		save_scope_as = spain_scope
	}

	option = { # Journal Entry
		name = two_spains.4.a
		set_variable = glorious_revolution_var
		custom_tooltip = {
			text = activate_provisional_government_tt
			add_journal_entry = { type = je_spain_provisional_government }
		}
	}
}
