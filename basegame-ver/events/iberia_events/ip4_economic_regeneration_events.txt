namespace = spa_economic_regeneration_events

# Initial Event
spa_economic_regeneration_events.1 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spa_economic_regeneration_events.1.t
	desc = spa_economic_regeneration_events.1.d
	flavor = spa_economic_regeneration_events.1.f

	event_image = {
		video = "southamerica_aristocrats"
	}

	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	trigger = {
		# Fired by Journal Entry
	}

	cancellation_trigger = {
	}

	immediate = {
	}

	option = {
		name = spa_economic_regeneration_events.1.a
		default_option = yes
		custom_tooltip = {
			text = spa_economic_regeneration_events.1.tt_1
			set_variable = economic_regeneration_started_var
		}
		custom_tooltip = spa_economic_regeneration_events.1.tt_2
		add_journal_entry = {
			type = je_spa_economic_regeneration_land_reform
		}
		add_journal_entry = {
			type = je_spa_economic_regeneration_modernise_agriculture
		}
		add_journal_entry = {
			type = je_spa_economic_regeneration_mining
		}
		add_journal_entry = {
			type = je_spa_economic_regeneration_light_industry
		}
		add_journal_entry = {
			type = je_spa_economic_regeneration_railways
		}
		add_journal_entry = {
			type = je_spa_economic_regeneration_ultramar
		}
	}

	option = {
		name = spa_economic_regeneration_events.1.b
		custom_tooltip = {
			text = spa_economic_regeneration_events.1.tt_3
		}
		add_modifier = {
			name = modifier_economic_regeneration_postponed
			days = normal_modifier_time
		}
		set_variable = economic_regeneration_postponed_var
	}
}

spa_economic_regeneration_events.2 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spa_economic_regeneration_events.2.t
	desc = spa_economic_regeneration_events.2.d
	flavor = spa_economic_regeneration_events.2.f

	event_image = {
		video = "ep1_octopus"
	}

	icon = "gfx/interface/icons/event_icons/event_protest.dds"

	trigger = {
		# Fired by Journal Entry
	}

	cancellation_trigger = {
	}

	immediate = {
	}

	# Give up
	option = {
		name = spa_economic_regeneration_events.2.a
		default_option = yes
		custom_tooltip = spa_economic_regeneration_events.2.tt_1
		add_modifier = {
			name = modifier_regeneration_target_manipulations_revealed
			days = normal_modifier_time
		}
	}

	# Throw money at the problem, and lessen the requirements regardless
	option = {
		name = spa_economic_regeneration_events.2.b
		custom_tooltip = {
			text = je_spa_economic_regeneration_cheat_button_success_tt
			if = {
				limit = {
					has_variable = je_spa_economic_regeneration_mining_caught_var
					exists = je:je_spa_economic_regeneration_mining
				}
				je:je_spa_economic_regeneration_mining = {
					set_variable = je_spa_economic_regeneration_creative_accounting_var
				}
			}
			else_if = {
				limit = {
					has_variable = je_spa_economic_regeneration_light_industry_caught_var
					exists = je:je_spa_economic_regeneration_light_industry
				}
				je:je_spa_economic_regeneration_light_industry = {
					set_variable = je_spa_economic_regeneration_creative_accounting_var
				}
			}
			else_if = {
				limit = {
					has_variable = je_spa_economic_regeneration_land_reform_caught_var
					exists = je:je_spa_economic_regeneration_land_reform
				}
				je:je_spa_economic_regeneration_land_reform = {
					set_variable = je_spa_economic_regeneration_creative_accounting_var
				}
			}
			else_if = {
				limit = {
					has_variable = je_spa_economic_regeneration_railways_caught_var
					exists = je:je_spa_economic_regeneration_railways
				}
				je:je_spa_economic_regeneration_railways = {
					set_variable = je_spa_economic_regeneration_creative_accounting_var
				}
			}
			else_if = {
				limit = {
					has_variable = je_spa_economic_regeneration_modernise_agriculture_caught_var
					exists = je:je_spa_economic_regeneration_modernise_agriculture
				}
				je:je_spa_economic_regeneration_modernise_agriculture = {
					set_variable = je_spa_economic_regeneration_creative_accounting_var
				}
			}
			else_if = {
				limit = {
					has_variable = je_spa_economic_regeneration_ultramar_caught_var
					exists = je:je_spa_economic_regeneration_ultramar
				}
				je:je_spa_economic_regeneration_ultramar = {
					set_variable = je_spa_economic_regeneration_creative_accounting_var
				}
			}
		}
		add_modifier = {
			name = modifier_press_campaign_expenses
			days = normal_modifier_time
			multiplier = money_amount_multiplier_medium
		}
		add_modifier = {
			name = modifier_divisive_press_campaign
			days = normal_modifier_time
		}
	}
}

spa_economic_regeneration_events.3 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spa_economic_regeneration_events.3.t
	desc = spa_economic_regeneration_events.3.d
	flavor = spa_economic_regeneration_events.3.f

	event_image = {
		video = "ip4_mining_scene"
	}

	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	cooldown = { days = normal_modifier_time }

	trigger = {
		# Fired by Journal Entry
	}

	cancellation_trigger = {
	}

	immediate = {
        s:STATE_ASTURIAS = {
        	random_scope_state = {
            	save_scope_as = asturias_scope
            }
        }
        s:STATE_BASQUE_COUNTRY = {
        	random_scope_state = {
        	    save_scope_as = basque_country_scope
        	}
        }
        s:STATE_LOWER_ANDALUSIA = {
            random_scope_state = {
            	save_scope_as = lower_andalusia_scope
            }
        }
        s:STATE_MURCIA = {
        	random_scope_state = {
            	save_scope_as = murcia_scope
            }
        }
	}

	option = {
		name = spa_economic_regeneration_events.3.a
		default_option = yes
		trigger = {
			any_scope_state = {
				has_state_trait = state_trait_somorrostro_valley
			}
		}
		if = {
			limit = {
				has_variable = je_spa_economic_regeneration_mining_success_var
			}
			random_scope_state = {
				limit = {
					has_state_trait = state_trait_somorrostro_valley
				}
				state_region = {
					remove_state_trait = state_trait_somorrostro_valley
					add_state_trait = state_trait_somorrostro_valley_upgraded
				}
			}
		}
		else = {
			random_scope_state = {
				limit = {
					has_state_trait = state_trait_somorrostro_valley
				}
				add_modifier = {
					name = modifier_local_mining_boom
					days = normal_modifier_time
				}
			}
		}
	}

	option = {
		name = spa_economic_regeneration_events.3.b
		trigger = {
			any_scope_state = {
				has_state_trait = state_trait_riotinto_basin
			}
		}
		if = {
			limit = {
				has_variable = je_spa_economic_regeneration_mining_success_var
			}
			random_scope_state = {
				limit = {
					has_state_trait = state_trait_riotinto_basin
				}
				state_region = {
					remove_state_trait = state_trait_riotinto_basin
					add_state_trait = state_trait_riotinto_basin_upgraded
				}
			}
		}
		else = {
			random_scope_state = {
				limit = {
					has_state_trait = state_trait_riotinto_basin
				}
				add_modifier = {
					name = modifier_local_mining_boom
					days = normal_modifier_time
				}
			}
		}
	}

	option = {
		name = spa_economic_regeneration_events.3.c
		trigger = {
			any_scope_state = {
				has_state_trait = state_trait_sierra_minera_de_cartagena
			}
		}
		if = {
			limit = {
				has_variable = je_spa_economic_regeneration_mining_success_var
			}
			random_scope_state = {
				limit = {
					has_state_trait = state_trait_sierra_minera_de_cartagena
				}
				state_region = {
					remove_state_trait = state_trait_sierra_minera_de_cartagena
					add_state_trait = state_trait_sierra_minera_de_cartagena_upgraded
				}
			}
		}
		else = {
			random_scope_state = {
				limit = {
					has_state_trait = state_trait_sierra_minera_de_cartagena
				}
				add_modifier = {
					name = modifier_local_mining_boom
					days = normal_modifier_time
				}
			}
		}
	}

	option = {
		name = spa_economic_regeneration_events.3.e
		trigger = {
			any_scope_state = {
				has_state_trait = state_trait_cuencas_mineras
			}
		}
		if = {
			limit = {
				has_variable = je_spa_economic_regeneration_mining_success_var
			}
			random_scope_state = {
				limit = {
					has_state_trait = state_trait_cuencas_mineras
				}
				state_region = {
					remove_state_trait = state_trait_cuencas_mineras
					add_state_trait = state_trait_cuencas_mineras_upgraded
				}
			}
		}
		else = {
			random_scope_state = {
				limit = {
					has_state_trait = state_trait_cuencas_mineras
				}
				add_modifier = {
					name = modifier_local_mining_boom
					days = normal_modifier_time
				}
			}
		}
	}
}


# Initial Event (after havig postponed reformns)
spa_economic_regeneration_events.4 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spa_economic_regeneration_events.4.t
	desc = spa_economic_regeneration_events.4.d
	flavor = spa_economic_regeneration_events.4.f

	event_image = {
		video = "unspecific_politicians_arguing"
	}

	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	trigger = {
		# Fired by Journal Entry
	}

	cancellation_trigger = {
	}

	immediate = {
	}

	option = {
		name = spa_economic_regeneration_events.4.a
		default_option = yes
		custom_tooltip = {
			text = spa_economic_regeneration_events.1.tt_1
			set_variable = economic_regeneration_started_var
		}
		custom_tooltip = spa_economic_regeneration_events.1.tt_2
		add_journal_entry = {
			type = je_spa_economic_regeneration_land_reform
		}
		add_journal_entry = {
			type = je_spa_economic_regeneration_modernise_agriculture
		}
		add_journal_entry = {
			type = je_spa_economic_regeneration_mining
		}
		add_journal_entry = {
			type = je_spa_economic_regeneration_light_industry
		}
		add_journal_entry = {
			type = je_spa_economic_regeneration_railways
		}
		if = {
			limit = {
				OR = {
					any_subject_or_below = {
						OR = {
							is_subject_type = subject_type_colony
							is_subject_type = subject_type_dominion
							is_subject_type = subject_type_chartered_company
						}
					}
					any_scope_state = {
						NOT = {
							is_in_geographic_region = geographic_region_europe
						}
						count > 1
					}
				}
			}
			add_journal_entry = {
				type = je_spa_economic_regeneration_ultramar
			}
		}
	}

	option = {
		name = spa_economic_regeneration_events.4.b
		custom_tooltip = {
			text = spa_economic_regeneration_events.1.tt_3
		}
		add_modifier = {
			name = modifier_economic_regeneration_postponed
			days = normal_modifier_time
			multiplier = 2
		}
		custom_tooltip = {
			text = spa_economic_regeneration_events.4.tt
		}
	}
}

# Completion Event
spa_economic_regeneration_events.5 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spa_economic_regeneration_events.5.t
	desc = spa_economic_regeneration_events.5.d
	flavor = spa_economic_regeneration_events.5.f

	event_image = {
		video = "unspecific_world_fair"
	}

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	trigger = {
		# Fired by Journal Entry
	}

	cancellation_trigger = {
	}

	immediate = {
	}

	option = {
		name = spa_economic_regeneration_events.5.a
		default_option = yes
        if = {
            limit = {
                NOT = {
                    has_variable = reduced_economic_objectives_var
                }
            }
            add_modifier = {
                name = modifier_economic_regeneration_reward_greater
				days = very_long_modifier_time
            }
            ruler = {
                add_modifier = {
                    name = modifier_great_reformer
                }
            }
			active_law:lawgroup_economic_system ?= {
				add_amendment = {
					type = amendment_economic_regeneration_1
					sponsor = PREV.ig:ig_industrialists
					cooldown = 240
				}
			}
        }
        else_if = {
            limit = {
                has_variable = reduced_economic_objectives_var
            }
            add_modifier = {
                name = modifier_economic_regeneration_reward_lesser
				days = very_long_modifier_time
            }
            ruler = {
                add_modifier = {
                    name = modifier_capable_reformer
                }
            }
			active_law:lawgroup_economic_system ?= {
				add_amendment = {
					type = amendment_economic_regeneration_2
					sponsor = PREV.ig:ig_industrialists
					cooldown = 240
				}
			}
        }
	}
}


# Fail Event
spa_economic_regeneration_events.6 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spa_economic_regeneration_events.6.t
	desc = spa_economic_regeneration_events.6.d
	flavor = spa_economic_regeneration_events.6.f

	event_image = {
		video = "ip4_abdication"
	}

	icon = "gfx/interface/icons/event_icons/event_protest.dds"

	trigger = {
		# Fired by Journal Entry
	}

	cancellation_trigger = {
	}

	immediate = {
	}

	option = {
		name = spa_economic_regeneration_events.6.a
		default_option = yes
        if = {
            limit = {
                NOT = {
                    has_variable = reduced_economic_objectives_var
                }
            }
            if = {
                limit = {
                    var:spa_economic_regeneration_var >= 4
                }
                add_modifier = {
                    name = modifier_failed_economic_regeneration
                    days = long_modifier_time
                    multiplier = 0.5
                }
            }
            else = {
                add_modifier = {
                    name = modifier_failed_economic_regeneration
                    days = long_modifier_time
                }
            }
        }
        else_if = {
            limit = {
                has_variable = reduced_economic_objectives_var
            }
            if = {
                limit = {
                    var:spa_economic_regeneration_var >= 2
                }
                add_modifier = {
                    name = modifier_failed_economic_regeneration
                    days = long_modifier_time
                    multiplier = 0.5
                }
                custom_tooltip = je_spa_economic_regeneration_master_timeout_tt_2
            }
            else = {
                add_modifier = {
                    name = modifier_failed_economic_regeneration
                    days = long_modifier_time
                }
            }
        }
	}
}
