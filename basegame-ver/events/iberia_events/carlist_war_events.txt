namespace = carlist_war

# The Royal Expedition
carlist_war.1 = {
    type = country_event
    placement = ROOT

    duration = 3

	title = carlist_war.1.t
	desc = carlist_war.1.d
	flavor = carlist_war.1.f

    event_image = {
		video = "europenorthamerica_before_the_battle"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_carlist_beret.dds"

    trigger = {
		# triggered in JE
	}

    immediate = {
		c:SPA.capital = {
			save_scope_as = capital_scope
		}
		c:SPC.ruler = {
			save_scope_as = spc_carlos
		}
		if = {
			limit = {
				c:SPC ?= this
			}
			show_as_tooltip = {
				add_modifier = {
					name = the_last_stand
					multiplier = {
						value = global_var:spc_carlist_war_score
						min = 1
					}
					years = 1
					is_decaying = yes
				}
			}
		}
		if = {
			limit = {
				c:SPA ?= this
			}
			show_as_tooltip = {
				add_modifier = {
					name = galvanized_forces
					multiplier = {
						value = global_var:spa_carlist_war_score
						min = 1
					}
					years = 2
					is_decaying = yes
				}
			}
		}
	}

	option = {
		name = {
			trigger = { c:SPA ?= this }
			text = carlist_war.1.a
		}
		name = {
			trigger = { c:SPC ?= this }
			text = carlist_war.1.a.spc
		}
        default_option = yes

		show_as_tooltip = {
			c:SPC ?= {
				add_modifier = {
					name = the_last_stand
					multiplier = {
						value = global_var:spc_carlist_war_score
						min = 1
					}
					years = 1
					is_decaying = yes
				}
			}
			c:SPA ?= {
				add_modifier = {
					name = galvanized_forces
					multiplier = {
						value = global_var:spa_carlist_war_score
						min = 1
					}
					years = 2
					is_decaying = yes
				}
			}
		}
	}
}

# Carlist War Victory
carlist_war.2 = {
    type = country_event
    placement = ROOT

    duration = 3

	title = {
		first_valid = {
			triggered_desc = {
				desc = carlist_war.2.t_1
				trigger = {
					NOT = {
						has_variable = is_carlist_spain
					}
				}
			}
			triggered_desc = {
				desc = carlist_war.2.t_2
				trigger = {
					has_variable = is_carlist_spain
				}
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				desc = carlist_war.2.d_1
				trigger = {
					NOT = {
						has_variable = is_carlist_spain
					}
				}
			}
			triggered_desc = {
				desc = carlist_war.2.d_2
				trigger = {
					has_variable = is_carlist_spain
				}
			}
		}
	}
	flavor = {
		first_valid = {
			triggered_desc = {
				desc = carlist_war.2.f_1
				trigger = {
					NOT = {
						has_variable = is_carlist_spain
					}
				}
			}
			triggered_desc = {
				desc = carlist_war.2.f_2
				trigger = {
					has_variable = is_carlist_spain
				}
			}
		}
	}

	event_image = {
		video = "unspecific_military_parade"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

    trigger = {
		# triggered in JE
	}

    immediate = {
		if = {
			limit = {
				has_gov_regency = yes
			}
			heir ?= {
				save_scope_as = country_ruler
			}
		}
		else = {
			ruler ?= {
				save_scope_as = country_ruler
			}
		}
		capital ?= {
			save_scope_as = capital_scope
		}

		### For Liberals
		if = {
			limit = {
				any_scope_character = {
					has_template = SPA_baldomero_espartero
					has_role = general
				}
			}
			random_scope_character = {
				limit = {
					has_template = SPA_baldomero_espartero
					has_role = general
				}
				save_scope_as = vergara_general
			}
		}
		else = {
			random_scope_character = {
				limit = {
					has_role = general
				}
				save_scope_as = vergara_general
			}
		}
	}

	option = {
		name = carlist_war.2.a
        default_option = yes
		if = {
			limit = {
				has_variable = is_carlist_spain
			}
			show_as_tooltip = {
				add_modifier = {
					name = carlist_war_spc_reward
					years = 20
					is_decaying = yes
				}
			}
		}
		else = {
			show_as_tooltip = {
				add_modifier = {
					name = carlist_war_spa_reward
					years = 20
					is_decaying = yes
				}
			}
		}
		custom_tooltip = {
			text = the_two_spains_tt
			set_variable = { name = carlist_dramatic_tension_var days = 180 }
		}
	}
}

# The Basque Fueros
carlist_war.3 = {
    type = country_event
    placement = scope:basque_country_scope

	cooldown = { days = never_fire_again_modifier_time }

    duration = 3

	title = carlist_war.3.t
	desc = carlist_war.3.d
	flavor = carlist_war.3.f

	dlc = dlc016

    event_image = {
		video = "southamerica_aristocrats"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_carlist_beret.dds"

    trigger = {
		has_dlc_feature = ip4_content
		has_variable = is_carlist_spain
		any_scope_state = {
			state_region = s:STATE_BASQUE_COUNTRY
		}
		has_law = law_type:law_monarchy
		has_law = law_type:law_subjecthood
	}

	immediate = {
		ruler ?= {
			save_scope_as = don_carlos_scope
		}
		random_scope_State = {
			limit = {
				state_region = s:STATE_BASQUE_COUNTRY
			}
			save_scope_as = basque_country_scope
		}
	}

	option = { # We love the Basque, dont we folks?
		name = carlist_war.3.a
		default_option = yes

		if = {
			limit = {
				has_journal_entry = je_the_two_spains
			}
			custom_tooltip = {
				text = two_spains_fueros_conservative_drift_tt

				je:je_the_two_spains ?= {
					add_progress = {
						value = {
							add = two_spains_fueros_conservative_drift
							multiply = -1
						}
						name = je_two_spains_progress_bar
					}
				}
			}
		}
		active_law:lawgroup_citizenship ?= {
			add_amendment = {
				type = amendment_reinstated_fueros
				sponsor = PREV.ig:ig_rural_folk
			}
		}
		show_as_tooltip = {
			random_scope_state = {
				limit = {
					state_region = s:STATE_BASQUE_COUNTRY
				}
				add_modifier = {
					name = spc_state_fueros_restored
				}
			}
		}
		add_loyalists = {
			culture = cu:basque
			value = large_radicals
		}

		ai_chance = {
			base = 9
		}
	}
	option = { # Press this for Basque Space Program
		name = carlist_war.3.b

		je:je_the_two_spains ?= {
			add_progress = { value = 10 name = je_two_spains_tension_bar }
		}
		add_radicals = {
			culture = cu:basque
			value = {
				add = huge_radicals
				multiply = 2 # Yes
			}
		}
		if = {
			limit = {
				NOT = {
					any_political_movement = {
						is_political_movement_type = movement_cultural_minority
						culture = cu:basque
					}
				}
			}
			create_political_movement = { type = movement_cultural_minority culture = cu:basque }
		}

		ai_chance = {
			base = 1

			modifier = {
				trigger = {
					taking_loans = yes
				}
				add = 4
			}
		}
	}
}

# Retrocession of Church Assets
carlist_war.4 = {
    type = country_event
    placement = ROOT

	cooldown = { days = never_fire_again_modifier_time }

    duration = 3

	title = carlist_war.4.t
	desc = carlist_war.4.d
	flavor = carlist_war.4.f

	dlc = dlc016

    event_image = {
		video = "southamerica_christianity"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_carlist_beret.dds"

    trigger = {
		has_dlc_feature = ip4_content
		has_variable = is_carlist_spain
	}

	immediate = {}

	option = { # I LOVE THE POPE
		name = carlist_war.4.a
		default_option = yes

		custom_tooltip = {
			text = two_spains_church_restitution_conservative_drift_tt

			je:je_the_two_spains ?= {
				add_progress = {
					value = {
						add = two_spains_church_restitution_conservative_drift
						multiply = -1
					}
					name = je_two_spains_progress_bar
				}
			}
		}
		add_modifier = {
			name = spc_church_restitution
			days = very_long_modifier_time
		}
		add_modifier = {
			name = spc_church_compensation
			days = long_modifier_time
			is_decaying = yes

			multiplier = money_amount_multiplier_large
		}
		c:PAP ?= {
			create_diplomatic_catalyst = {
				type = catalyst_event_positive
				target = root
			}
			change_relations = {
				country = root
				value = 20
			}
		}

		ai_chance = {
			base = 3
		}
	}
	option = { # A small donation will suffice
		name = carlist_war.4.b

		custom_tooltip = {
			text = two_spains_church_compensation_conservative_drift_tt

			je:je_the_two_spains ?= {
				add_progress = {
					value = {
						add = two_spains_church_compensation_conservative_drift
						multiply = -1
					}
					name = je_two_spains_progress_bar
				}
			}
		}
		add_modifier = {
			name = spc_church_compensation
			days = long_modifier_time
			is_decaying = yes

			multiplier = money_amount_multiplier_medium
		}
		c:PAP ?= {
			change_relations = {
				country = root
				value = 10
			}
		}

		ai_chance = {
			base = 6
		}
	}
	option = { # But what if we just kept the money?
		name = carlist_war.4.c

		je:je_the_two_spains ?= {
			add_progress = { value = 20 name = je_two_spains_tension_bar }
		}
		add_radicals = {
			religion = rel:catholic
			value = 0.15
		}
		c:PAP ?= {
			create_diplomatic_catalyst = {
				type = catalyst_event_negative
				target = root
			}
			change_relations = {
				country = root
				value = -20
			}
		}

		ai_chance = {
			base = 1
		}
	}
}

# Siege of Bilbao
carlist_war.5 = {
    type = country_event
    placement = ROOT

	cooldown = { days = never_fire_again_modifier_time }

    duration = 3

	title = carlist_war.5.t
	desc = carlist_war.5.d
	flavor = carlist_war.5.f

	dlc = dlc016

    event_image = {
		video = "europenorthamerica_before_the_battle"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_carlist_beret.dds"

    trigger = {
		has_dlc_feature = ip4_content
		c:SPC ?= this
	}

	immediate = {}

	option = { # Force it at all costs
		name = carlist_war.5.a
		default_option = yes

		random_scope_state = {
			limit = {
				state_region = s:STATE_BASQUE_COUNTRY
			}
			add_modifier = {
				name = spc_secure_port
				days = long_modifier_time
			}
			kill_population_percent_in_state = {
				percent = 0.01
			}
			add_radicals_in_state = {
				value = 0.05
			}
		}

		ai_chance = {
			base = 1
		}
	}
	option = { # Abandon the siege
		name = carlist_war.5.b

		ai_chance = {
			base = 0
		}
	}

	cancellation_trigger = {
		is_at_war = no
	}
}

# Taking the fight to Andalusia
carlist_war.6 = {
    type = country_event
    placement = scope:upper_andalusia_scope

	cooldown = { days = never_fire_again_modifier_time }

    duration = 3

	title = carlist_war.6.t
	desc = carlist_war.6.d
	flavor = carlist_war.6.f

	dlc = dlc016

    event_image = {
		video = "unspecific_vandalized_storefront"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_carlist_beret.dds"

    trigger = {
		has_dlc_feature = ip4_content
		c:SPC ?= this
		c:SPA ?= {
			any_scope_state = {
				OR = {
					state_region = s:STATE_UPPER_ANDALUSIA
					state_region = s:STATE_LOWER_ANDALUSIA
				}
			}
		}
	}

	immediate = {
		s:STATE_UPPER_ANDALUSIA = {
			random_scope_state = {
				limit = {
					owner = c:SPA
				}
				save_scope_as = upper_andalusia_scope
			}
		}
		s:STATE_LOWER_ANDALUSIA = {
			random_scope_state = {
				limit = {
					owner = c:SPA
				}
				save_scope_as = lower_andalusia_scope
			}
		}
	}

	option = { # More bandits
		name = carlist_war.6.a
		default_option = yes

		add_modifier = {
			name = spa_carlist_terror_expenses
			days = short_modifier_time
			multiplier = money_amount_multiplier_medium
		}
		s:STATE_UPPER_ANDALUSIA.region_state:SPA ?= {
			add_modifier = {
				name = spa_carlist_terror
				days = normal_modifier_time
			}
			add_devastation = carlist_war_carlist_terror_devastation
		}
		s:STATE_LOWER_ANDALUSIA.region_state:SPA ?= {
			add_modifier = {
				name = spa_carlist_terror
				days = normal_modifier_time
			}
			add_devastation = carlist_war_carlist_terror_devastation
		}
		c:SPA ?= {
			post_notification = carlist_war_carlist_terror
		}

		ai_chance = {
			base = 3
		}
	}
	option = { # This is not worth it
		name = carlist_war.6.b

		ai_chance = {
			base = 7
		}
	}

	cancellation_trigger = {
		is_at_war = no
	}
}

# Carlist War Start Up Event
carlist_war.7 = {
    type = country_event
    placement = s:STATE_BASQUE_COUNTRY.region_state:SPC

    duration = 3

	title = carlist_war.7.t
	desc = carlist_war.7.d
	flavor = carlist_war.7.f

    event_image = {
		video = "votp_monarch_holding_court"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_carlist_beret.dds"

    trigger = {
	}

	immediate = {
		c:SPA ?= {
			heir ?= {
				save_scope_as = isabella_scope
			}
		}
		c:SPC ?= {
			ruler ?= {
				save_scope_as = don_carlos_scope
			}
		}
	}

	option = { # OK
		name = carlist_war.7.a

		show_as_tooltip = {
			add_contextless_journal_entry =je_the_first_carlist_war
			custom_tooltip = carlist_war_startup_tt
		}
	}
}
