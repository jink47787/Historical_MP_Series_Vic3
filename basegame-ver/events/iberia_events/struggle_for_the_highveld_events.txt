namespace = struggle_for_the_highveld

# The Battle of Vegkop
struggle_for_the_highveld.1 = {
	type = country_event
	placement = ROOT

	title = struggle_for_the_highveld.1.t
	desc = struggle_for_the_highveld.1.d
	flavor = struggle_for_the_highveld.1.f

	duration = 3

	event_image = {
		video = "africa_animism"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		c:ZUL ?= this
		s:STATE_TRANSVAAL = {
			any_scope_state = {
				owner = {
					c:MTB ?= this
				}
			}
		}
		exists = c:TRN
	}

	immediate = {
		c:MTB ?= {
			save_scope_as = ndebele
			ruler = {
				save_scope_as = mzilikazi
			}
		}
		c:TRN ?= {
			save_scope_as = transvaal
		}
		ROOT = {
			save_scope_as = zulu
		}
		s:STATE_TRANSVAAL = {
			save_scope_as = transvaal_region
		}
	}

	option = {
		name = struggle_for_the_highveld.1.a
		default_option = yes

		c:TRN ?= {
			trigger_event = { id = struggle_for_the_highveld.2 }
		}

		ai_chance = {
			base = 1
		}
	}

	option = {
		name = struggle_for_the_highveld.1.b

		s:STATE_TRANSVAAL = {
			set_owner_of_provinces = {
				country = ROOT
				provinces = { x25A652 x91CA59 xD72273 xB98B42 x6E419C x9A137B xD02011 }
			}
		}
    	add_modifier = {
    		name = zul_trn_rapid_overexpansion
    		days = long_modifier_time
    	}
		c:TRN ?= {
			trigger_event = { id = struggle_for_the_highveld.2 }
		}

		ai_chance = {
			base = 0

			modifier = {
				trigger = {
					scope:zulu.ruler = {
						has_trait = bigoted
					}
				}
				add = -1
			}
			modifier = {
				trigger = {
					scope:zulu.ruler = {
						NOT = { has_template = ZUL_dingane }
					}
				}
				add = 1
			}
		}
	}

	option = {
		name = struggle_for_the_highveld.1.c

		set_variable = helped_mzilikazi

		scope:zulu = {
			add_modifier = {
				name = zul_a_friend_to_enemies
				days = normal_modifier_time
			}
			ruler = {
				add_modifier = {
					name = zul_passed_on_chance_for_victory
					days = long_modifier_time
				}
			}
		}

		ai_chance = {
			base = 0
		}
	}
}

# In Mzilikazi's Wake
struggle_for_the_highveld.2 = {
	type = country_event
	placement = ROOT

	title = struggle_for_the_highveld.2.t
	desc = struggle_for_the_highveld.2.d
	flavor = struggle_for_the_highveld.2.f

	duration = 3

	event_image = {
		video = "middleeast_jungle_expedition"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_map.dds"

	trigger = {
	}

	immediate = {
		c:MTB ?= {
			save_scope_as = ndebele
			ruler = {
				save_scope_as = mzilikazi
			}
		}
		ROOT = {
			save_scope_as = transvaal
		}
		c:ZUL ?= {
			save_scope_as = zulu
		}
		s:STATE_TRANSVAAL = {
			save_scope_as = transvaal_region
		}
	}

	option = {
		name = struggle_for_the_highveld.2.a
		default_option = yes

		hidden_effect = {
			if = {
				limit = {
					exists = c:MSH
				}
				c:MTB ?= {
					annex = c:MSH
				}
			}
		}
		c:MTB ?= {
			random_scope_state = {
				limit = { state_region = s:STATE_TRANSVAAL }
				set_state_owner = ROOT
			}
		}
    	add_modifier = {
    		name = zul_trn_rapid_overexpansion
    		days = long_modifier_time
    	}

		ai_chance = {
			base = 1
		}
	}

	option = {
		name = struggle_for_the_highveld.2.b

		hidden_effect = {
			if = {
				limit = {
					exists = c:MSH
				}
				c:MTB ?= {
					annex = c:MSH
				}
			}
		}
		c:MTB ?= {
			random_scope_state = {
				limit = { state_region = s:STATE_TRANSVAAL }
				set_state_owner = c:PDI
			}
		}

    	add_modifier = {
    		name = trn_transvaal_treks_denied
    		days = long_modifier_time
    	}

		ai_chance = {
			base = 0
		}
	}

	option = {
		name = struggle_for_the_highveld.2.c

		hidden_effect = {
			if = {
				limit = {
					exists = c:MSH
				}
				c:MTB ?= {
					annex = c:MSH
				}
			}
		}
		s:STATE_TRANSVAAL = {
			set_owner_of_provinces = {
				country = ROOT
				provinces = { x902190 x04FA29 xAFDF6D x04FA29 x7F6508 xF7F196 x3A4578 xFF01F0 xA8089A xF52530 x8B4610 x3B06D4 }
			}
		}
		c:MTB ?= {
			random_scope_state = {
				limit = { state_region = s:STATE_TRANSVAAL }
				set_state_owner = c:PDI
			}
		}

		random_scope_state = {
			limit = { state_region = s:STATE_TRANSVAAL }
			add_modifier = {
				name = trn_transvaal_treks_encouraged
				days = long_modifier_time
			}
		}

		ai_chance = {
			base = 0
		}
	}
}

# The Natal Cession
struggle_for_the_highveld.3 = {
	type = country_event
	placement = ROOT

	title = struggle_for_the_highveld.3.t
	desc = struggle_for_the_highveld.3.d
	flavor = struggle_for_the_highveld.3.f

	duration = 3

	event_image = {
		video = "africa_diplomats_negotiating"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_map.dds"

	trigger = {
		c:ORA ?= this

		any_scope_state = {
			any_neighbouring_state = {
				state_region = s:STATE_ZULULAND
				owner = {
					c:ZUL ?= this
					is_at_war = no
					aggressive_diplomatic_plays_permitted = yes
				}
			}
		}

		NOT = {
			has_global_variable = zulu_boer_confrontation
		}
	}

	immediate = {
		c:ZUL ?= {
			save_scope_as = zulu
			ruler = {
				save_scope_as = dingane
			}
		}
		s:STATE_ZULULAND = {
			save_scope_as = zululand_region
		}
		if = {
			limit = {
				any_scope_character = { has_template = ORA_piet_retief }
			}
			random_scope_character = {
				limit = {
					has_template = ORA_piet_retief
				}
				save_scope_as = piet_retief
			}
		}
		else = {
			ordered_scope_character = {
				limit = {
					has_role = politician
					is_ruler = no
				}
				order_by = this.interest_group.ig_clout
				save_scope_as = piet_retief
			}
		}
	}

	option = {
		name = struggle_for_the_highveld.3.a
		default_option = yes

		scope:zulu = {
			trigger_event = { id = struggle_for_the_highveld.4 days = 7 }
		}

		ai_chance = {
			base = 1
		}
	}

	option = {
		name = struggle_for_the_highveld.3.b

		scope:piet_retief.interest_group = {
			add_modifier = {
				name = ora_natalia_venture_rejected
				days = normal_modifier_time
			}
		}

		ai_chance = {
			base = 0

			modifier = {
				trigger = {
					scope:piet_retief = {
						NOT = { has_template = ORA_piet_retief }
					}
				}
				add = 1
			}
		}
	}
}

# Boers Demand the Thukela
struggle_for_the_highveld.4 = {
	type = country_event
	placement = ROOT

	title = struggle_for_the_highveld.4.t
	desc = struggle_for_the_highveld.4.d
	flavor = struggle_for_the_highveld.4.f

	duration = 3

	event_image = {
		video = "africa_diplomats_negotiating"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_default.dds"

	trigger = {
	}

	immediate = {
		scope:piet_retief = {
			owner = {
				save_scope_as = oranje
			}
		}
	}

	option = {
		name = struggle_for_the_highveld.4.a
		default_option = yes

		scope:piet_retief = {
			kill_character = yes
		}

		set_global_variable = zulu_boer_confrontation

		scope:oranje = {
			change_relations = {
				country = root
				value = -25
			}
			hidden_effect = {
				set_secret_goal = {
					country = root
					secret_goal = conquer
				}
			}
			post_notification = piet_retief_killed
		}

		ai_chance = {
			base = 1
		}
	}

	option = {
		name = struggle_for_the_highveld.4.b

		set_global_variable = zulu_boer_confrontation

		custom_tooltip = {
			text = struggle_for_the_highveld.4.b.tt
		}
		s:STATE_ZULULAND = {
			add_claim = scope:oranje
		}

		scope:oranje = {
			post_notification = piet_retief_forges
		}

		ai_chance = {
			base = 0

			modifier = {
				trigger = {
					ROOT.ruler = {
						NOT = { has_template = ZUL_dingane }
					}
				}
				add = 1
			}
		}
	}

	option = {
		name = struggle_for_the_highveld.4.c

		s:STATE_ZULULAND = {
			set_owner_of_provinces = {
				country = scope:oranje
				provinces = { x5B124F xFF0EF1 x552449 xE0EB02 x85695F xDE0EDE x279045 x7ACC38 xB1F868 x3CED3D x11A090 xCD31DB }
			}
		}

		every_country = {
			limit = {
				OR = {
					has_journal_entry = je_struggle_for_the_highveld
					any_subject_or_below = {
						has_journal_entry = je_struggle_for_the_highveld
					}
				}
			}
			post_notification = natal_ceded
		}

		ai_chance = {
			base = 0
		}
	}
}

# Blood River
struggle_for_the_highveld.5 = {
	type = country_event
	placement = ROOT

	title = struggle_for_the_highveld.5.t
	desc = struggle_for_the_highveld.5.d
	flavor = struggle_for_the_highveld.5.f

	duration = 3

	event_image = {
		video = "southamerica_war_civilians"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = {
		has_global_variable = zulu_boer_confrontation
		c:ZUL ?= root
		p:x279045.state = {
			owner = root
		}

		any_neighbouring_state = {
			owner = {
				country_has_primary_culture = cu:boer
			}
		}
	}

	immediate = {
		s:STATE_ZULULAND = {
			save_scope_as = zululand_region
		}
		save_scope_as = zulu
		ruler = {
			save_scope_as = dingane
		}

		if = {
			limit = {
				any_scope_character = {
					is_heir = yes
				}
			}
			heir = {
				save_scope_as = mpande
			}
		}
		else = {
			ordered_scope_character = {
				limit = {
					has_role = politician
					is_ruler = no
				}
				order_by = this.interest_group.ig_clout
				save_scope_as = mpande
			}
		}

		if = {
			limit = {
				exists = c:ORA
			}
			c:ORA ?= {
				save_scope_as = natalia_progenitor
			}
		}
		else_if = {
			limit = {
				exists = c:TRN
			}
			c:TRN ?= {
				save_scope_as = natalia_progenitor
			}
		}
		else_if = {
			limit = {
				exists = c:SAF
			}
			c:SAF ?= {
				save_scope_as = natalia_progenitor
			}
		}
		else = {
			random_country = {
				limit = {
					NOT = { is_country_type = decentralized }
				}
				save_scope_as = natalia_progenitor
			}
		}
	}

	option = {
		name = struggle_for_the_highveld.5.a
		default_option = yes

		scope:dingane = {
			kill_character = yes
		}
		if = {
			limit = { scope:mpande = { is_ruler = no } }
			scope:mpande = {
				set_character_as_ruler = yes
			}
		}

		create_country = {
			tag = NAL
			origin = scope:natalia_progenitor
			province = p:x279045
			on_created = {
				set_country_type = unrecognized
				save_temporary_scope_as = natalia_republic
				s:STATE_ZULULAND = {
					set_owner_of_provinces = {
						country = c:NAL
						provinces = { x5B124F xFF0EF1 x552449 xE0EB02 x85695F xDE0EDE x7ACC38 xB1F868 x3CED3D x11A090 xCD31DB }
					}
				}

				every_country = {
					limit = {
						OR = {
							has_journal_entry = je_struggle_for_the_highveld
							any_subject_or_below = {
								has_journal_entry = je_struggle_for_the_highveld
							}
						}
					}
					post_notification = blood_river_mpande_rules_natalia_founded
				}

				add_journal_entry = { type = je_struggle_for_the_highveld }
			}
		}

		hidden_effect = {
			s:STATE_ZULULAND = {
				random_scope_state = {
					limit = {
						NOT = { owner = c:ZUL }
					}
					every_scope_pop = {
						limit = {
							culture = cu:zulu
							NOT = { is_pop_type = peasants }
						}
						move_pop = s:STATE_ZULULAND.region_state:ZUL
					}
					create_pop = {
						culture = boer
						religion = protestant
						size = 3000
					}
				}
			}
		}

		ai_chance = {
			base = 1
		}
	}

	option = {
		name = struggle_for_the_highveld.5.b

		ruler = {
			add_modifier = zul_desperately_clinging_to_power

			interest_group = {
				add_modifier = {
					name = zul_desperately_clinging_to_power_ig
					days = normal_modifier_time
				}
			}
		}

		ai_chance = {
			base = 0

			modifier = {
				trigger = {
					ROOT.ruler = {
						NOT = { has_template = ZUL_dingane }
					}
				}
				add = 1
			}
		}
	}

	option = {
		name = struggle_for_the_highveld.5.c
		trigger = {
			custom_tooltip = {
				text = struggle_for_the_highveld.5.c.tt
				has_variable = helped_mzilikazi
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

# Highest on the Highveld
struggle_for_the_highveld.6 = {
	type = country_event
	placement = ROOT

	title = struggle_for_the_highveld.6.t
	desc = struggle_for_the_highveld.6.d
	flavor = struggle_for_the_highveld.6.f

	duration = 3

	event_image = {
		video = "africa_public_protest"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_default.dds"

	immediate = {
		save_scope_as = highveld_winner
	}

	option = {
		name = struggle_for_the_highveld.6.a
		default_option = yes

		while = {
			limit = {
				any_country = {
					is_ai = yes
					NOT = { ROOT = this }
					any_primary_culture = {
						is_primary_culture_of = scope:highveld_winner
					}
					OR = {
						is_subject = no
						is_subject_of = scope:highveld_winner
						AND = {
							scope:highveld_winner = { is_subject = yes }
							is_subject_of = scope:highveld_winner.top_overlord
						}
					}
					capital = {
						is_in_geographic_region = geographic_region_south_africa
					}
				}
			}
			random_country = {
				limit = {
					is_ai = yes
					NOT = { ROOT = this }
					any_primary_culture = {
						is_primary_culture_of = scope:highveld_winner
					}
					OR = {
						is_subject = no
						is_subject_of = scope:highveld_winner
						AND = {
							scope:highveld_winner = { is_subject = yes }
							is_subject_of = scope:highveld_winner.top_overlord
						}
					}
					capital = {
						is_in_geographic_region = geographic_region_south_africa
					}
				}
				save_temporary_scope_as = south_african_tag_to_annex
				every_state = {
					limit = {
						has_claim_by = scope:south_african_tag_to_annex
						NOT = { has_claim_by = scope:highveld_winner }
					}
					state_region = {
						remove_claim = scope:south_african_tag_to_annex
						add_claim = scope:highveld_winner
					}
				}
			}
			annex_with_incorporation = scope:south_african_tag_to_annex
		}
	}

	after = {
		if = {
			limit = {
				NOR = {
					owns_entire_state_region = STATE_NORTHERN_CAPE
					has_claim = s:STATE_NORTHERN_CAPE
				}
			}
			s:STATE_NORTHERN_CAPE = { add_claim = scope:highveld_winner }
		}
		if = {
			limit = {
				NOR = {
					owns_entire_state_region = STATE_CAPE_COLONY
					has_claim = s:STATE_CAPE_COLONY
				}
			}
			s:STATE_CAPE_COLONY = { add_claim = scope:highveld_winner }
		}
		if = {
			limit = {
				NOR = {
					owns_entire_state_region = STATE_EASTERN_CAPE
					has_claim = s:STATE_EASTERN_CAPE
				}
			}
			s:STATE_EASTERN_CAPE = { add_claim = scope:highveld_winner }
		}
		if = {
			limit = {
				NOR = {
					owns_entire_state_region = STATE_VRYSTAAT
					has_claim = s:STATE_VRYSTAAT
				}
			}
			s:STATE_VRYSTAAT = { add_claim = scope:highveld_winner }
		}
		if = {
			limit = {
				NOR = {
					owns_entire_state_region = STATE_TRANSVAAL
					has_claim = s:STATE_TRANSVAAL
				}
			}
			s:STATE_TRANSVAAL = { add_claim = scope:highveld_winner }
		}
		if = {
			limit = {
				NOR = {
					owns_entire_state_region = STATE_ZULULAND
					has_claim = s:STATE_ZULULAND
				}
			}
			s:STATE_ZULULAND = { add_claim = scope:highveld_winner }
		}
	}
}

# Lowest on the Highveld
struggle_for_the_highveld.7 = {
	type = country_event
	placement = ROOT

	title = struggle_for_the_highveld.7.t
	desc = struggle_for_the_highveld.7.d
	flavor = struggle_for_the_highveld.7.f

	duration = 3

	event_image = {
		video = "southamerica_war_civilians"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_default.dds"

	immediate = {
		save_scope_as = highveld_loser
		random_country = {
			limit = {
				has_variable = highest_on_highveld
			}
			save_scope_as = highveld_winner
		}
	}

	option = {
		name = struggle_for_the_highveld.7.a
		default_option = yes

		if = {
			limit = {
				c:SAF ?= scope:highveld_loser
			}
			if = {
				limit = { country_has_primary_culture = cu:griqua }
				remove_primary_culture = cu:griqua
			}
			if = {
				limit = { country_has_primary_culture = cu:boer }
				remove_primary_culture = cu:boer
			}
		}

		if = {
			limit = { has_claim = s:STATE_NORTHERN_CAPE }
			s:STATE_NORTHERN_CAPE = { remove_claim = scope:highveld_loser }
		}
		if = {
			limit = { has_claim = s:STATE_CAPE_COLONY }
			s:STATE_CAPE_COLONY = { remove_claim = scope:highveld_loser }
		}
		if = {
			limit = { has_claim = s:STATE_EASTERN_CAPE }
			s:STATE_EASTERN_CAPE = { remove_claim = scope:highveld_loser }
		}
		if = {
			limit = { has_claim = s:STATE_VRYSTAAT }
			s:STATE_VRYSTAAT = { remove_claim = scope:highveld_loser }
		}
		if = {
			limit = { has_claim = s:STATE_TRANSVAAL }
			s:STATE_TRANSVAAL = { remove_claim = scope:highveld_loser }
		}
		if = {
			limit = { has_claim = s:STATE_ZULULAND }
			s:STATE_ZULULAND = { remove_claim = scope:highveld_loser }
		}
	}
}
