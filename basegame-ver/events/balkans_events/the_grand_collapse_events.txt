namespace = the_grand_collapse

# "Fetret", initiation event
the_grand_collapse.1 = {
	type = country_event
	placement = root
	title = the_grand_collapse.1.t
	desc = the_grand_collapse.1.d
	flavor = the_grand_collapse.1.f
	duration = 3
	event_image = {
		video = "middleeast_middleclass_cafe"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"

	trigger = {
	}

	cancellation_trigger = {
	}

	immediate = {
	}

	option = {
		name = the_grand_collapse.1.a
		add_modifier = {
			name = the_grand_collapse_main_mod
		}
	}
}

# "Any Port in a Storm", initiation event
the_grand_collapse.2 = {
	type = country_event
	placement = root
	title = the_grand_collapse.2.t
	desc = the_grand_collapse.2.d
	flavor = the_grand_collapse.2.f
	duration = 3
	event_image = {
		video = "asia_politician_parliament_motion"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_default.dds"

	trigger = {
		any_subject_or_below = {
			OR = {
				OR = {
					any_neighbouring_state = {
						owner = ROOT
					}
					this.market = root.market
					is_subject_type = subject_type_puppet
				}
				relations:root < relations_threshold:cordial
				liberty_desire > 75
			}
			NOT = {
				has_variable = opportunist_subject
			}
			is_player = no
		}
	}

	cooldown = {
		days = 180
	}

	cancellation_trigger = {

	}

	immediate = {
		random_subject_or_below = {
			limit = {
				OR = {
					OR = {
						any_neighbouring_state = {
							owner = ROOT
						}
						this.market = root.market
						is_subject_type = subject_type_puppet
					}
					relations:root < relations_threshold:cordial
					liberty_desire > 75
				}
				NOT = {
					has_variable = opportunist_subject
				}
				is_player = no
			}
			save_scope_as = marketless_country_scope
		}
		random_scope_state = {
			limit = {
				any_neighbouring_state = {
					owner = scope:marketless_country_scope
				}
			}
			save_scope_as = asked_state_scope
		}
		scope:marketless_country_scope = {
			set_variable = {
				name = opportunist_subject
				days = 365
			}
		}
	}

	option = {
		trigger = {
			this.market = root.market
		}
		name = the_grand_collapse.2.a
		default_option = yes
		scope:marketless_country_scope = {
			add_modifier = {
				name = the_grand_collapse_port_liberty_desire_mod
				days = 120
			}
			change_relations = {
				country = ROOT
				value = 30
			}
		}
		custom_tooltip = {
			create_diplomatic_pact = {
				country = scope:marketless_country_scope
				type = grant_own_market
			}
			text = the_grand_collapse_2.a_tt
		}
	}

	option = {
		trigger = {
			scope:marketless_country_scope = {
				any_neighbouring_state = {
					owner = ROOT
				}
			}
		}
		name = the_grand_collapse.2.b
		scope:marketless_country_scope = {
			add_modifier = {
				name = the_grand_collapse_port_liberty_desire_mod
				days = 210
			}
			scope:asked_state_scope = {
				set_state_owner = prev
			}
			change_relations = {
				country = ROOT
				value = 15
			}
		}
	}

	option = {
		trigger = {
			scope:marketless_country_scope = {
				is_subject_type = subject_type_puppet
			}
		}
		name = the_grand_collapse.2.c
		scope:marketless_country_scope = {
			create_diplomatic_pact = {
				country = scope:marketless_country_scope
				type = protectorate
			}
			add_modifier = {
				name = the_grand_collapse_port_liberty_desire_mod
				days = 170
			}
			change_relations = {
				country = ROOT
				value = 20
			}
		}
	}

	option = {
		name = the_grand_collapse.2.e
		scope:marketless_country_scope = {
			add_modifier = {
				name = the_grand_collapse_port_opportunist_subject_mod
				days = 210
			}
			change_relations = {
				country = ROOT
				value = -25
			}
		}
		add_modifier = {
			name = the_grand_collapse_port_opportunist_ottoman_mod
			days = 365
		}
	}
}

# "Desperate Measures", Lobby Notables event
the_grand_collapse.3 = {
	type = country_event
	placement = root
	title = the_grand_collapse.3.t
	desc = the_grand_collapse.3.d
	flavor = the_grand_collapse.3.f
	duration = 3
	event_image = {
		video = "middleeast_upperclass_party"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_default.dds"

	trigger = {
	}

	cancellation_trigger = {
	}

	immediate = {
		random_interest_group = {
			limit = {
			}
			save_scope_as = lobbied_ig_1
			leader = {
				save_scope_as = lobbied_ig_leader_1
			}
		}
		random_interest_group <= {
			limit = {
				NOT = {
					this = scope:lobbied_ig_1
				}
			}
			save_scope_as = lobbied_ig_2
			leader = {
				save_scope_as = lobbied_ig_leader_2
			}
		}
		random_interest_group = {
			limit = {
				nor = {
					this = scope:lobbied_ig_1
					this = scope:lobbied_ig_2
				}
			}
			save_scope_as = lobbied_ig_3
			leader = {
				save_scope_as = lobbied_ig_leader_3
			}
		}
	}

	option = {
		name = the_grand_collapse.3.a
		default_option = yes
		scope:lobbied_ig_1 = {
		desperate_measures_ig_approval_mod_effect = yes
		}
		scope:lobbied_ig_leader_1 = {
			add_modifier = {
				name = the_grand_collapse_desperate_measures_ig_leader_popularity
				days = normal_modifier_time
			}
		}
		add_loyalists = {
			value = small_radicals
			interest_group = scope:lobbied_ig_1
		}
	}

	option = {
		name = the_grand_collapse.3.b
		scope:lobbied_ig_2 = {
		desperate_measures_ig_approval_mod_effect = yes
		}
		scope:lobbied_ig_leader_2 = {
			add_modifier = {
				name = the_grand_collapse_desperate_measures_ig_leader_popularity
				days = normal_modifier_time
			}
		}
		add_loyalists = {
			value = small_radicals
			interest_group = scope:lobbied_ig_2
		}
	}

	option = {
		name = the_grand_collapse.3.c
		scope:lobbied_ig_3 = {
		desperate_measures_ig_approval_mod_effect = yes
		}
		scope:lobbied_ig_leader_3 = {
			add_modifier = {
				name = the_grand_collapse_desperate_measures_ig_leader_popularity
				days = normal_modifier_time
			}
		}
		add_loyalists = {
			value = small_radicals
			interest_group = scope:lobbied_ig_3
		}
	}
}

# "The Sublime Porte", complete event
the_grand_collapse.4 = {
	type = country_event
	placement = root
	title = the_grand_collapse.4.t
	desc = the_grand_collapse.4.d
	flavor = the_grand_collapse.4.f
	duration = 3
	event_image = {
		video = "ep1_persian_court"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	trigger = {
	}

	cancellation_trigger = {
	}

	immediate = {

	}

	option = {
		name = the_grand_collapse.4.a
		default_option = yes
		if = {
			limit = {
				NOT = {
					has_law = law_type:law_monarchy
				}
			}
			activate_law = law_type:law_monarchy
		}
		add_loyalists = {
			value = large_radicals
		}
		add_modifier = {
			name = the_grand_collapse_complete_mod
			days = long_modifier_time
		}
	}

	option = {
		trigger = {
			country_has_state_religion = rel:sunni
			is_player = yes
		}
		name = the_grand_collapse.4.b
		activate_law = law_type:law_theocracy
		if = {
			limit = {
				NOT = {
					has_law = law_type:law_millet_system
				}
			}
			activate_law = law_type:law_millet_system
		}
		add_loyalists = {
			value = medium_radicals
		}
		add_modifier = {
			name = the_grand_collapse_complete_mod
			days = long_modifier_time
		}
	}
}

# "İnhidam-ı Azîm", timeout event
the_grand_collapse.5 = {
	type = country_event
	placement = root
	title = the_grand_collapse.5.t
	desc = the_grand_collapse.5.d
	flavor = the_grand_collapse.5.f
	duration = 3
	event_image = {
		video = "ip3_angry_mob_raiding_minorities"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
	}

	cancellation_trigger = {
	}

	immediate = {
		set_global_variable = ottoman_grand_collapse
		the_grand_collapse_happens_balkans = yes
		the_grand_collapse_happens_asia_africa = yes
	}

	option = {
		name = the_grand_collapse.5.a
		default_option = yes
		if = {
			limit = {
				NOT = {
					has_law_or_variant = law_type:law_autocracy
					has_law = law_type:law_parliamentary_republic
				}
				has_law = law_type:law_monarchy
			}
			activate_law = law_type:law_parliamentary_republic
		}
		else = {
			limit = {
				NOT = {
					has_law = law_type:law_presidential_republic
				}
				has_law = law_type:law_monarchy
			}
			activate_law = law_type:law_presidential_republic
		}
		custom_tooltip = {
			text = the_grand_collapse_timeout_tt
		}
	}
}
