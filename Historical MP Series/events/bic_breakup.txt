namespace = bic_breakup

# Independent British East India Company decides how to proceed
bic_breakup.1 = {
	type = country_event
	placement = root

	title = bic_breakup.1.t
	desc = bic_breakup.1.d
	flavor = bic_breakup.1.f

	event_image = {
		video = "asia_sepoy_mutiny"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_protest.dds"

	duration = 3

	trigger = {
		c:BIC ?= this
		is_subject = no
		is_at_war = no
		NOT = {
			has_variable = bic_collapse_var
		}
	}

	immediate = {
		cu:british = {
			save_scope_as = british_culture
		}
		cu:scottish = { # Making sure to cover for that one Scottish guy
			save_scope_as = scottish_culture
		}
		set_variable = bic_collapse_var
		if = {
			limit = {
				OR = {
					has_law = law_type:law_extraction_economy
					has_law = law_type:law_the_company
				}
			}
			activate_law = law_type:law_agrarianism
		}
	}

	option = {
		name = bic_breakup.1.a
		trigger = {
			NOT = { has_technology_researched = pan-nationalism }
		}
		ai_chance = {
			base = 8 # this is the default pick for the AI
		}
		collapse_india_effect = yes
		change_tag = BGL
		add_modifier = country_modifier_india_post_homerule_religious_nerf
		if = {
			limit = {
				NOT = {
					has_law = law_type:law_monarchy
				}
			}
			activate_law = law_type:law_monarchy
		}
		if = {
			limit = {
				NOT = {
					has_law = law_type:law_oligarchy
				}
			}
			activate_law = law_type:law_oligarchy
		}
		hidden_effect = {
			set_social_hierarchy = british_indian_caste_system
			remove_primary_culture = cu:british
			add_primary_culture = cu:bengali
			set_state_religion = rel:sunni
			india_independence_ig_effects = yes
			if = {
				limit = {
					has_modifier = modifier_india_crown_rule
				}
				remove_modifier = modifier_india_crown_rule
			}
			if = {
				limit = {
					has_modifier = modifier_india_company_rule
				}
				remove_modifier = modifier_india_company_rule
			}
			if = {
				limit = {
					has_modifier = modifier_india_company_rule_upgraded
				}
				remove_modifier = modifier_india_company_rule_upgraded
			}
			if = {
				limit = {
					has_modifier = modifier_indian_imperial_police
				}
				remove_modifier = modifier_indian_imperial_police
			}
			recalculate_pop_ig_support = yes
			every_scope_character = {
				limit = {
					OR = {
						culture = cu:british
						culture = cu:scottish
						culture = cu:irish
					}
				}
				kill_character = yes
			}
		}
	}

	option = {
		name = bic_breakup.1.b
		highlighted_option = yes
		trigger = {
			has_technology_researched = pan-nationalism
		}
		ai_chance = {
			factor = 1 # this will be quite rare for the AI
		}
		change_tag = BHT
		add_modifier = country_modifier_india_post_homerule_religious_nerf
		hidden_effect = {
			set_social_hierarchy = british_indian_caste_system
			remove_primary_culture = cu:british
			add_primary_culture = cu:bengali
			add_primary_culture = cu:assamese
			add_primary_culture = cu:avadhi
			add_primary_culture = cu:bihari
			add_primary_culture = cu:gujarati
			add_primary_culture = cu:kannada
			add_primary_culture = cu:malayalam
			add_primary_culture = cu:marathi
			add_primary_culture = cu:oriya
			add_primary_culture = cu:panjabi
			add_primary_culture = cu:rajput
			add_primary_culture = cu:sindi
			add_primary_culture = cu:tamil
			add_primary_culture = cu:telegu
			if = {
				limit = {
					NOT = {
						has_law = law_type:law_state_atheism
					}
				}
				if = {
					limit = {
						religion_percent_country = {
							target = rel:hindu
							value >= 0.5
						}
					}
					set_state_religion = rel:hindu
				}
				else_if = {
					limit = {
						religion_percent_country = {
							target = rel:sunni
							value >= 0.5
						}
					}
					set_state_religion = rel:sunni
				}
				else = {
					set_state_religion = rel:hindu
				}
			}
			india_independence_ig_effects = yes
			if = {
				limit = {
					has_modifier = modifier_india_crown_rule
				}
				remove_modifier = modifier_india_crown_rule
			}
			if = {
				limit = {
					has_modifier = modifier_india_company_rule
				}
				remove_modifier = modifier_india_company_rule
			}
			if = {
				limit = {
					has_modifier = modifier_india_company_rule_upgraded
				}
				remove_modifier = modifier_india_company_rule_upgraded
			}
			if = {
				limit = {
					has_modifier = modifier_indian_imperial_police
				}
				remove_modifier = modifier_indian_imperial_police
			}
			recalculate_pop_ig_support = yes
			every_scope_character = {
				limit = {
					OR = {
						culture = cu:british
						culture = cu:scottish
						culture = cu:irish
					}
					is_immortal = no
				}
				kill_character = yes
			}
		}
		#### Pakistan
		if = {
			limit = {
				NOT = { 
					exists = c:PAK
				}
			}
			if = {
				limit = {
					exists = c:PAN
					c:PAN ?= {
						is_player = yes
					}
				}
				c:PAN = {
					change_tag = PAK
				}
			}
			else_if = {
				limit = {
					exists = c:AGF
					c:AFG ?= {
						is_player = yes
					}
				}
				c:AGF = {
					change_tag = PAK
				}
			}
			else_if = {
				limit = {
					exists = c:KAB
					c:KAB ?= {
						is_player = yes
					}
				}
				c:KAB = {
					change_tag = PAK
				}
			}
		}
		every_scope_state = {
			if = {
				limit = {
					NOT = {
						OR = {
							state_is_in_india = yes
							state_is_in_central_asia = yes #to make sure that if india takes Tibet some how, it wont get transfered away to UK
							region = sr:region_persia
						}
					}
				}
				set_state_owner  = c:GBR
			}
			else_if = {
				limit = {
					OR = {
						religion_percent_state = {
							target = rel:sunni
							value >= 0.50
						}
						religion_percent_state = { # To stop a few boarder gore creating edge cases
							target = rel:shiite
							value >= 0.50
						}
					}
				}
				if = {
					limit = {
						exists = c:PAK
					}
					set_state_owner = c:PAK
				}
				else = {
					create_country = {
						tag = PAK
						origin = root
						state = this
						on_created = {
							activate_law = law_type:law_republic
							activate_law = law_type:law_oligarchy
						}
					}
				}
			}
		}
		if = {
			limit = {
				exists = c:PAK
			}
			c:PAK = {
				set_capital = s:STATE_PUNJAB
			}
		}
		every_direct_subject = {
			if = {
				limit = {
					NOT = {
						OR = {
							country_is_in_india = yes
							country_is_in_central_asia = yes #to make sure that if india takes Tibet some how, it wont get transfered away to UK
							capital ?= {
								region = sr:region_persia
							}
						}
					}
				}
				make_independent = yes
				c:GBR ?= {
					create_diplomatic_pact = {
						country = prev
						type = puppet
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						religion_percent_country = {
							target = rel:sunni
							value >= 0.50
						}
						religion_percent_country = { # To stop a few boarder gore creating edge cases
							target = rel:shiite
							value >= 0.30
						}
					}
				}
				make_independent = yes
				if = {
					limit = {
						exists = c:PAK
						NOT = {
							this ?= c:PAK
						}
					}
					
					every_scope_state = {
						set_state_owner  = c:PAK
					}
#					c:PAK ?= {
#						create_diplomatic_pact = {
#							country = prev
#							type = puppet
#						}
#					}
				}
				else = {
					change_tag = PAK
				}
			}
		}
		if = {
			limit = {
				exists = c:PAK
			}
			c:PAK = {
				if = {
					limit = {
						NOT = { country_has_primary_culture = cu:kashmiri }
					}
					add_primary_culture = cu:kashmiri
				}
				if = {
					limit = {
						NOT = { country_has_primary_culture = cu:panjabi }
					}
					add_primary_culture = cu:panjabi
				}
				if = {
					limit = {
						NOT = { country_has_primary_culture = cu:sindi }
					}
					add_primary_culture = cu:sindi
				}
				if = {
					limit = {
						NOT = { country_has_primary_culture = cu:baluchi }
					}
					add_primary_culture = cu:baluchi
				}
				if = {
					limit = {
						NOT = { country_has_primary_culture = cu:pashtun }
					}
					add_primary_culture = cu:pashtun
				}
				if = {
					limit = {
						NOT = { country_has_primary_culture = cu:bengali }
					}
					add_primary_culture = cu:bengali
				}
				#country_type = recognized #dont think this is needed now
				set_state_religion = rel:sunni
				every_scope_state = {
					if = {
						limit = {
							state_is_in_india = yes
						}
						set_state_type = incorporated
					}
				}
			}
		}
	}
#	option = {
#		name = bic_breakup.1.c
#		ai_chance = {
#			base = 0 # AI will never do this
#		}
#		default_option = yes
#		add_radicals = {
#			value = very_large_radicals
#		}
#	}
}
