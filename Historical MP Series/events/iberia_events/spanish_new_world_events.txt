namespace = spanish_new_world_events

# The Wayward Colonies
spanish_new_world_events.1 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spanish_new_world_events.1.t
	desc = spanish_new_world_events.1.d
	flavor = spanish_new_world_events.1.f

    event_image = {
		video = "ip4_abdication"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"

	cooldown = { days = normal_modifier_time }

	cancellation_trigger = {
	}

	trigger = {
        has_dlc_feature = ip4_content
		NOT = {
			has_global_variable = je_spanish_new_world_dummy_happened_var
		}
		c:SPA ?= this
		is_at_war = no
	}

	immediate = {
		set_global_variable = je_spanish_new_world_dummy_happened_var
		c:GBR ?= {
			save_scope_as = britain_scope
		}
		c:USA ?= {
			save_scope_as = usa_scope
		}
	}

	option = {
		name = spanish_new_world_events.1.a
		default_option = yes
		add_journal_entry = {
			type = je_hispanoamerica
		}
		custom_tooltip = spanish_new_world_events.1.tt_1
		add_modifier = {
			name = modifier_spanish_infamy_reduction
			days = normal_modifier_time
		}
		hidden_effect = {
			every_country_in_americas = {
				limit = {
					is_historical_spanish_american_colony = yes
					NOT = {
						is_subject_of = root
					}
				}
				create_diplomatic_catalyst = {
					type = catalyst_event_positive
					target = root
				}
			}
		}

		ai_chance = {
			base = 9
		}
	}

	option = {
		name = spanish_new_world_events.1.b
		add_journal_entry = {
			type = je_reconquista
		}
		custom_tooltip = spanish_new_world_events.1.tt_2
		change_infamy = 5
		custom_tooltip = {
			text = spanish_new_world_events.1.tt_4
			every_country = {
				limit = {
					OR = {
						c:GBR ?= this
						c:USA ?= this
						AND = {
							is_historical_spanish_american_colony = yes
							NOT = {
								is_subject_of = root
							}
						}
					}
				}
				change_relations = {
					country = root
					value = -30
				}
				create_diplomatic_catalyst = {
					type = catalyst_event_negative
					target = root
				}
			}
		}
		custom_tooltip = spanish_new_world_events.1.tt_3
		custom_tooltip = {
			text = spanish_new_world_events.1.tt_5
			every_country = {
				limit = {
					has_modifier = modifier_not_recognized_by_spain
				}
				remove_modifier = modifier_not_recognized_by_spain
			}
		}

		ai_chance = {
			base = 1
		}
	}
}

spanish_new_world_events.2 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spanish_new_world_events.2.t
	desc = spanish_new_world_events.2.d
	flavor = spanish_new_world_events.2.f

    event_image = {
		video = "rp1_amazon_exploitation"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	cooldown = { days = normal_modifier_time }

	cancellation_trigger = {
	}

	trigger = {
		# Triggered by Journal Entry
	}

	immediate = {
	}

	option = {
		name = spanish_new_world_events.2.a
		default_option = yes
		if = {
			limit = {
				year >= 1880
			}
			add_modifier = {
				name = modifier_our_american_empire_reward_regular
				days = long_modifier_time
			}
		}
		else_if = {
			limit = {
				year < 1880
			}
			add_modifier = {
				name = modifier_our_american_empire_reward_regular
			}
		}
	}

	option = {
		name = spanish_new_world_events.2.b
		if = {
			limit = {
				year >= 1880
			}
			add_modifier = {
				name = modifier_our_american_empire_reward_military
				days = long_modifier_time
			}
		}
		else_if = {
			limit = {
				year < 1880
			}
			add_modifier = {
				name = modifier_our_american_empire_reward_military
			}
		}
	}

	after = {
		set_variable = reconquista_achievement
	}
}

spanish_new_world_events.3 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spanish_new_world_events.3.t
	desc = spanish_new_world_events.3.d
	flavor = spanish_new_world_events.3.f

    event_image = {
		video = "unspecific_signed_contract"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	cooldown = { days = normal_modifier_time }

	cancellation_trigger = {
	}

	trigger = {
		# Triggered by Journal Entry
	}

	immediate = {
	}

	option = {
		name = spanish_new_world_events.3.a
		default_option = yes
		add_modifier = {
			name = modifier_hispanoamerica_reward
			days = long_modifier_time
		}
		custom_tooltip = {
			text = je_hispanoamerica_improve_relations
			every_country = {
				limit = {
					is_historical_spanish_american_colony = yes
				}
				change_relations = {
					country = prev
					value = 30
				}
			}
		}
		custom_tooltip = {
			text = je_hispanoamerica_improve_leverage
			if = {
				limit = {
					is_power_bloc_leader = yes
				}
				every_country = {
					limit = {
						is_historical_spanish_american_colony = yes
					}
					root.power_bloc = {
						add_leverage = {
							target = prev
							value = 100
						}
					}
				}
			}
		}
		# TODO PRCAL-41338 Cultural Union Power Bloc follow-up
	}
}

spanish_new_world_events.4 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spanish_new_world_events.4.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = spanish_new_world_events.4.d
				trigger = {
					NOT = {
						has_variable = setting_up_caribbean_var
					}
				}
			}
			triggered_desc = {
				desc = spanish_new_world_events.4.d_caribbean
				trigger = {
					has_variable = setting_up_caribbean_var
				}
			}
		}
	}
	flavor = {
		first_valid = {
			triggered_desc = {
				desc = spanish_new_world_events.4.f
				trigger = {
					NOT = {
						has_variable = setting_up_caribbean_var
					}
				}
			}
			triggered_desc = {
				desc = spanish_new_world_events.4.f_caribbean
				trigger = {
					has_variable = setting_up_caribbean_var
				}
			}
		}
	}

    event_image = {
		video = "ip4_colonial_exploitation_going_well"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_map.dds"

	cancellation_trigger = {
	}

	trigger = {
		# Triggered by buttons
	}

	immediate = {
		if = {
			limit = { has_variable = setting_up_new_spain_var }
			create_diplomatic_pact = {
				country = c:SC1
				type = colony
			}
			c:SC1 = {
				activate_law = law_type:law_republic
				save_scope_as = relevant_country_scope
			}
		}
		else_if = {
			limit = { has_variable = setting_up_new_grenada_var }
			create_diplomatic_pact = {
				country = c:SC2
				type = colony
			}
			c:SC2 = {
				activate_law = law_type:law_republic
				save_scope_as = relevant_country_scope
			}
		}
		else_if = {
			limit = { has_variable = setting_up_peru_var }
			create_diplomatic_pact = {
				country = c:SC3
				type = colony
			}
			c:SC3 = {
				activate_law = law_type:law_republic
				save_scope_as = relevant_country_scope
			}
		}
		else_if = {
			limit = { has_variable = setting_up_la_plata_var }
			create_diplomatic_pact = {
				country = c:SC4
				type = colony
			}
			c:SC4 = {
				activate_law = law_type:law_republic
				save_scope_as = relevant_country_scope
			}
		}
		else_if = {
			limit = { has_variable = setting_up_caribbean_var }
			c:CUB ?= {
				save_scope_as = relevant_country_scope
			}
			c:SC1 = {
				save_scope_as = new_spain_scope
			}
		}
	}

	option = {
		name = {
			trigger = { has_variable = setting_up_new_spain_var }
			text = spanish_new_world_events.4.a_1
		}
		name = {
			trigger = { has_variable = setting_up_new_grenada_var }
			text = spanish_new_world_events.4.a_2
		}
		name = {
			trigger = { has_variable = setting_up_peru_var }
			text = spanish_new_world_events.4.a_3
		}
		name = {
			trigger = { has_variable = setting_up_la_plata_var }
			text = spanish_new_world_events.4.a_4
		}
		name = {
			trigger = { has_variable = setting_up_caribbean_var }
			text = spanish_new_world_events.4.a_5
		}
		default_option = yes
		if = {
			limit = { has_variable = setting_up_new_spain_var }
			set_up_new_spain_default = yes
		}
		if = {
			limit = { has_variable = setting_up_new_grenada_var }
			set_up_new_grenada_default = yes
		}
		if = {
			limit = { has_variable = setting_up_peru_var }
			set_up_peru_default = yes
		}
		if = {
			limit = { has_variable = setting_up_la_plata_var }
			set_up_la_plata_default = yes
		}
		if = {
			limit = { has_variable = setting_up_caribbean_var }
			set_up_caribbean_default = yes
		}
		scope:relevant_country_scope = {
			set_strategy = ai_strategy_colonial_extraction
			add_modifier = modifier_reformed_captaincy_general
		}
	}

	option = {
		name = {
			trigger = {
				NOT = {
					has_variable = setting_up_caribbean_var
				}
			}
			text = spanish_new_world_events.4.b_1
		}
		name = {
			trigger = { has_variable = setting_up_caribbean_var }
			text = spanish_new_world_events.4.b_2
		}
		if = {
			limit = { has_variable = setting_up_new_spain_var }
			set_up_new_spain_pre_napoleonic = yes
		}
		if = {
			limit = { has_variable = setting_up_new_grenada_var }
			set_up_new_grenada_pre_napoleonic = yes
		}
		if = {
			limit = { has_variable = setting_up_peru_var }
			set_up_peru_pre_napoleonic = yes
		}
		if = {
			limit = { has_variable = setting_up_la_plata_var }
			set_up_la_plata_pre_napoleonic = yes
		}
		if = {
			limit = { has_variable = setting_up_caribbean_var }
			set_up_caribbean_pre_napoleonic = yes
		}
		scope:relevant_country_scope = {
			set_strategy = ai_strategy_colonial_extraction
			add_modifier = modifier_reformed_captaincy_general
		}
	}
	option = {
		name = spanish_new_world_events.4.c
		trigger = {
			has_variable = setting_up_caribbean_var
		}
		every_subject_or_below = {
			limit = {
				capital = {
					region = sr:region_caribbean
				}
			}
			add_modifier = {
				name = modifier_maintained_local_rule
				days = normal_modifier_time
			}
		}
	}
}

spanish_new_world_events.5 = {
	type = country_event
	placement = root

	duration = 3

	dlc = dlc016

	title = spanish_new_world_events.5.t
	desc = spanish_new_world_events.5.d
	flavor = spanish_new_world_events.5.f

    event_image = {
		video = "ip4_colonial_exploitation_going_well"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	cooldown = { days = normal_modifier_time }

	cancellation_trigger = {
	}

	trigger = {
		# Triggered by Journal Entry
	}

	immediate = {
		c:SPA ?= {
			save_scope_as = spain_scope
		}
		if = {
			limit = {
				c:SPA ?= {
					any_scope_state = {
						is_incorporated = yes
						is_in_geographic_region = geographic_region_europe
						any_scope_culture = {
							has_homeland = prev
							culture_can_have_mass_migration_to_country = root
						}
					}
				}
				"root.relations(c:SPA)" >= relations_threshold:friendly
				any_scope_state = {
					state_is_eligible_as_mass_migration_target = yes
				}
			}
			c:SPA ?= {
				random_scope_state = {
					limit = {
						is_incorporated = yes
						is_in_geographic_region = geographic_region_europe
						any_scope_culture = {
							has_homeland = prev
							culture_can_have_mass_migration_to_country = root
						}
					}
					save_scope_as = migration_state
					random_scope_culture = {
						limit = {
							has_homeland = prev
							culture_can_have_mass_migration_to_country = root
						}
						save_scope_as = migration_culture
					}
				}
			}
			ordered_scope_state = {
				limit = {
					state_is_eligible_as_mass_migration_target = yes
				}
				order_by = migration_pull
				position = 0
				check_range_bounds = no
				save_scope_as = migration_target_state
			}
		}
	}

	option = {
		name = spanish_new_world_events.5.a
		default_option = yes
		add_modifier = {
			name = modifier_renewed_diplomatic_efforts
			days = long_modifier_time
		}
		if = {
			limit = {
				c:SPA ?= {
					any_scope_state = {
						is_incorporated = yes
						is_in_geographic_region = geographic_region_europe
						any_scope_culture = {
							has_homeland = prev
							culture_can_have_mass_migration_to_country = root
						}
					}
				}
			}
			if = {
				limit = {
					"root.relations(c:SPA)" >= relations_threshold:friendly
				}
				custom_tooltip = je_spanish_american_optional_tt_2
				scope:migration_target_state = {
					create_mass_migration = {
						origin = c:SPA
						culture = scope:migration_culture
					}
				}
			}
		}
	}
}
