on_yearly_pulse_state = {
	on_actions = {
		HMPS_forced_assimilation_and_conversion
	}
}

HMPS_forced_assimilation_and_conversion = { #State Scope
	effect = {
		### Seeding Conversion
		convert_population = { ### Seeding Conversion
			target = owner.religion
			value = {
				add = 1
				add = modifier:state_yearly_forced_conversion_mult
				multiply = modifier:state_yearly_forced_conversion_add
				add = 0.0001
			}
		}
	
	
	
		###### Forced Pop replacement and Seeding Assimilation
		owner = {
			random_primary_culture = {
				save_scope_as = spawning_culture
			}
		}
		if = {#### Forced population replacement
			limit = {
				modifier:state_yearly_forced_population_replacement_add > 0
			}
			ordered_scope_pop = {
				limit = {
					culture = {
						shares_heritage_trait_group_with_any_primary_culture = root.owner
					}
				}
				order_by = total_size
				min=0
				#max=10
				check_range_bounds = no
				change_pop_culture = { 
					target = scope:spawning_culture 
					value = {
						add = 1
						add = state.modifier:state_yearly_forced_population_replacement_mult
						multiply = state.modifier:state_yearly_forced_population_replacement_add
					}
				}
			}
		}
		else_if = {#### Seeding Assimilation in states where a primary Culture does not have a cultural community
			limit = {
				NOT = {
					has_cultural_community = scope:spawning_culture
				}
			}
			ordered_scope_pop = {
				limit = {
					culture = {
						shares_heritage_trait_with_any_primary_culture = root.owner
					}
				}
				order_by = total_size
				min=0
				#max=10
				check_range_bounds = no
				change_pop_culture = { 
					target = scope:spawning_culture 
					value = 0.001
				}
			}
		}
	}
}
