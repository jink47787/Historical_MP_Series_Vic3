on_yearly_pulse_state = {
	on_actions = {
		HMPS_forced_assimilation_and_conversion
	}
}

HMPS_forced_assimilation_and_conversion = { #State Scope
	effect = {
		### Seeding Conversion
		convert_population = { ### Seeding Conversion
			target = owner.religion
			value = {
				add = 1
				add = modifier:state_yearly_forced_conversion_mult
				multiply = modifier:state_yearly_forced_conversion_add
				add = 0.0001
			}
		}
	
	
	
		###### Forced Pop replacement and Seeding Assimilation
		owner = {
			random_primary_culture = {
				save_scope_as = spawning_culture
			}
		}
		if = {#### Forced population replacement
			limit = {
				modifier:state_yearly_forced_population_replacement_add > 0
			}
			ordered_scope_pop = {
				limit = {
					culture = {
						shares_heritage_trait_group_with_any_primary_culture = root.owner
					}
				}
				order_by = total_size
				min=0
				#max=10
				check_range_bounds = no
				change_pop_culture = { 
					target = scope:spawning_culture 
					value = {
						add = 1
						add = state.modifier:state_yearly_forced_population_replacement_mult
						multiply = state.modifier:state_yearly_forced_population_replacement_add
					}
				}
			}
		}
		else_if = {#### Seeding Assimilation in states where a primary Culture does not have a cultural community
			limit = {
				NOT = {
					has_cultural_community = scope:spawning_culture
				}
			}
			ordered_scope_pop = {
				limit = {
					culture = {
						shares_heritage_trait_with_any_primary_culture = root.owner
					}
				}
				order_by = total_size
				min=0
				#max=10
				check_range_bounds = no
				change_pop_culture = { 
					target = scope:spawning_culture 
					value = 0.001
				}
			}
		}
		
		
		if = {#### Forced population replacement
			limit = {
				modifier:state_yearly_forced_language_learning_add  > 0
			}
			if = {
				limit = { owner = { any_primary_culture = { has_discrimination_trait_group = language_group_germanic } } }
				every_scope_pop = {
					if = {  limit = { culture = { OR = { shares_heritage_trait_group_with_any_primary_culture = root.owner
						shares_language_trait_group_with_any_primary_culture = root.owner  } } } change_pop_culture = {  target = scope:spawning_culture
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_african } } change_pop_culture = { target = cu:afro_germanic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_southeast_asian } } change_pop_culture = { target = cu:indo_germanic 
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_middle_eastern } } change_pop_culture = { target = cu:arabo_germanic 
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
				}
			}
			else_if = {
				limit = { owner = { any_primary_culture = { has_discrimination_trait_group = language_group_romance } } }
				every_scope_pop = {
					if = {  limit = { culture = { OR = { shares_heritage_trait_group_with_any_primary_culture = root.owner
						shares_language_trait_group_with_any_primary_culture = root.owner  } } } change_pop_culture = {  target = scope:spawning_culture
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_african } } change_pop_culture = { target = cu:afro_latino
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_southeast_asian } } change_pop_culture = { target = cu:indo_latino 
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_middle_eastern } } change_pop_culture = { target = cu:arabo_latino 
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
				}
			}
			else_if = {
				limit = { owner = { any_primary_culture = { has_discrimination_trait_group = language_group_slavic } } }
				every_scope_pop = {
					if = {  limit = { culture = { OR = { shares_heritage_trait_group_with_any_primary_culture = root.owner
						shares_language_trait_group_with_any_primary_culture = root.owner  } } } change_pop_culture = {  target = scope:spawning_culture
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_african } } change_pop_culture = { target = cu:afro_slavic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_southeast_asian } } change_pop_culture = { target = cu:indo_slavic 
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_middle_eastern } } change_pop_culture = { target = cu:arabo_slavic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
				}
			}
			else_if = {
				limit = { owner = { any_primary_culture = { has_discrimination_trait_group = language_group_japonic } } }
				every_scope_pop = {
					if = {  limit = { culture = { OR = { shares_heritage_trait_group_with_any_primary_culture = root.owner
						shares_language_trait_group_with_any_primary_culture = root.owner  } } } change_pop_culture = {  target = scope:spawning_culture
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_african } } change_pop_culture = { target = cu:afro_japonic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_southeast_asian } } change_pop_culture = { target = cu:indo_japonic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_middle_eastern } } change_pop_culture = { target = cu:arabo_japonic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
				}
			}
			else_if = {
				limit = { owner = { any_primary_culture = { has_discrimination_trait_group = language_group_turkic } } }
				every_scope_pop = {
					if = {  limit = { culture = { OR = { shares_heritage_trait_group_with_any_primary_culture = root.owner
					shares_language_trait_group_with_any_primary_culture = root.owner  } } } change_pop_culture = {  target = scope:spawning_culture
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_african } } change_pop_culture = { target = cu:afro_turkic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					if = { limit = { culture = { has_discrimination_trait_group = heritage_group_african } } change_pop_culture = { target = cu:afro_turkic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_southeast_asian } } change_pop_culture = { target = cu:indo_turkic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_middle_eastern } } change_pop_culture = { target = cu:turkish
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
				}
			}
			else_if = {
				limit = { owner = { any_primary_culture = { has_discrimination_trait_group = language_group_semitic } } }
				every_scope_pop = {
					if = {  limit = { culture = { OR = { shares_heritage_trait_group_with_any_primary_culture = root.owner
						shares_language_trait_group_with_any_primary_culture = root.owner  } } } change_pop_culture = {  target = scope:spawning_culture
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_african } } change_pop_culture = { target = cu:sudanese
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_southeast_asian } } change_pop_culture = { target = cu:indo_arabic
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_middle_eastern } } change_pop_culture = { target = cu:misri
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
					else_if = { limit = { culture = { has_discrimination_trait_group = heritage_group_european } } change_pop_culture = { target = cu:maltese
						value = { add = 1 add = state.modifier:state_yearly_forced_language_learning_mult multiply = state.modifier:state_yearly_forced_language_learning_add } } }
				}
			}
			else = { # If not one of the main colonial languages then just assimilate them straight up, but at only half the speed
				owner = {
					random_primary_culture = {
						save_scope_as = spawning_culture
					}
				}
				every_scope_pop = {
					limit = {
						culture = {
							OR = {
								shares_heritage_trait_group_with_any_primary_culture = root.owner
								shares_language_trait_group_with_any_primary_culture = root.owner
								has_discrimination_trait_group = heritage_group_african
								has_discrimination_trait_group = heritage_group_southeast_asian
								has_discrimination_trait_group = heritage_group_middle_eastern
							}
						}
					}
					change_pop_culture = { 
						target = scope:spawning_culture 
						value = {
							add = 1
							add = state.modifier:state_yearly_forced_language_learning_mult
							multiply = state.modifier:state_yearly_forced_language_learning_add
						}
					}
				}
			}
		}
	}
}
