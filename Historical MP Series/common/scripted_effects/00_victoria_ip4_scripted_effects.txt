ip4_coup_get_owned_pronunciamento_state = {
	if = {
		limit = {
			scope:golpista_general ?= {
				has_role = general
			}
		}
		if = {
			limit = {
				any_scope_state = {
					owner = ROOT
					has_building = building_barrack
				}
			}
			ordered_scope_state = {
				limit = {
					owner = ROOT
					has_building = building_barrack
				}
				order_by = b:building_barrack.level
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
		else = {
			ordered_scope_state = {
				limit = {
					owner = ROOT
				}
				order_by = gdp
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
	}
	else_if = {
		limit = {
			scope:golpista_general ?= {
				has_role = admiral
			}
		}
		if = {
			limit = {
				any_scope_state = {
					owner = ROOT
					has_building = building_naval_base
				}
			}
			ordered_scope_state = {
				limit = {
					owner = ROOT
					has_building = building_naval_base
				}
				order_by = b:building_naval_base.level
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
		else = {
			ordered_scope_state = {
				limit = {
					owner = ROOT
				}
				order_by = gdp
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
	}
}

ip4_coup_get_unowned_pronunciamento_state = {
	if = {
		limit = {
			scope:golpista_general ?= {
				has_role = general
			}
		}
		if = {
			limit = {
				any_scope_state = {
					has_building = building_barrack
				}
			}
			ordered_scope_state = {
				limit = {
					has_building = building_barrack
				}
				order_by = b:building_barrack.level
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
		else = {
			ordered_scope_state = {
				order_by = gdp
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
	}
	else_if = {
		limit = {
			scope:golpista_general ?= {
				has_role = admiral
			}
		}
		if = {
			limit = {
				any_scope_state = {
					has_building = building_naval_base
				}
			}
			ordered_scope_state = {
				limit = {
					has_building = building_naval_base
				}
				order_by = b:building_naval_base.level
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
		else = {
			ordered_scope_state = {
				order_by = gdp
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
	}
}

ip4_coup_get_allied_pronunciamento_state = {
	if = {
		limit = {
			scope:golpista_general ?= {
				has_role = general
			}
		}
		if = {
			limit = {
				any_scope_state = {
					owner = {
						is_diplomatic_play_ally_of = ROOT
					}
					has_building = building_barrack
				}
			}
			ordered_scope_state = {
				limit = {
					owner = {
						is_diplomatic_play_ally_of = ROOT
					}
					has_building = building_barrack
				}
				order_by = b:building_barrack.level
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
		else = {
			ordered_scope_state = {
				limit = {
					owner = {
						is_diplomatic_play_ally_of = ROOT
					}
				}
				order_by = gdp
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
	}
	else_if = {
		limit = {
			scope:golpista_general ?= {
				has_role = admiral
			}
		}
		if = {
			limit = {
				any_scope_state = {
					owner = {
						is_diplomatic_play_ally_of = ROOT
					}
					has_building = building_naval_base
				}
			}
			ordered_scope_state = {
				limit = {
					owner = {
						is_diplomatic_play_ally_of = ROOT
					}
					has_building = building_naval_base
				}
				order_by = b:building_naval_base.level
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
		else = {
			ordered_scope_state = {
				limit = {
					owner = {
						is_diplomatic_play_ally_of = ROOT
					}
				}
				order_by = gdp
				position = 0
				check_range_bounds = no
				save_scope_as = pronunciamento_state
			}
		}
	}
}

add_regency_modifier = { # Applied in country scope, always uses monarch_scope
	if = {
		limit = {
			scope:monarch_scope ?= {
				is_interest_group_type = ig_landowners
			}
		}
		add_modifier = { name = modifier_regency_landowners }
	}
	else_if = {
		limit = {
			scope:monarch_scope ?= {
				is_interest_group_type = ig_devout
			}
		}
		add_modifier = { name = modifier_regency_devout }
	}
	else_if = {
		limit = {
			scope:monarch_scope ?= {
				is_interest_group_type = ig_petty_bourgeoisie
			}
		}
		add_modifier = { name = modifier_regency_petty_bourgeoisie }
	}
	else_if = {
		limit = {
			scope:monarch_scope ?= {
				is_interest_group_type = ig_industrialists
			}
		}
		add_modifier = { name = modifier_regency_industrialists }
	}
	else_if = {
		limit = {
			scope:monarch_scope ?= {
				is_interest_group_type = ig_trade_unions
			}
		}
		add_modifier = { name = modifier_regency_trade_unions }
	}
	else_if = {
		limit = {
			scope:monarch_scope ?= {
				is_interest_group_type = ig_intelligentsia
			}
		}
		add_modifier = { name = modifier_regency_intelligentsia }
	}
	else_if = {
		limit = {
			scope:monarch_scope ?= {
				is_interest_group_type = ig_armed_forces
			}
		}
		add_modifier = { name = modifier_regency_armed_forces }
	}
	else_if = {
		limit = {
			scope:monarch_scope ?= {
				is_interest_group_type = ig_rural_folk
			}
		}
		add_modifier = { name = modifier_regency_rural_folk }
	}
	else = {
		add_modifier = { name = modifier_regency }
	}
}

remove_regency_modifier = { # Applied in country scope
	if = {
		limit = {
			has_modifier = modifier_regency_landowners
		}
		remove_modifier = modifier_regency_landowners
	}
	if = {
		limit = {
			has_modifier = modifier_regency_devout
		}
		remove_modifier = modifier_regency_devout
	}
	if = {
		limit = {
			has_modifier = modifier_regency_petty_bourgeoisie
		}
		remove_modifier = modifier_regency_petty_bourgeoisie
	}
	if = {
		limit = {
			has_modifier = modifier_regency_industrialists
		}
		remove_modifier = modifier_regency_industrialists
	}
	if = {
		limit = {
			has_modifier = modifier_regency_trade_unions
		}
		remove_modifier = modifier_regency_trade_unions
	}
	if = {
		limit = {
			has_modifier = modifier_regency_intelligentsia
		}
		remove_modifier = modifier_regency_intelligentsia
	}
	if = {
		limit = {
			has_modifier = modifier_regency_armed_forces
		}
		remove_modifier = modifier_regency_armed_forces
	}
	if = {
		limit = {
			has_modifier = modifier_regency_rural_folk
		}
		remove_modifier = modifier_regency_rural_folk
	}
	if = {
		limit = {
			has_modifier = modifier_regency
		}
		remove_modifier = modifier_regency
	}
}

ip4_coup_victory_effect = {
	ROOT = { # For notifications
		save_scope_as = coup_country
	}
	ip4_coup_victory_government_effects = yes
	ip4_coup_victory_law_effects = yes
	ip4_coup_victory_special_effects = yes
	ip4_coup_victory_technical_effects = yes
}

ip4_coup_victory_government_effects = {
	if = {
		limit = {
			scope:golpista_ig ?= {
				is_insurrectionary = yes
			}
		}
		scope:golpista_ig ?= {
			abandon_revolution = yes
		}
	}
	if = {
		limit = {
			OR = {
				has_law = law_type:law_republic
				has_law = law_type:law_council_republic
				has_law = law_type:law_technocracy
				#has_law = law_type:law_colonial_administration
				has_gov_regency = yes
			}
			glorious_revolution_coup_trigger = no
			dynastic_coup_trigger = no
		}
		hidden_effect = {
			if = {
				limit = {
					has_gov_regency = yes
				}
				if = {
					limit = {
						ruler = {
							is_immortal = yes
						}
					}
					ruler = {
						set_character_immortal = no
					}
				}
				scope:golpista_ig.leader ?= {
					set_character_immortal = yes
				}
			}
		}
		set_variable = { name = keep_current_ruler_var days = 7 }
		scope:golpista_ig.leader ?= {
			set_character_as_ruler = yes
		}
	}
	scope:golpista_ig = {
		add_modifier = {
			name = modifier_successful_coup
			days = short_modifier_time
			is_decaying = yes
		}
	}
	if = {
		limit = {
			scope:golpista_ig ?= {
				has_party = yes
			}
		}
		scope:golpista_ig.party ?= {
			set_ruling_party = yes
		}
	}
	else = {
		if = {
			limit = {
				scope:golpista_ig ?= {
					is_in_government = no
				}
			}
			scope:golpista_ig ?= {
				add_ruling_interest_group = yes
			}
		}
		every_interest_group = {
			limit = {
				is_in_government = yes
				NOT = {
					scope:golpista_ig ?= this
				}
			}
			remove_ruling_interest_group = yes
		}
	}
	if = {
		limit = {
			owner ?= {
				country_has_voting_franchise = yes
				in_election_campaign = no
			}
		}
		owner ?= {
			call_election = {
				months = 3
			}
		}
	}
	add_modifier = {
		name = modifier_government_recently_couped
		days = short_modifier_time
		is_decaying = yes
	}
}

ip4_coup_victory_law_effects = {
	if = {
		limit = {
			exists = currently_enacting_law
			scope:golpista_ig ?= {
				law_enactment_stance = {
					law = owner.currently_enacting_law.type
					value <= neutral # Will halt enactment unless they approve of the law
				}
			}
		}
		cancel_enactment = yes
	}
	if = {
		limit = {
			exists = scope:coup_desired_law
		}
		activate_law = scope:coup_desired_law.type
	}
	else_if = { # In case
		limit = {
			scope:golpista_ig ?= {
				any_preferred_law = {
					law_is_available = yes
					law_is_valid_for_ig_petition = yes
					NOT = {
						ROOT = {
							has_law = prev.type
						}
					}
				}
			}
		}
		scope:golpista_ig ?= {
			ordered_preferred_law = {
				limit = {
					law_is_available = yes
					law_is_valid_for_ig_petition = yes
					NOT = {
						ROOT = {
							has_law = prev.type
						}
					}
				}
				position = 0
				check_range_bounds = no
				ROOT = {
					activate_law = prev.type
				}
			}
		}
	}
}

ip4_coup_victory_special_effects = {
	if = {
		limit = {
			glorious_revolution_coup_trigger = yes
		}
		custom_tooltip = spain_current_ruler_abdicates_tt
		add_modifier = modifier_regency
		hidden_effect = {
			heir ?= {
				set_variable = deposed_spanish_heir
				place_character_in_void = 500
			}
			ruler = {
				set_variable = deposed_spanish_monarch
				place_character_in_void = 500
			}
		}
		scope:golpista_ig.leader ?= {
			set_character_as_ruler = yes
		}
		set_variable = glorious_revolution_coup_var
		trigger_event = { id = two_spains.4 days = 3 popup = yes }
	}
	else_if = {
		limit = {
			dynastic_coup_trigger = yes
		}
		ip4_coup_victory_dynastic_effects = yes
	}

	if = {
		limit = {
			has_journal_entry = je_warlord_china
			has_variable = china_warlord_explosion
		}
		chi_remove_1_fragile_unity = yes
	}

	if = {
		limit = {
			OR = {
				scope:golpista_ig ?= {
					average_progressiveness >= 50
				}
				scope:golpista_ig.leader ?= {
					average_progressiveness >= 50
				}
			}
			active_law:lawgroup_distribution_of_power ?= {
				has_amendment = amendment_type:amendment_chamber_of_procurators
			}
		}
		active_law:lawgroup_distribution_of_power ?= {
			every_scope_amendment = {
				remove_amendment = yes
			}
		}
		activate_law = law_type:law_wealth_voting
	}
}

ip4_coup_victory_technical_effects = {
	every_diplomatically_relevant_country = {
		limit = {
			has_overlapping_interests = ROOT
		}
		post_notification = successful_coup_in_country
	}
	if = {
		limit = {
			scope:golpista_ig ?= {
				is_interest_group_type = ig_armed_forces
			}
		}
		set_variable = achievement_military_junta_var
	}
	if = {
		limit = {
			has_variable = coup_sponsor
			var:coup_sponsor ?= {
				is_country_alive = yes
			}
		}
		set_owes_obligation_to = {
			country = var:coup_sponsor
			setting = yes
		}
		remove_variable = coup_sponsor
	}
	if = {
		limit = {
			scope:golpista_general ?= {
				has_variable = commander_doing_coup_on_player_behalf
			}
		}
		scope:golpista_general ?= {
			remove_variable = commander_doing_coup_on_player_behalf
		}
	}
	set_variable = { name = recent_coup_or_revolution_var value = 0 }
	change_global_variable = { name = successful_coups add = 1 }
	set_variable = { name = coup_aftermath_var years = 1 }
}

ip4_coup_victory_dynastic_effects = {
	if = {
		limit = {
			has_gov_regency = yes
		}
		remove_regency_modifier = yes
	}
	if = {
		limit = {
			exists = heir
		}
		heir ?= {
			exile_character_with_martyrdom = yes
		}
	}
	if = {
		limit = {
			carlist_coup_trigger = yes
		}
		country_generate_carlist_spain_ruler = yes
		if = {
			limit = {
				country_has_voting_franchise = yes
			}
			activate_law = law_type:law_autocracy
		}
	}
	else_if = {
		limit = {
			isabelline_coup_trigger = yes
		}
		country_generate_constitutional_spain_ruler = yes
	}
	else_if = {
		limit = {
			miguelist_coup_trigger = yes
		}
		country_generate_miguelist_portugal_ruler = yes
		if = {
			limit = {
				country_has_voting_franchise = yes
			}
			activate_law = law_type:law_autocracy
		}
	}
	else_if = {
		limit = {
			constitutional_portugal_coup_trigger = yes
		}
		country_generate_constitutional_portugal_ruler = yes
	}
	else_if = {
		limit = {
			orleanist_coup_trigger = yes
		}
		country_generate_orleanist_france_ruler = yes
	}
	else_if = {
		limit = {
			bonapartist_coup_trigger = yes
		}
		country_generate_bonapartist_france_ruler = yes
	}
	else_if = {
		limit = {
			legitimist_coup_trigger = yes
		}
		country_generate_legitimist_france_ruler = yes
		if = {
			limit = {
				country_has_voting_franchise = yes
			}
			activate_law = law_type:law_autocracy
		}
	}
}

ip4_coup_victory_effect_interaction_display = {
	if = {
		limit = {
			root.interest_group ?= {
				is_insurrectionary = yes
			}
		}
		root.interest_group ?= {
			abandon_revolution = yes
		}
	}
	if = {
		limit = {
			root.interest_group ?= {
				has_party = yes
			}
		}
		root.interest_group.party ?= {
			set_ruling_party = yes
		}
	}
	else = {
		root.interest_group ?= {
			add_ruling_interest_group = yes
		}
		every_interest_group = {
			limit = {
				is_in_government = yes
				NOT = {
					root.interest_group ?= this
				}
			}
			remove_ruling_interest_group = yes
		}
	}
	if = {
		limit = {
			exists = owner.currently_enacting_law
			root.interest_group ?= {
				law_enactment_stance = {
					law = owner.currently_enacting_law.type
					value < neutral
				}
			}
		}
		owner ?= {
			cancel_enactment = yes
		}
	}
	root.interest_group ?= {
		ordered_preferred_law = {
			limit = {
				law_is_available = yes
				NOT = {
					owner = {
						has_law = prev.type
					}
				}
			}
			position = 0
			check_range_bounds = no
			owner = {
				activate_law = prev.type
			}
		}
	}
	if = {
		limit = {
			AND = { # To mirror the conditions of Isabella II's dethroning
				has_journal_entry = je_the_two_spains
				has_law = law_type:law_monarchy
				var:two_spains_tension_current_var >= 50
				ruler ?= { popularity <= define:NCharacters|POPULARITY_LIKED_THRESHOLD }
				has_gov_regency = no
			}
		}
		custom_tooltip = spain_current_ruler_abdicates_owner_scope_tt
		add_modifier = modifier_regency
		hidden_effect = {
			heir ?= {
				set_variable = deposed_spanish_heir
				place_character_in_void = 500
			}
			ruler = {
				set_variable = deposed_spanish_monarch
				place_character_in_void = 500
			}
		}
		scope:golpista_ig.leader ?= {
			set_character_as_ruler = yes
		}
		trigger_event = { id = two_spains.4 days = 3 popup = yes }
	}
	else_if = {
		limit = {
			OR = {
				has_law = law_type:law_republic
				has_law = law_type:law_council_republic
				has_law = law_type:law_technocracy
				has_gov_regency = yes
			}
		}
		scope:golpista_ig.leader ?= {
			set_character_as_ruler = yes
		}
	}
	if = {
		limit = {
			owner ?= {
				country_has_voting_franchise = yes
				in_election_campaign = no
			}
		}
		owner ?= {
			call_election = {
				months = 3
			}
		}
	}
}

create_coup_from_character = { # Takes scope golpista_character
	if = { # Ignores the cooldown
		limit = {
			has_variable = coup_cooldown_var
		}
		remove_variable = coup_cooldown_var
	}
	$CHARACTER$ = {
		set_variable = golpista_var
		save_scope_as = golpista_general
		interest_group = {
			set_variable = golpista_ig_var
			save_scope_as = golpista_ig
		}
		set_variable = { name = monthly_cached_units_share value = this.num_units_share } # Updates at start of coup
		set_variable = { name = monthly_cached_commander_coup_strength value = this.commander_coup_strength }
		owner = {
			add_journal_entry = { type = je_ip4_coup }
		}
	}
}

country_generate_carlist_spain_ruler = {
	if = {
		limit = {
			has_gov_regency = yes
		}
		remove_regency_modifier = yes
	}
	if = {
		limit = {
			game_date < 1861.1.13
		}
		custom_tooltip = {
			text = carlos_vi_tt
			create_character = {
				template = SPC_carlos_vi_de_borbon_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date < 1887.11.18
		}
		custom_tooltip = juan_iii_tt
		country_summon_character_effect = {
			TEMPLATE = SPC_juan_iii_de_borbon_template
			ON_CREATED_EFFECT = summon_legitimist_carlist_effect
		}
	}
	else_if = {
		limit = {
			game_date < 1909.8.15
			game_date > 1848.4.3
		}
		custom_tooltip = carlos_vii_tt
		country_summon_character_effect = {
			TEMPLATE = SPC_carlos_vii_de_borbon_template
			ON_CREATED_EFFECT = summon_legitimist_carlist_effect
		}
	}
	else_if = {
		limit = {
			game_date < 1931.10.2
			game_date > 1870.6.7
		}
		custom_tooltip = jaime_iii_tt
		country_summon_character_effect = {
			TEMPLATE = SPC_jaime_iii_de_borbon_template
			ON_CREATED_EFFECT = summon_legitimist_carlist_effect
		}
	}
	else_if = {
		limit = {
			game_date > 1849.9.12
		}
		custom_tooltip = alfonso_i_tt
		country_summon_character_effect = {
			TEMPLATE = SPC_alfonso_i_de_borbon_template
			ON_CREATED_EFFECT = summon_legitimist_carlist_effect
		}
	}
}

country_generate_constitutional_spain_ruler = {
	if = {
		limit = {
			has_gov_regency = yes
		}
		remove_regency_modifier = yes
	}
	if = {
		limit = {
			game_date <= 1851.12.20
			game_date > 1832.1.30
		}
		custom_tooltip = {
			text = maria_luisa_i_tt
			create_character = {
				template = spa_luisa_fernanda_de_borbon_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date <= 1857.11.28
			game_date > 1851.12.20
		}
		custom_tooltip = {
			text = isabel_iii_tt
			create_character = {
				template = spa_isabel_francisca_de_borbon_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date < 1885.11.25
			game_date > 1857.11.28
		}
		custom_tooltip = {
			text = alfonso_xii_tt
			create_character = {
				template = spa_alfonso_xii_de_borbon_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date > 1886.5.17
		}
		custom_tooltip = {
			text = alfonso_xiii_tt
			create_character = {
				template = spa_alfonso_xiii_de_borbon_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else = {
		custom_tooltip = {
			text = juan_de_borbon_tt
			create_character = {
				first_name = "Juan"
				last_name = "de_Borbon"
				culture = primary_culture
				interest_group = ig_armed_forces
				ruler = yes
				ideology = ideology_moderate
			}
		}
	}
}

after_revolution_technical_effect = {
	trigger_event = {
		id = after_revolution_technical.1
		days = 7
	}
}

switch_from_colonial_slavery_to_pro_slavery = {
	save_temporary_scope_as = landowners_scope
	custom_tooltip = {
		text = switch_from_colonial_slavery_to_pro_slavery_tt
		if = {
			limit = {
				has_ideology = ideology:ideology_pro_slavery_colonial
			}
			remove_ideology = ideology_pro_slavery_colonial
		}
		if = {
			limit = {
				NOT = { has_ideology = ideology:ideology_pro_slavery }
			}
			add_ideology = ideology_pro_slavery
		}
	}
}

country_remove_colonial_variables = {
	if = {
		limit = {
			has_variable = senegal_subject_var
		}
		remove_variable = senegal_subject_var
	}
	if = {
		limit = {
			has_variable = niger_subject_var
		}
		remove_variable = niger_subject_var
	}
	if = {
		limit = {
			has_variable = ethiopia_subject_var
		}
		remove_variable = ethiopia_subject_var
	}
	if = {
		limit = {
			has_variable = zanj_subject_var
		}
		remove_variable = zanj_subject_var
	}
	if = {
		limit = {
			has_variable = southern_africa_subject_var
		}
		remove_variable = southern_africa_subject_var
	}
	if = {
		limit = {
			has_variable = congo_subject_var
		}
		remove_variable = congo_subject_var
	}
}

character_execute_immediate_coup = { # Must be executed in an "owner" scope when the relevant character is "root"
	if = {
		limit = {
			has_journal_entry = je_ip4_coup
			je:je_ip4_coup.journal_entry_age < 180
		}
		ROOT = {
			add_modifier = {
				name = modifier_preempetive_coup
				days = 180
				multiplier = {
					value = 1
					multiply = {
						value = 180
						subtract = owner.je:je_ip4_coup.journal_entry_age
						divide = 180
					}
				}
			}
		}
	}
	hidden_effect = {
		trigger_event = { id = ip4_coup.2 popup = yes }
	}
	custom_tooltip = pronunciamento_immediately_tt
	show_as_tooltip = {
		custom_tooltip = if_coup_is_successful_tt
		ip4_coup_victory_effect_interaction_display = yes
	}
}

country_generate_peripheral_braganza_ruler_display = {
	if = {
		limit = {
			game_date < 1853.1.1
		}
		custom_tooltip = ana_de_jesus_maria_de_braganca_spa_tt
	}
	else_if = {
		limit = {
			game_date >= 1853.1.1
			game_date < 1872.1.1
		}
		custom_tooltip = fernando_de_saxe_coburg_gotha_spa_tt
	}
	else_if = {
		limit = {
			game_date >= 1872.1.1
			game_date < 1920.1.1
		}
		custom_tooltip = afonso_de_braganca_spa_tt
	}
}

country_generate_peripheral_braganza_ruler = {
	if = {
		limit = {
			has_gov_regency = yes
		}
		remove_regency_modifier = yes
	}
	if = {
		limit = {
			game_date < 1853.1.1
		}
		custom_tooltip = {
			text = ana_de_jesus_maria_de_braganca_tt
			create_character = {
				template = POR_ana_de_jesus_maria_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date >= 1853.1.1
			game_date < 1872.1.1
		}
		custom_tooltip = {
			text = fernando_de_saxe_coburg_gotha_tt
			create_character = {
				template = POR_fernando_de_saxe_coburg_gotha_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date >= 1872.1.1
			game_date < 1920.1.1
		}
		custom_tooltip = {
			text = afonso_de_braganca_tt
			create_character = {
				template = POR_afonso_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
}

country_generate_orleanist_france_ruler = {
	if = {
		limit = {
			has_gov_regency = yes
		}
		remove_regency_modifier = yes
	}
	if = {
		limit = {
			game_date > 1838.8.24
			game_date < 1894.1.1
		}
		custom_tooltip = {
			text = philippe_de_orleans_of_paris_tt
			create_character = {
				template = FRA_philippe_de_orleans_of_paris
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date > 1869.2.6
			game_date < 1926.1.1
		}
		custom_tooltip = {
			text = philippe_de_orleans_of_orleans_tt
			create_character = {
				template = FRA_philippe_de_orleans_of_orleans
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date > 1874.9.4
			game_date < 1940.1.1
		}
		custom_tooltip = {
			text = jean_de_orleans_tt
			create_character = {
				template = FRA_jean_de_orleans
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date > 1908.7.5
			game_date < 1999.1.1
		}
		custom_tooltip = {
			text = henri_de_orleans_tt
			create_character = {
				template = FRA_henri_de_orleans
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
}

country_generate_bonapartist_france_ruler = {
	if = {
		limit = {
			has_gov_regency = yes
		}
		remove_regency_modifier = yes
	}
	if = {
		limit = {
			game_date <= 1856.3.16
		}
		summon_napoleon_the_woat = yes
	}
	if = {
		limit = {
			game_date > 1856.3.16
		}
		custom_tooltip = {
			text = napoleon_eugene_louis_bonaparte_tt
			create_character = {
				template = FRA_napoleon_eugene_louis_bonaparte
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date > 1862.7.18
		}
		custom_tooltip = {
			text = victor_bonaparte_tt
			create_character = {
				template = FRA_victor_bonaparte
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date > 1914.1.23
		}
		custom_tooltip = {
			text = louis_bonaparte_tt
			create_character = {
				template = FRA_louis_bonaparte
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
}

country_generate_legitimist_france_ruler = {
	if = {
		limit = {
			has_gov_regency = yes
		}
		remove_regency_modifier = yes
	}
	if = {
		limit = {
			game_date < 1883.1.1
		}
		custom_tooltip = {
			text = henri_de_bourbon_tt
			create_character = {
				template = FRA_henri_de_bourbon
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date < 1887.11.18
		}
		custom_tooltip = juan_iii_tt
		country_summon_character_effect = {
			TEMPLATE = SPC_juan_iii_de_borbon_template
			ON_CREATED_EFFECT = summon_legitimist_carlist_effect
		}
	}
	else_if = {
		limit = {
			game_date < 1909.8.15
			game_date > 1848.4.3
		}
		custom_tooltip = carlos_vii_tt
		country_summon_character_effect = {
			TEMPLATE = SPC_carlos_vii_de_borbon_template
			ON_CREATED_EFFECT = summon_legitimist_carlist_effect
		}
	}
	else_if = {
		limit = {
			game_date < 1931.10.2
			game_date > 1870.6.7
		}
		custom_tooltip = jaime_iii_tt
		country_summon_character_effect = {
			TEMPLATE = SPC_jaime_iii_de_borbon_template
			ON_CREATED_EFFECT = summon_legitimist_carlist_effect
		}
	}
	else_if = {
		limit = {
			game_date > 1849.9.12
		}
		custom_tooltip = alfonso_i_tt
		country_summon_character_effect = {
			TEMPLATE = SPC_alfonso_i_de_borbon_template
			ON_CREATED_EFFECT = summon_legitimist_carlist_effect
		}
	}
}

country_generate_miguelist_portugal_ruler = {
	if = {
		limit = {
			has_gov_regency = yes
		}
		remove_regency_modifier = yes
	}
	### Miguelist Portuguese Monarchs
	if = {
		limit = {
			game_date >= 1836.1.1
			game_date < 1866.11.14
		}
		country_summon_character_effect = {
			TEMPLATE = POR_miguel_i_de_braganca_template
			ON_CREATED_EFFECT = summon_miguel_effect
		}
	}
	else_if = {
		limit = {
			game_date >= 1852.8.5
			game_date < 1853.9.19
		}
		custom_tooltip = {
			text = maria_das_neves_de_braganca_tt
			create_character = {
				template = POR_maria_das_neves_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date >= 1853.9.19
			game_date < 1920.7.31
		}
		custom_tooltip = {
			text = miguel_januario_de_braganca_tt
			create_character = {
				template = POR_miguel_januario_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			game_date >= 1920.7.31
		}
		custom_tooltip = {
			text = duarte_nuno_de_braganca_tt
			create_character = {
				template = POR_duarte_nuno_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
}

country_generate_constitutional_portugal_ruler = {
	if = {
		limit = {
			has_gov_regency = yes
		}
		remove_regency_modifier = yes
	}
	#### Portuguese Monarchs
	if = {
		limit = {
			game_date <= 1837.9.16
		}
		custom_tooltip = {
			text = ana_de_jesus_maria_de_braganca_tt
			create_character = {
				template = POR_ana_de_jesus_maria_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	if = { # if Maria II dies naturally, make Pedro V the ruler
		limit = {
			game_date < 1861.11.11
			game_date > 1837.9.16
		}
		custom_tooltip = {
			text = pedro_v_de_braganca_tt
			create_character = {
				template = POR_pedro_v_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = { # if Pedro V dies naturally, make Luis I the ruler
		limit = {
			game_date < 1889.10.19
			game_date > 1838.10.3
		}
		custom_tooltip = {
			text = luis_i_de_braganca_tt
			create_character = {
				template = POR_luis_i_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = { # if Luis I dies naturally, make Carlos I the ruler
		limit = {
			game_date < 1908.2.1
			game_date > 1863.9.28
		}
		custom_tooltip = {
			text = carlos_i_de_braganca_tt
			create_character = {
				template = POR_carlos_i_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	else_if = { # if Carlos I dies naturally, make Manuel II the ruler
		limit = {
			game_date > 1889.7.2
		}
		custom_tooltip = {
			text = manuel_ii_de_braganca_tt
			create_character = {
				template = POR_manuel_ii_de_braganca_template
				on_created = {
					set_character_as_ruler = yes
				}
			}
		}
	}
}

second_amendment_add_obsessions_effect = {
	if = { # Second Amendment - add obsessions
		limit = {
			owner ?= {
				OR = {
					country_has_primary_culture = cu:yankee
					country_has_primary_culture = cu:dixie
				}
			}
			NOR = {
				cu:yankee = {
					has_cultural_obsession = small_arms
				}
				cu:dixie = {
					has_cultural_obsession = small_arms
				}
			}
		}
		cu:yankee = {
			add_cultural_obsession = small_arms
		}
		cu:dixie = {
			add_cultural_obsession = small_arms
		}
	}
}

second_amendment_remove_obsessions_effect = {
	if = { # Second Amendment - remove obsessions
		limit = {
			OR = {
				country_has_primary_culture = cu:yankee
				country_has_primary_culture = cu:dixie
			}
			OR = {
				cu:yankee = {
					has_cultural_obsession = small_arms
				}
				cu:dixie = {
					has_cultural_obsession = small_arms
				}
			}
		}
		cu:yankee = {
			remove_cultural_obsession = small_arms
		}
		cu:dixie = {
			remove_cultural_obsession = small_arms
		}
	}
}

iberia_calculate_shared_laws = {
	set_global_variable = { name = iberia_shared_laws_var value = 0 }
	ordered_country_in_iberia = {
		limit = {
			is_involved_in_journal_entry = je_iberia
		}
		order_by = prestige
		position = 0
		save_scope_as = iberia_first_country
		every_active_law = {
			limit = {
				save_temporary_scope_as = iberia_first_country_active_law
				any_country_in_iberia = {
					filter = {
						AND = {
							NOT = {
								scope:iberia_first_country ?= this
							}
							is_involved_in_journal_entry = je_iberia
						}
					}
					any_active_law = {
						this.type = scope:iberia_first_country_active_law.type
					}
					count = all
				}
			}
			change_global_variable = { name = iberia_shared_laws_var add = 1 }
		}
	}
}

upgrade_moderniser_movement_effect = {
	if = {
		limit = {
			owner = {
				any_political_movement = {
					is_political_movement_type = movement_modernizer
					has_core_ideology = ideology:ideology_modernizer_movement_1
				}
				NOR = {
					has_law_or_variant = law_type:law_peasant_levies
					has_law_or_variant = law_type:law_guild_system
				}
			}
		}
		owner = {
			random_political_movement = {
				limit = {
					is_political_movement_type = movement_modernizer
					has_core_ideology = ideology:ideology_modernizer_movement_1
				}
				set_core_ideology = ideology_modernizer_movement_2
			}
		}
	}
}

initialise_caciquismo_effect = {
	set_variable = caciquismo_var
	if = {
		limit = {
			OR = {
				active_law:lawgroup_distribution_of_power ?= {
					OR = {
						has_amendment = amendment_type:amendment_chamber_of_procurators
						has_amendment = amendment_type:amendment_chamber_of_gentleman_deputies
					}
				}
				has_law_or_variant = law_type:law_landed_voting
				has_law_or_variant = law_type:law_wealth_voting
				has_law_or_variant = law_type:law_census_voting
				has_law_or_variant = law_type:law_universal_suffrage
			}
		}
		active_law:lawgroup_distribution_of_power ?= {
			add_amendment = {
				type = amendment_electoral_clientelism
				sponsor = PREV.ig:ig_landowners
				cooldown = 1200
			}
		}
	}
}

inherit_caciquismo_effect = {
	if = {
		limit = {
			has_variable = caciquismo_var
		}
		scope:relevant_voting_law ?= {
			add_amendment = {
				type = amendment_electoral_clientelism
				sponsor = PREV.ig:ig_landowners
				cooldown = 1200
			}
		}
	}
}

inherit_free_elections_effect = {
	if = {
		limit = {
			has_variable = free_elections_var
		}
		scope:relevant_voting_law ?= {
			add_amendment = {
				type = amendment_tradition_of_free_elections
				sponsor = PREV.ig:ig_intelligentsia
				cooldown = 1200
			}
		}
	}
}

add_caciquismo_effect = {
	if = {
		limit = {
			has_variable = caciquismo_var
		}
		custom_tooltip = {
			text = caciquismo_add_tt
			change_variable = { name = electoral_fraud_abolish_var subtract = 1 }
		}
	}
	else = {
		custom_tooltip = {
			text = free_elections_subtract_tt
			change_variable = { name = electoral_fraud_abolish_var subtract = 1 }
		}
	}
	add_electoral_confidence = -0.15
	clamp_variable = { name = electoral_fraud_abolish_var max = 5 min = 0 }
}

subtract_caciquismo_effect = {
	if = {
		limit = {
			has_variable = caciquismo_var
		}
		custom_tooltip = {
			text = caciquismo_subtract_tt
			change_variable = { name = electoral_fraud_abolish_var add = 1 }
		}
	}
	else = {
		custom_tooltip = {
			text = free_elections_add_tt
			change_variable = { name = electoral_fraud_abolish_var add = 1 }
		}
	}
	clamp_variable = { name = electoral_fraud_abolish_var max = 5 min = 0 }
	add_electoral_confidence = 0.10
}

handle_possible_absent_caciquismo_variables = {
	if = {
		limit = {
			active_law:lawgroup_distribution_of_power ?= {
				has_amendment = amendment_type:amendment_electoral_clientelism
			}
			NOT = {
				has_variable = caciquismo_var
			}
		}
		set_variable = caciquismo_var
	}
	if = {
		limit = {
			modifier:country_forbid_electoral_fraud_bool = no
			NOT = {
				active_law:lawgroup_distribution_of_power ?= {
					has_amendment = amendment_type:amendment_electoral_clientelism
				}
			}
			NOT = {
				has_variable = electoral_fraud_abolish_var
			}
		}
		set_variable = { name = electoral_fraud_abolish_var value = 0 }
	}
}

remove_electoral_fraud_effect = {
	remove_variable = caciquismo_var
	remove_variable = electoral_fraud_abolish_var
	if = {
		limit ={
			active_law:lawgroup_distribution_of_power ?= {
				has_amendment = amendment_type:amendment_electoral_clientelism
			}
		}
		active_law:lawgroup_distribution_of_power ?= {
			random_scope_amendment = {
				limit = {
					type = amendment_type:amendment_electoral_clientelism
				}
				remove_amendment = yes
			}
		}
	}
	set_variable = free_elections_var
	active_law:lawgroup_distribution_of_power ?= {
		add_amendment = {
			type = amendment_tradition_of_free_elections
			sponsor = PREV.ig:ig_intelligentsia
		}
	}
}

summon_napoleon_the_woat = { # Special case
	save_scope_as = summoning_country
	if = {
		limit = {
			any_character = {
				has_template = fra_napoleon_iii_character_template
			}
		}
		random_character =  {
			limit = {
				has_template = fra_napoleon_iii_character_template
			}
			save_scope_as = summoned_character_scope
			transfer_character_of_unknown_status_to_country_and_make_ruler_effects = yes
		}
		if = {
			limit = {
				year >= 1857
				year < 1873
			}
			create_character = { # As heir
				template = FRA_napoleon_eugene_louis_bonaparte
			}
		}
	}
	else_if = {
		limit = {
			NOT = {
				has_global_variable = napoleon_iii_spawn
			}
		}
		create_character = {
			template = fra_napoleon_iii_character_template
			on_created = {
				set_global_variable = napoleon_iii_spawn
				cleanup_ruler_character_roles = yes
				set_character_as_ruler = yes
				add_character_role = politician
			}
		}
		if = {
			limit = {
				year >= 1857
				year < 1873
			}
			create_character = { # As heir
				template = FRA_napoleon_eugene_louis_bonaparte
			}
		}
	}
	else = {
		create_character = { # El Generico
			first_name = "NapoleO_n"
			last_name = "Bonaparte"
			culture = cu:french
			interest_group = ig_petty_bourgeoisie
			ruler = yes
			ideology = ideology_bonapartist
			on_created = {
				set_variable = house_bonaparte
			}
		}
	}
}

 # AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
 # AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
 # AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

 country_summon_character_effect = {
	save_scope_as = summoning_country
	if = {
		limit = {
			any_character = {
				has_template = $TEMPLATE$
			}
		}
		random_character =  {
			limit = {
				has_template = $TEMPLATE$
			}
			save_scope_as = summoned_character_scope
			transfer_character_of_unknown_status_to_country_and_make_ruler_effects = yes
		}
	}
	else = {
		hidden_effect = {
			create_character = {
				template = $TEMPLATE$
				on_created = {
					$ON_CREATED_EFFECT$ = yes # I heard you like scripted effects, so I put scripted effects in your scripted effects so you can call scripted effects whilst you call scripted effects.
				}
			}
		}
	}
}

transfer_character_of_unknown_status_to_country_effects = {
	if = {
		limit = {
			is_in_void = yes
		}
		hidden_effect = {
			free_character_from_void = yes
		}
	}
	if = {
		limit = {
			is_in_exile_pool = yes
		}
		transfer_character = scope:summoning_country
		set_variable = exile_to_ruler_var
		set_variable = {
			name = memento_mori_immunity
			months = 60
		}
		hidden_effect = {
			free_from_exile_effect = yes
		}
	}
	if = {
		limit = {
			NOT = { owner ?= scope:summoning_country }
		}
		if = {
			limit = {
				scope:summoned_character_scope ?= {
					has_template = fra_napoleon_iii_character_template
				}
			}
			owner = {
				post_notification = napoleon_iii_leaves_country
			}
		}
		else = {
			owner = {
				post_notification = summoned_character_leaves_country
			}
		}
		transfer_character = scope:summoning_country
	}
}

transfer_character_of_unknown_status_to_country_and_make_ruler_effects = { # Requires summoned_character_scope, occurs within this scope, scope:summoning_country is the summoning country
	if = {
		limit = {
			is_in_void = yes
		}
		hidden_effect = {
			free_character_from_void = yes
		}
	}
	if = {
		limit = {
			is_in_exile_pool = yes
		}
		transfer_character = scope:summoning_country
		set_variable = exile_to_ruler_var
		set_variable = {
			name = memento_mori_immunity
			months = 60
		}
		hidden_effect = {
			free_from_exile_effect = yes
		}
	}
	if = {
		limit = {
			NOT = { owner ?= scope:summoning_country }
		}
		owner = {
			save_scope_as = yoink_country
		}
		if = { # Surely this won't cause any utterly insane Personal Unions
			limit = {
				AND = {
					scope:summoning_country ?= {
						has_law = law_type:law_monarchy
					}
					scope:summoned_character_scope ?= {
						is_ruler = yes
						owner ?= {
							has_law = law_type:law_monarchy
							has_gov_regency = no
						}
					}
				}
			}
			if = {
				limit = {
					scope:summoning_country.prestige >= scope:yoink_country.prestige
				}
				custom_tooltip = {
					text = summoning_country_becomes_senior_in_personal_union_with_owner_tt
					scope:summoned_character_scope ?= {
						transfer_character = scope:summoning_country
						set_character_as_ruler = yes
					}
					scope:summoning_country ?= {
						create_diplomatic_pact = {
							country = scope:yoink_country
							type = personal_union
						}
					}
				}
			}
			else = {
				custom_tooltip = {
					text = summoning_country_becomes_junior_in_personal_union_with_owner_tt
					scope:yoink_country ?= {
						create_diplomatic_pact = {
							country = scope:summoning_country
							type = personal_union
						}
					}
				}
			}
		}
		else = {
			if = {
				limit = {
					scope:summoned_character_scope ?= {
						has_template = fra_napoleon_iii_character_template
					}
				}
				owner = {
					post_notification = napoleon_iii_leaves_country
				}
			}
			else = {
				owner = {
					post_notification = summoned_character_leaves_country
				}
			}
			transfer_character = scope:summoning_country
			scope:summoning_country ?= {
				# Make monarch
				if = {
					limit = {
						owner = scope:summoning_country
						is_ruler = yes
					}
					custom_tooltip = summoned_character_becomes_monarch_tt
				}
				else = {
					hidden_effect = {
						cleanup_ruler_character_roles = yes
					}
					set_character_as_ruler = yes
				}
			}
		}
	}
	if = {
		limit = {
			owner ?= scope:summoning_country
		}
		scope:summoned_character_scope ?= {
			hidden_effect = {
				cleanup_ruler_character_roles = yes
			}
			set_character_as_ruler = yes
		}
	}
}

set_character_of_unknown_status_as_heir = { # Fired in a country scope, requires new_heir_scope
	set_heir = scope:new_heir_scope
	if = {
		limit = {
			scope:new_heir_scope ?= {
				is_in_void = yes
			}
		}
		hidden_effect = {
			scope:new_heir_scope ?= {
				free_character_from_void = yes
				transfer_character = prev
			}
		}
	}
	if = {
		limit = {
			scope:new_heir_scope ?= {
				is_in_exile_pool = yes
			}
		}
		scope:new_heir_scope ?= {
			transfer_character = prev
			set_variable = exile_to_ruler_var
			set_variable = {
				name = memento_mori_immunity
				months = 60
			}
			hidden_effect = {
				free_from_exile_effect = yes
			}
		}
	}
}

summon_miguel_effect = {
	set_character_as_ruler = yes
	add_character_role = politician
}

summon_legitimist_carlist_effect = {
	set_character_as_ruler = yes
	add_character_role = politician
	character_carlist_or_legitimist_switch_effect = yes
}

cleanup_ruler_character_roles = {
	if = {
		limit = {
			has_role = agitator
		}
		remove_character_role = agitator
	}
	if = {
		limit = {
			has_role = general
		}
		remove_character_role = general
	}
	if = {
		limit = {
			has_role = admiral
		}
		remove_character_role = admiral
	}
}

run_colonial_governor_cycle = { # Run in character scope
	save_scope_as = current_governor
	owner = { # Saving scopes for the sake of the templates
		save_colonial_governor_generation_scopes = yes
	}
	if = {
		limit = {
			has_variable = colonial_governor_term
		}
		random_list = { # Average term length of 4 years
			4 = {
				change_variable = { name = colonial_governor_term add = 1 }
			}
			0 = {
				modifier = {
					add = {
						value = var:colonial_governor_term
					}
					min = 0
				}
				owner = {
					set_variable = { name = hide_ruler_change_notification days = 7 }
					post_notification = colonial_governor_cycle
					generate_governor_of_same_type = yes
				}
			}
		}
	}
	else = {
		set_variable = { name = colonial_governor_term value = 1 } # Just in case something strange has happened
	}
}

save_colonial_governor_generation_scopes = { # Run in an owner scope
	save_scope_as = colony_scope
	random_primary_culture = {
		save_scope_as = primary_culture_scope
	}
	if = {
		limit = { # BIC governors are company men
			c:BIC ?= this
		}
		ig:ig_industrialists ?= {
			save_scope_as = business_ig_scope
			save_scope_as = plantation_ig_scope
			save_scope_as = extraction_ig_scope
		}
	}
	else = {
		ig:ig_landowners ?= {
			save_scope_as = plantation_ig_scope
		}
		ig:ig_petty_bourgeoisie ?= {
			save_scope_as = business_ig_scope
		}
		ig:ig_industrialists ?= {
			save_scope_as = extraction_ig_scope
		}
	}
	overlord = {
		random_primary_culture = {
			save_scope_as = overlord_primary_culture
		}
		religion = {
			save_scope_as = overlord_religion
		}
	}
}

generate_governor_of_same_type = { # Run in country scope
	if = {
		limit = {
			scope:current_governor ?= {
				has_trait = special_character_colonial_plantation
			}
		}
		scope:current_governor ?= {
			remove_variable = colonial_governor_term
		}
		create_character = {
			template = character_template_colonial_governor_plantation
			on_created = {
				set_character_as_ruler = yes
				remove_character_role = general
				set_variable = { name = colonial_governor_term value = 0 }
			}
		}
	}
	else_if = {
		limit = {
			scope:current_governor ?= {
				has_trait = special_character_colonial_local
			}
		}
		scope:current_governor ?= {
			remove_variable = colonial_governor_term
		}
		create_character = {
			template = character_template_colonial_governor_local
			on_created = {
				set_character_as_ruler = yes
				remove_character_role = general
				set_variable = { name = colonial_governor_term value = 0 }
			}
		}
	}
	else_if = {
		limit = {
			scope:current_governor ?= {
				has_trait = special_character_colonial_extraction
			}
		}
		scope:current_governor ?= {
			remove_variable = colonial_governor_term
		}
		create_character = {
			template = character_template_colonial_governor_extraction
			on_created = {
				set_character_as_ruler = yes
				remove_character_role = general
				set_variable = { name = colonial_governor_term value = 0 }
			}
		}
	}
	else_if = {
		limit = {
			scope:current_governor ?= {
				has_trait = special_character_colonial_business
			}
		}
		scope:current_governor ?= {
			remove_variable = colonial_governor_term
		}
		create_character = {
			template = character_template_colonial_governor_business
			on_created = {
				set_character_as_ruler = yes
				remove_character_role = general
				set_variable = { name = colonial_governor_term value = 0 }
			}
		}
	}
	else_if = {
		limit = {
			scope:current_governor ?= {
				has_trait = special_character_colonial_military
			}
		}
		scope:current_governor ?= {
			remove_variable = colonial_governor_term
		}
		create_character = {
			template = character_template_colonial_governor_military
			on_created = {
				set_character_as_ruler = yes
				set_variable = { name = colonial_governor_term value = 0 }
			}
		}
	}
	else = { # Fallback for edge cases
		scope:current_governor ?= {
			remove_variable = colonial_governor_term
		}
		create_character = {
			template = character_template_colonial_governor_military
			on_created = {
				set_character_as_ruler = yes
				set_variable = { name = colonial_governor_term value = 0 }
			}
		}
	}
}

evaluate_portuguese_pink_map_connection = {
	if = {
		limit = {
			s:STATE_ZAMBEZIA = {
				any_scope_state = {
					owner = {
						OR = {
							c:POR ?= this
							is_subject_of = c:POR
						}
					}
					save_temporary_scope_as = zambezia_scope
				}
			}
			s:STATE_EAST_ANGOLA = {
				any_scope_state = {
					owner = {
						OR = {
							c:POR ?= this
							is_subject_of = c:POR
						}
					}
					save_temporary_scope_as = angola_scope
				}
			}
			scope:zambezia_scope ?= {
				is_in_same_market_area = scope:angola_scope
			}
		}
		c:POR ?= {
			set_variable = achievement_portugal_is_not_a_small_country_connection
		}
	}
	else = {
		if = {
			limit = {
				c:POR ?= {
					has_variable = achievement_portugal_is_not_a_small_country_connection
				}
			}
			c:POR ?= {
				remove_variable = achievement_portugal_is_not_a_small_country_connection
			}
		}
	}
}


initialize_electoral_confidence = {
	set_electoral_confidence = {
		value = 1
		multiply = eagle_burger_freedom_index
	}
	if = {
		limit = {
			game_date > 1836.1.1
			country_has_voting_franchise = yes
			eagle_burger_freedom_index < 0.8
		}
		if = {
			limit = {
				has_modifier = modifier_recent_election_initialisation
			}
			remove_modifier = modifier_recent_election_initialisation
		}
		add_modifier = {
			name = modifier_recent_election_initialisation
			multiplier = {
				value = 1
				subtract = eagle_burger_freedom_index
			}
			days = very_long_modifier_time
			is_decaying = yes
		}
	}
	set_variable = electoral_confidence_initialized
}

cleanup_voting_strength_modifiers = {
	if = {
		limit = {
			has_modifier = missouri_compromise
		}
		remove_modifier = missouri_compromise
	}
	if = {
		limit = {
			has_modifier = modifier_portugal_liberal_hegemony
		}
		remove_modifier = modifier_portugal_liberal_hegemony
		add_modifier = {
			name = modifier_portugal_liberal_hegemony_no_voting
			days = long_modifier_time
			is_decaying = yes
		}
	}
	if = {
		limit = {
			has_modifier = modifier_libertad_igualdad_fraternidad
		}
		remove_modifier = modifier_libertad_igualdad_fraternidad
		add_modifier = {
			name = modifier_libertad_igualdad_fraternidad_no_voting
			days = long_modifier_time
			is_decaying = yes
		}
	}
	if = {
		limit = {
			has_modifier = modifier_governors_policy
		}
		remove_modifier = modifier_governors_policy
	}
	if = {
		limit = {
			has_modifier = modifier_anti_electorialism
		}
		remove_modifier = modifier_anti_electorialism
	}
	if = {
		limit = {
			has_modifier = modifier_farmers_voting_conservative
		}
		remove_modifier = modifier_farmers_voting_conservative
	}
	if = {
		limit = {
			has_modifier = modifier_political_involvement_welcomed
		}
		remove_modifier = modifier_political_involvement_welcomed
	}
}
