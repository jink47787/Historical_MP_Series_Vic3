je_devorismo = {
	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	group = je_group_historical_content

	on_monthly_pulse = {
		random_events = {
			40 = 0
			10 = devorismo.3 # Lisbon Patriotic Society
			10 = devorismo.4 # Burning of the Royal Exchequer
		}
	}

	modifiers_while_active = {
		modifier_devorismo
	}

	immediate = {
		ig:ig_petty_bourgeoisie ?= {
			save_scope_as = cartist_ig
		}
	}

	custom_completion_header = je_devorismo_cartist_header

	complete = {
		OR = {
			AND = {
				gold_reserves > 0
				taking_loans = no
			}
			custom_tooltip = {
				text = all_privatisable_buildings_have_been_privatised_tt
				any_scope_building = {
					filter = {
						NOR = {
							is_building_group = bg_government
							is_building_group = bg_construction
							is_building_group = bg_military
							is_building_group = bg_urban_facilities
							is_building_group = bg_canals
							is_building_group = bg_monuments_hidden
							is_building_group = bg_service
							is_building_group = bg_owner_buildings
							has_active_production_method = pm_anchorage
						}
						level > 0
					}
					country_ownership_fraction = 0
					percent > je_devorismo_privatisation_target
				}
			}
		}
	}

	custom_on_completion_header = je_devorismo_on_cartist_victory_header

	on_complete = {
		show_as_tooltip = {
			custom_tooltip = if_loans_paid_off_tt
			custom_tooltip = if_nothing_left_to_privatise_tt
		}
		hidden_effect = {
			if = {
				limit = {
					AND = {
						gold_reserves > 0
						taking_loans = no
					}
				}
				trigger_event = { id = devorismo.1 }
			}
			else_if = {
				limit = {
					any_scope_building = {
						filter = {
							NOR = {
								is_building_group = bg_government
								is_building_group = bg_construction
								is_building_group = bg_military
								is_building_group = bg_urban_facilities
								is_building_group = bg_canals
								is_building_group = bg_monuments_hidden
								is_building_group = bg_service
								is_building_group = bg_owner_buildings
								has_active_production_method = pm_anchorage
							}
							level > 0
						}
						country_ownership_fraction = 0
						percent > je_devorismo_privatisation_target
					}
				}
				trigger_event = { id = devorismo.5 }
			}
		}
	}

	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_devorismo_complete_tt
			}
		}
	}

	custom_failure_header = je_devorismo_constitutionalist_header

    fail = {
        OR = {
        	socialist_revolution_ongoing = yes
        	liberal_revolution_ongoing = yes
			AND = {
				government_legitimacy >= 50
				NOT = { has_law = law_type:law_oligarchy }
				country_has_voting_franchise = yes
				custom_tooltip = {
					text = no_cartist_in_government_tt
					NOT = {
						any_interest_group = {
							is_in_government = yes
							has_ideology = ideology:ideology_cartist
						}
					}
				}
			}
        }
    }

	custom_on_failure_header = je_devorismo_on_constitutionalist_victory_header

	on_fail = {
		show_as_tooltip = {
			custom_tooltip = if_revolution_ongoing_tt
			custom_tooltip = if_removed_cartists_tt
		}
		hidden_effect = {
			if = {
				limit = {
					OR = {
						socialist_revolution_ongoing = yes
						liberal_revolution_ongoing = yes
					}
				}
				trigger_event = { id = devorismo.2 }
			}
			else_if = {
				limit = {
					AND = {
						country_has_voting_franchise = yes
						custom_tooltip = {
							text = no_cartist_in_government_tt
							NOT = {
								any_interest_group = {
									is_in_government = yes
									has_ideology = ideology:ideology_cartist
								}
							}
						}
					}
				}
				trigger_event = { id = devorismo.6 }
			}
		}
	}

	event_outcome_failed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_devorismo_fail_tt
			}
		}
	}

	weight = 5000

    should_be_pinned_by_default = yes
}

je_second_liberalism = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_historical_content

    is_shown_in_lobby = {
        c:POR ?= this
        has_dlc_feature = ip4_content
    }

	complete = {
		country_has_voting_franchise = yes
		bureaucracy >= 0
		approaching_bureaucracy_shortage = no
		radical_fraction = {
			value <= 0.10
		}
		OR = {
			custom_tooltip = {
				text = je_portugal_regeneration_tt
				has_variable = regeneration_complete
			}
			gdp_ranking <= 8
		}
		trigger_if = {
			limit = {
				has_variable = recent_coup_or_revolution_var
			}
			custom_tooltip = {
				text = no_coups_for_ten_years_smart_tt
				NOT = {
					has_variable = recent_coup_or_revolution_var
				}
			}
		}
		trigger_else = {
			limit = {
				NOT = {
					has_variable = recent_coup_or_revolution_var
				}
			}
			custom_tooltip = {
				text = no_coups_for_ten_years_tt
				NOT = {
					has_variable = recent_coup_or_revolution_var
				}
			}
		}
		custom_tooltip = {
			text = no_notable_miguelists_tt
			NOT = {
				any_interest_group = {
					ig_counts_as_marginal = no
					leader = {
						character_has_miguelist_ideology = yes
					}
				}
			}
		}
	}

	on_complete = {
		trigger_event = { id = second_liberalism.1 popup = yes }
	}

	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_second_liberalism.1_tt
			}
		}
	}

    fail = {
		OR = {
			NOT = {
				has_law = law_type:law_monarchy
			}
			AND = {
				has_law = law_type:law_monarchy
				custom_tooltip = {
					text = miguelist_monarch_tt
					ruler = {
						character_has_miguelist_ideology = yes
					}
				}
			}
		}
    }

	on_fail = {
		show_as_tooltip = {
			custom_tooltip = if_republic_instated_tt
			custom_tooltip = if_miguelist_king_tt
		}
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_law = law_type:law_monarchy
					}
				}
				trigger_event = { id = second_liberalism.2 }
			}
			else_if = {
				limit = {
					AND = {
						has_law = law_type:law_monarchy
						ruler = {
							character_has_miguelist_ideology = yes
						}
					}
				}
				trigger_event = { id = second_liberalism.3 }
			}
		}
	}

	event_outcome_failed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_second_liberalism_fail_tt
			}
		}
	}

	weight = 6000

    should_be_pinned_by_default = yes
}

je_portugal_regeneration = {
	icon = "gfx/interface/icons/invention_icons/philosophical_pragmatism.dds"

    is_shown_in_lobby = {
        c:POR ?= this
        has_dlc_feature = ip4_content
    }

	group = je_group_historical_content

	is_shown_when_inactive = {
		OR = {
			c:POR ?= this
			was_formed_from = POR
		}
		has_dlc_feature = ip4_content
	}

	possible = {
		has_technology_researched = nationalism
		legitimacy >= 65
		any_interest_group = {
			is_in_government = yes
			OR = {
				is_interest_group_type = ig_petty_bourgeoisie
				is_interest_group_type = ig_intelligentsia
				is_interest_group_type = ig_industrialists
				is_interest_group_type = ig_trade_unions
			}
		}
		trigger_if = {
			limit = {
				has_variable = recent_coup_or_revolution_var
			}
			custom_tooltip = {
				text = no_coups_for_ten_years_smart_tt
				NOT = {
					has_variable = recent_coup_or_revolution_var
				}
			}
		}
		trigger_else = {
			limit = {
				NOT = {
					has_variable = recent_coup_or_revolution_var
				}
			}
			custom_tooltip = {
				text = no_coups_for_ten_years_tt
				NOT = {
					has_variable = recent_coup_or_revolution_var
				}
			}
		}
	}

	immediate = {
		set_variable = { name = surplus_time_var value = 0 }
		set_variable = { name = je_age_in_months_var value = 0 }
        add_journal_entry = { type = je_portugal_regeneration_public_works }
        add_journal_entry = { type = je_portugal_regeneration_agriculture }
        add_journal_entry = { type = je_portugal_regeneration_institutions }
		trigger_event = { id = portugal_regeneration.1 }
	}

	on_monthly_pulse = {
        effect = {
			change_variable = { name = je_age_in_months_var add = 1 } # journal_entry_age is in days, I want months
			if = {
				limit = {
					net_total_income > 0
				}
				change_variable = { name = surplus_time_var add = 1 }
			}
		}
	}

	complete = {
		trigger_if = {
			limit = {
				AND = {
					has_variable = surplus_time_var
					has_variable = je_age_in_months_var
				}
			}
			OR = {
				custom_tooltip = {
					text = surplus_50_percent_of_the_time_tt
					var:surplus_time_var >= {
						value = var:je_age_in_months_var
						divide = 2
					}
				}
				gold_reserves > 0
			}
		}
		OR = {
			has_law = law_type:law_low_income_tax
			has_law = law_type:law_moderate_income_tax
			has_law = law_type:law_high_income_tax
		}
		custom_tooltip = {
			text = je_portugal_regeneration_public_works_tt
			has_variable = je_portugal_regeneration_public_works
		}
		custom_tooltip = {
			text = je_portugal_regeneration_agriculture_complete_tt
			has_variable = je_portugal_regeneration_agriculture_complete
		}
		custom_tooltip = {
			text = je_portugal_regeneration_institutions_tt
			has_variable = je_portugal_regeneration_institutions
		}
	}

	on_complete = {
		set_variable = regeneration_complete
		trigger_event = { id = portugal_regeneration.2 }
	}

	event_outcome_completed_effect_desc = {
        header = portugal_regeneration.2.a
        effect = {
			add_modifier = {
				name = modifier_regenerated_portugal
				days = very_long_modifier_time
				is_decaying = yes
			}
			active_law:lawgroup_economic_system ?= {
				add_amendment = {
					type = amendment_economic_regeneration_1
					sponsor = PREV.ig:ig_industrialists
					cooldown = 240
				}
			}
        }
    }

    event_outcome_completed_effect_desc = {
        header = portugal_regeneration.2.b
        effect = {
            ruler = {
				add_modifier = {
					name = modifier_successful_regeneration
					days = very_long_modifier_time
				}
			}
			ordered_interest_group = {
				limit = {
					is_in_government = yes
					OR = {
						is_interest_group_type = ig_petty_bourgeoisie
						is_interest_group_type = ig_intelligentsia
						is_interest_group_type = ig_industrialists
						is_interest_group_type = ig_trade_unions
					}
				}
				order_by = ig_clout
				position = 0
				check_range_bounds = no
				leader = {
					add_modifier = {
						name = modifier_successful_regeneration
						days = very_long_modifier_time
					}
				}
			}
			add_modifier = {
				name = modifier_regenerated_portugal
				days = very_long_modifier_time
				multiplier = 0.5
				is_decaying = yes
			}
			active_law:lawgroup_economic_system ?= {
				add_amendment = {
					type = amendment_economic_regeneration_2
					sponsor = PREV.ig:ig_industrialists
					cooldown = 240
				}
			}
        }
    }

    fail = {
		OR = {
			custom_tooltip = {
				text = no_coups_tt
				has_variable = recent_coup_or_revolution_var
			}
			in_default = yes
		}
    }

	on_fail = {
		trigger_event = { id = portugal_regeneration.3 }
	}

	event_outcome_failed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_portugal_regeneration.3_tt
			}
		}
	}

	weight = 6000

    should_be_pinned_by_default = yes
}


je_portugal_regeneration_public_works = {
	icon = "gfx/interface/icons/invention_icons/railways.dds"

	group = je_group_historical_content

	complete = {
		has_technology_researched = electric_telegraph
		any_scope_state = {
			filter = {
				is_incorporated = yes
			}
			has_building = building_railway
			percent = 1
		}
		any_scope_building = {
			filter = {
				is_building_type = building_urban_center
				state = { is_incorporated = yes }
			}
			has_active_production_method = pm_public_trams
			percent >= 0.75
		}
		NOT = {
			any_scope_state = {
				market_access < 1
			}
		}
	}

	on_complete = {
		set_variable = je_portugal_regeneration_public_works
		trigger_event = { id = portugal_regeneration.5 }
	}

	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_portugal_regeneration.5_tt
			}
		}
	}

    fail = {
		OR = {
			custom_tooltip = {
				text = no_coups_tt
				has_variable = recent_coup_or_revolution_var
			}
			in_default = yes
		}
    }

	weight = 6000

    should_be_pinned_by_default = yes
}

je_portugal_regeneration_agriculture = {
	icon = "gfx/interface/icons/invention_icons/threshing_machine.dds"

	group = je_group_historical_content

	complete = {
		has_technology_researched = improved_fertilizer
		has_technology_researched = threshing_machine
		OR = {
			has_law = law_type:law_homesteading
			has_law = law_type:law_commercialized_agriculture
		}
		any_scope_building = {
			filter = {
				is_building_group = bg_staple_crops
				state = { is_incorporated = yes }
			}
			OR = {
				has_active_production_method = pm_fertilization
				hidden_trigger = {
					has_active_production_method = pm_fertilization_building_rice_farm
				}
			}
			percent >= 0.5
		}
		any_scope_building = {
			filter = {
				is_building_group = bg_staple_crops
				state = { is_incorporated = yes }
			}
			OR = {
				has_active_production_method = pm_steam_threshers
				hidden_trigger = {
					has_active_production_method = pm_steam_threshers_building_rice_farm
				}
			}
			percent >= 0.5
		}
	}

	on_complete = {
		set_variable = je_portugal_regeneration_agriculture_complete
		trigger_event = { id = portugal_regeneration.4 }
	}

	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_portugal_regeneration.4_tt
			}
		}
	}

    fail = {
		OR = {
			custom_tooltip = {
				text = no_coups_tt
				has_variable = recent_coup_or_revolution_var
			}
			in_default = yes
		}
    }

	weight = 6000

    should_be_pinned_by_default = yes
}

je_portugal_regeneration_institutions = {
	icon = "gfx/interface/icons/invention_icons/bureaucracy.dds"

	group = je_group_historical_content

	complete = {
		bureaucracy >= 0
		approaching_bureaucracy_shortage = no
		literacy_rate >= 0.5
		institution_investment_level = {
			institution = institution_schools
			value >= 3
		}
		country_has_building_group_levels = {
			type = bg_technology
			value >= 12
		}
	}

	on_complete = {
		set_variable = je_portugal_regeneration_institutions
		trigger_event = { id = portugal_regeneration.6 }
	}

	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_portugal_regeneration.6_tt
			}
		}
	}

    fail = {
		OR = {
			custom_tooltip = {
				text = no_coups_tt
				has_variable = recent_coup_or_revolution_var
			}
			in_default = yes
		}
    }

	weight = 6000

    should_be_pinned_by_default = yes
}
