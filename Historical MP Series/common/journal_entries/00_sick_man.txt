je_sick_man_main = {
	icon = "gfx/interface/icons/event_icons/ottoman_breakup.dds"
	
	group = je_group_historical_content
	
	is_shown_in_lobby = {
		c:TUR = THIS
    }

	complete = {
		custom_tooltip = {
			text = tanzamat_complete_tt
			scope:journal_entry = {
				is_goal_complete = yes
			}
		}
	}

	on_complete = {
		remove_modifier = sick_man_of_europe
		set_variable = sick_man_complete_success
		custom_tooltip = sick_man_complete_tt
		
		hidden_effect = {
			if = {
				limit = {
					has_variable = completed_tanzimat_education
				}
				if = {
					limit = {
						NOT = { has_technology_researched = empiricism }
					}
					add_technology_progress = { progress = 3000 technology = empiricism }
				}
				if = {
					limit = {
						has_technology_researched = empiricism
						NOT = { has_technology_researched = dialectics }
					}
					add_technology_progress = { progress = 3000 technology = dialectics }
				}
			}
			if = {
				limit = {
					has_variable = completed_tanzimat_army
				}
				if = {
					limit = {
						NOT = { has_technology_researched = napoleonic_warfare }
					}
					add_technology_progress = { progress = 3000 technology = napoleonic_warfare }
				}
				if = {
					limit = {
						has_technology_researched = napoleonic_warfare
						NOT = { has_technology_researched = logistics }
					}
					add_technology_progress = { progress = 3000 technology = logistics }
				}
			}
			if = {
				limit = {
					has_variable = completed_tanzimat_bureaucracy
				}
				if = {
					limit = {
						NOT = { has_technology_researched = law_enforcement }
					}
					add_technology_progress = { progress = 3000 technology = law_enforcement }
				}
				if = {
					limit = {
						has_technology_researched = law_enforcement
						NOT = { has_technology_researched = central_archives }
					}
					add_technology_progress = { progress = 3000 technology = central_archives }
				}
			}
			if = {
				limit ={
					has_variable = completed_tanzimat_economy
				}
				ruler = {
					add_trait = meticulous
				}
			}
			if = {
				limit = {
					has_variable = completed_tanzimat_separatism
				}
				ruler = {
					add_trait = imperious
				}
			}
			if = {
				limit = {
					has_variable = completed_tanzimat_greece
				}
				add_modifier = {
					name = reclaimed_greece
					duration = 5475
					is_decaying = yes
				}
			}
			if = {
				limit = {
					has_variable = completed_tanzimat_syria
				}
				add_modifier = {
					name = reclaimed_syria
					duration = 5475
					is_decaying = yes
				}
			}
			if = {
				limit = {
					has_variable = completed_tanzimat_egypt
				}
				add_modifier = {
					name = reclaimed_egypt
					duration = 5475
					is_decaying = yes
				}
			}
		}
		

		
		
		trigger_event = {
			id = sick_man.2 #SICK MAN SUCCESS
		}
	}

	timeout = 10950

	on_timeout = {
		remove_modifier = sick_man_of_europe
		trigger_event = {
			id = sick_man.3 #SICK MAN FAIL MAKES OTTOSMANS UNRECOGNIZED
		}
		if = {
			limit = {
	       		is_in_power_bloc = yes
	        	is_power_bloc_leader = yes				
			}
			custom_tooltip = sick_man_of_europe_lose_power_bloc
		}
		custom_tooltip = {
			text = je_sick_man_main_failure_movements_tt
			set_variable = {
				name = failed_tanzimat
				years = 20
			}
		}
	}

	current_value = {
		value = var:sick_man_var
	}

	goal_add_value = {
		add = 5
	}

	progressbar = yes

	weight = 10000

	should_be_pinned_by_default = yes
}

je_sick_man_syria = {
	icon = "gfx/interface/icons/event_icons/egypt_breakup.dds"
	
	group = je_group_historical_content

	complete = {
		#OR = {
			owns_entire_state_region = STATE_GREATER_SYRIA
		#	any_subject_or_below = {
		#		owns_entire_state_region = STATE_GREATER_SYRIA
		#	}
		#}
		#OR = {
			owns_entire_state_region = STATE_TRANSJORDAN
		#	any_subject_or_below = {
		#		owns_entire_state_region = STATE_TRANSJORDAN
		#	}
		#}
		#OR = {
			owns_entire_state_region = STATE_ADANA
		#	any_subject_or_below = {
		#		owns_entire_state_region = STATE_ADANA
		#	}
		#}
	}
	
	modifiers_while_active = {
		ottomans_reclaim
	}
	
	on_complete = {
		custom_tooltip = je_sick_man_advance
		change_variable = {
			name = sick_man_var
			add = 1
		}
		set_variable = completed_syria_je
		s:STATE_SINAI = {
			add_claim = ROOT
		}
		s:STATE_UPPER_EGYPT = {
			add_claim = ROOT
		}
		s:STATE_MIDDLE_EGYPT = {
			add_claim = ROOT
		}
		s:STATE_LOWER_EGYPT = {
			add_claim = ROOT
		}
		s:STATE_MATRUH = {
			add_claim = ROOT
		}
		s:STATE_EGYPTIAN_DESERT = {
			add_claim = ROOT
		}
		#if = {
		#	limit = {
		#		owns_entire_state_region = STATE_SINAI
		#		owns_entire_state_region = STATE_UPPER_EGYPT
		#		owns_entire_state_region = STATE_MIDDLE_EGYPT
		#		owns_entire_state_region = STATE_LOWER_EGYPT
		#	}
		#	custom_tooltip = je_sick_man_advance
		#	change_variable = {
		#		name = sick_man_var
		#		add = 1
		#	}
		#}
		#else = {
		add_journal_entry = {
			type = je_sick_man_egypt
		}
		#}
		custom_tooltip = sick_man_complete_syria_tt
		set_variable = completed_tanzimat_syria
		
	}

	invalid = {
		custom_tooltip = {
			text = finished_sick_man_tt
			has_variable = sick_man_complete
		}
	}

	on_weekly_pulse = {
		events = {
			egyptian_crisis_events.1
		}
	}

	transferable = no

	weight = 5000
	should_be_pinned_by_default = yes
}

je_sick_man_egypt = {
	icon = "gfx/interface/icons/event_icons/egypt_breakup.dds"
	
	group = je_group_historical_content

	complete = {
		OR = {
			AND = {
				exists = c:EGY
				c:EGY ?= {
					is_subject_of = ROOT
				}
			}
			AND = {
				owns_entire_state_region = STATE_SINAI
				owns_entire_state_region = STATE_UPPER_EGYPT
				owns_entire_state_region = STATE_MIDDLE_EGYPT
				owns_entire_state_region = STATE_LOWER_EGYPT
			}
		}
	}

	modifiers_while_active = {
		ottomans_reclaim
	}

	on_complete = {
		custom_tooltip = je_sick_man_advance
		change_variable = {
			name = sick_man_var
			add = 1
		}
		set_variable = completed_tanzimat_egypt
		custom_tooltip = sick_man_complete_egypt_tt
	}

	invalid = {
		custom_tooltip = {
			text = finished_sick_man_tt
			has_variable = sick_man_complete
		}
	}

	transferable = no

	weight = 5000
	should_be_pinned_by_default = yes
}

je_sick_man_greece = {
	icon = "gfx/interface/icons/event_icons/greece_breakup.dds"
	
	group = je_group_historical_content

	complete = {
		calc_true_if = {
			amount >= 3
			owns_entire_state_region = STATE_ATTICA
			owns_entire_state_region = STATE_PELOPONNESE
			owns_entire_state_region = STATE_WEST_AEGEAN_ISLANDS
			owns_entire_state_region = STATE_CRETE
			owns_entire_state_region = STATE_IONIAN_ISLANDS
		}
	}

	modifiers_while_active = {
		ottomans_reclaim
	}
	
	on_complete = {
		custom_tooltip = je_sick_man_advance
		change_variable = {
			name = sick_man_var
			add = 1
		}
		set_variable = completed_syria_je
		s:STATE_NORTHERN_SERBIA = {
			add_claim = ROOT
		}
		s:STATE_WALLACHIA = {
			add_claim = ROOT
		}
		s:STATE_MOLDAVIA = {
			add_claim = ROOT
		}
		s:STATE_MONTENEGRO = {
			add_claim = ROOT
		}
		set_variable = completed_tanzimat_greece
		custom_tooltip = sick_man_complete_greece_tt
	}

	invalid = {
		custom_tooltip = {
			text = finished_sick_man_tt
			has_variable = sick_man_complete
		}
	}

	on_weekly_pulse = {
		events = {
			greek_crisis_events.1
		}
	}

	transferable = no

	weight = 5000
	should_be_pinned_by_default = yes
}

je_sick_man_economy = {
	icon = "gfx/interface/icons/event_icons/industry.dds"
	
	group = je_group_historical_content

	complete = {
		in_default = no
		country_has_building_group_levels = {
			type = bg_service
			value  >= 30
		}
		any_scope_pop = { percent<0.7 NOT = { is_pop_type = peasants } }
		#any_scope_state = {
		#	is_incorporated = yes
		#	has_building = building_urban_center
		#	percent >= 0.5
		#}
	}

	on_complete = {
		set_variable = completed_sick_man_economy_je
		custom_tooltip = je_sick_man_advance
		change_variable = {
			name = sick_man_var
			add = 1
		}
		set_variable = completed_tanzimat_economy
		custom_tooltip = sick_man_complete_urbanization_tt
	}

	invalid = {
		custom_tooltip = {
			text = finished_sick_man_tt
			has_variable = sick_man_complete
		}
	}

	transferable = no

	weight = 5000
	should_be_pinned_by_default = yes
}

# Literacy and Universities
je_sick_man_education = {
	icon = "gfx/interface/icons/event_icons/research.dds"
	
	group = je_group_historical_content
	
	scripted_progress_bar = tanzimat_education_core_progress_bar

	complete = {
		NOT = { has_law = law_type:law_no_schools }
		custom_tooltip = {
			text = je_sick_man_education_complete
			scope:journal_entry = {
                "scripted_bar_progress(tanzimat_education_core_progress_bar)" >= 100
            }
		}
	}

	on_complete = {
		set_variable = completed_sick_man_education_je
		custom_tooltip = je_sick_man_advance
		change_variable = {
			name = sick_man_var
			add = 1
		}
		set_variable = completed_tanzimat_education
		custom_tooltip = sick_man_complete_education_tt
	}


	invalid = {
		custom_tooltip = {
			text = finished_sick_man_tt
			has_variable = sick_man_complete
		}
	}

	transferable = no

	weight = 5000
	should_be_pinned_by_default = yes

}

# Nationalism
je_sick_man_separatism = {
	icon = "gfx/interface/icons/event_icons/event_fire.dds"
	
	group = je_group_historical_content

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
		highest_secession_progress < 0.5
	}

	on_complete = {
		set_variable = completed_separatism_sick_man_je
		custom_tooltip = je_sick_man_advance
		change_variable = {
			name = sick_man_var
			add = 1
		}
		set_variable = completed_tanzimat_separatism
		custom_tooltip = sick_man_complete_seperatism_tt
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					highest_secession_progress < 0.5
				}
				change_variable = {
					name = sick_man_separatist_var
					add = 1
				}
			}
		}
		random_events = {
			100 = 0
			#10 = tanzimat_events.5 # Paranoia Event
		}
	}

	fail = {
		highest_secession_progress > 0.9
	}

	current_value = {
		value = var:sick_man_separatist_var
	}

	goal_add_value = {
		add = 180
	}

	invalid = {
		custom_tooltip = {
			text = finished_sick_man_tt
			has_variable = sick_man_complete
		}
	}

	transferable = no

	weight = 5000

	should_be_pinned_by_default = yes

	progressbar = yes
}

# Army Reform
je_sick_man_army = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"
	
	group = je_group_historical_content

	complete = {
		army_size >= 100
		has_technology_researched = napoleonic_warfare
		any_scope_building = {
			filter = {
				is_building_type = building_barrack
			}			
			NOR = {
				building_has_goods_shortage = yes
				has_active_production_method = pm_no_organization
			}
			percent = 1
		}
		NOT = {
			any_military_formation = {
				filter = {
					is_army = yes
				}
				any_combat_unit = {
					has_unit_type = unit_type:combat_unit_type_irregular_infantry
				}
				percent >= 0.25
			}
		}
	}

	on_complete = {
		set_variable = completed_sick_man_army_je
		custom_tooltip = je_sick_man_advance
		change_variable = {
			name = sick_man_var
			add = 1
		}
		set_variable = completed_tanzimat_army
		custom_tooltip = sick_man_complete_army_tt
	}

	on_monthly_pulse = {
		events = {
			#tanzimat_events.10 # Tanzimat Draft Question
		}
	}

	invalid = {
		custom_tooltip = {
			text = finished_sick_man_tt
			has_variable = sick_man_complete
		}
	}

	transferable = no

	should_be_pinned_by_default = yes

	weight = 5000
}


# Bureaucractic Reform
je_sick_man_bureaucracy = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_historical_content
	
	scripted_progress_bar = tanzimat_bureaucracy_core_progress_bar
	
	complete = {
		OR = {
			AND = {
				custom_tooltip = {
					text = je_sick_man_bureaucracy_complete
					scope:journal_entry = {
						"scripted_bar_progress(tanzimat_bureaucracy_core_progress_bar)" >= 100
					}
				}
				OR = {
					NOT = { has_law_or_variant = law_type:law_hereditary_bureaucrats }
					NOT = { has_law_or_variant = law_type:law_traditionalism }
				}	
			}
			NOR = { 
				has_law_or_variant = law_type:law_hereditary_bureaucrats 
				has_law_or_variant = law_type:law_traditionalism
				has_law_or_variant = law_type:law_traditionalism
			}
		}
		bureaucracy >= 0 
		approaching_bureaucracy_shortage = no
	}

	on_complete = {
		set_variable = completed_sick_man_bureaucracy_je
		custom_tooltip = je_sick_man_advance
		change_variable = {
			name = sick_man_var
			add = 1
		}
		remove_modifier = outmoded_bureaucracy
		set_variable = completed_tanzimat_bureaucracy
		custom_tooltip = sick_man_complete_bureaucracy_tt
	}

	on_monthly_pulse = {
		random_events = {
			100 = 0
			#10 = tanzimat_events.9 # Land registration resisted
		}
	}

	invalid = {
		custom_tooltip = {
			text = finished_sick_man_tt
			has_variable = sick_man_complete
		}
	}

	transferable = no
	should_be_pinned_by_default = yes
	weight = 5000
}

